#nolint:git-checkout-must-use-github-updates,valid-pipeline-git-checkout-tag
package:
  name: neuvector-db
  version: 0_git20240530
  epoch: 0
  description: NeuVector vulnerability database for the SUSE NeuVector Container Security Platform
  copyright:
    - license: Apache-2.0

environment:
  contents:
    packages:
      - busybox
      - neuvector-dbgen

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/neuvector/vul-source
      destination: vul-source
      expected-commit: 0a105a09b1738122f7d1005e06ee1705709861f5

  - runs: |
      # Generate db
      dbgen

      # Install DB
      mkdir -p ${{targets.contextdir}}/etc/neuvector/db
      mv cvedb.regular ${{targets.contextdir}}/etc/neuvector/db/cvedb

  - uses: strip

test:
  pipeline:
    - runs: |
        if [[ -f "/etc/neuvector/db/cvedb" ]]; then
          echo "CVE DB found!" && exit 0
        else
          echo "CVE DB not found!" && exit 1
        fi

update:
  manual: true # No releases or tags

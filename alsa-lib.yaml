package:
  name: acl
  version: 2.3.1
  epoch: 0
  description: "access control list utilities"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: LGPL-2.1-or-later AND GPL-2.0-or-later
environment:
  contents:
    packages:
      - wolfi-base
      - busybox
      - ca-certificates-bundle
      - build-base
      - attr-dev
pipeline:
  - uses: fetch
    with:
      uri: https://download.savannah.nongnu.org/releases/acl/acl-${{package.version}}.tar.gz
      expected-sha256: 760c61c68901b37fdd5eefeeaf4c0c7a26bdfdd8ac747a1edff1ce0e243c11af
  - runs: |
      ./configure \
         --prefix=/usr \
         --libdir=/lib \
         --libexecdir=/usr/libexec
  - uses: autoconf/make
  - uses: autoconf/make-install
  - runs: |
      mkdir -p "${{targets.destdir}}"/usr/lib
      mv "${{targets.destdir}}"/lib/pkgconfig "${{targets.destdir}}"/usr/lib/
  - uses: strip
subpackages:
  - name: "acl-dev"
    description: "headers for libacl"
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - acl
  - name: "libacl1"
    description: "library for managing access control lists"
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/lib
          mv "${{targets.destdir}}"/lib/libacl.so.* "${{targets.subpkgdir}}"/lib/
---
package:
  name: alsa-lib
  version: 1.2.7.2
  epoch: 0
  description: Advanced Linux Sound Architecture (ALSA) library
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: LGPL-2.1-or-later
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/os
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - automake
      - autoconf
      - linux-headers
pipeline:
  - uses: fetch
    with:
      expected-sha256: 8a35b7218e50f2a2c79342d0de98ded81439ce19e12809385ec9be9596de7c2f
      uri: https://alsa-project.org/files/pub/lib/alsa-lib-${{package.version}}.tar.bz2
  - uses: autoconf/configure
    with:
      opts: |
        --disable-python \
        --disable-static \
        --disable-resmgr \
        --enable-rawmidi \
        --enable-seq \
        --enable-aload \
        --disable-dependency-tracking \
        --without-versioned
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: alsa-lib-dev
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - alsa-lib
---
package:
  name: apk-tools
  version: 2.12.9
  epoch: 3
  description: "apk-tools (Wolfi package manager)"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: GPL-2.0-only
  dependencies:
    runtime:
      - ca-certificates-bundle
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/bootstrap/stage3
    keyring:
      - https://packages.wolfi.dev/bootstrap/stage3/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - scdoc
      - zlib-dev
      - openssl-dev
      - lua5.3
      - lua5.3-lzlib
      - lua5.3-dev
pipeline:
  - uses: fetch
    with:
      uri: https://gitlab.alpinelinux.org/alpine/apk-tools/-/archive/v${{package.version}}/apk-tools-v${{package.version}}.tar.gz
      expected-sha256: 7d9f68683c282a8e30a119e7951ffee293ec2caa8d55fd1280841eda09825ddd
  - runs: |
      sed -i -e 's:-Werror::' Make.rules
      echo "FULL_VERSION=${{package.version}}-r${{package.epoch}}" > config.mk
  - runs: |
      make LUA="lua5.3" V=1
  - runs: |
      make LUA="lua5.3" V=1 DESTDIR="${{targets.destdir}}" install

      install -d "${{targets.destdir}}"/var/lib/apk
      install -d "${{targets.destdir}}"/var/cache/misc
      install -d "${{targets.destdir}}"/etc/apk/keys
      install -d "${{targets.destdir}}"/etc/apk/protected_paths.d
  - uses: strip
subpackages:
  - name: "apk-tools-dev"
    description: "headers for libapk"
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - apk-tools
  - name: "lua5.3-apk"
    description: "Lua module for libapk"
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr
          mv "${{targets.destdir}}"/usr/lib "${{targets.subpkgdir}}"/usr/lib
---
package:
  name: attr
  version: 2.5.1
  epoch: 0
  description: "utilities for managing filesystem extended attributes"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: GPL-2.0-or-later
environment:
  contents:
    packages:
      - wolfi-base
      - busybox
      - ca-certificates-bundle
      - build-base
pipeline:
  - uses: fetch
    with:
      uri: https://download.savannah.nongnu.org/releases/attr/attr-${{package.version}}.tar.gz
      expected-sha256: bae1c6949b258a0d68001367ce0c741cebdacdd3b62965d17e5eb23cd78adaf8
  - runs: |
      ./configure \
         --prefix=/ \
         --exec-prefix=/ \
         --sbindir=/bin \
         --bindir=/usr/bin \
         --libdir=/lib \
         --libexecdir=/usr/lib \
         --includedir=/usr/include \
         --mandir=/usr/share/man \
         --docdir=/usr/share/doc/attr \
         --datadir=/usr/share \
         --disable-nls \
         --disable-static
  - uses: autoconf/make
  - uses: autoconf/make-install
  - runs: |
      mkdir -p "${{targets.destdir}}"/usr/lib
      mv "${{targets.destdir}}"/lib/pkgconfig "${{targets.destdir}}"/usr/lib/
  - uses: strip
subpackages:
  - name: "attr-dev"
    description: "headers for libattr"
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - attr
  - name: "libattr1"
    description: "library for managing filesystem extended attributes"
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/lib
          mv "${{targets.destdir}}"/lib/libattr.so.* "${{targets.subpkgdir}}"/lib/
---
package:
  name: autoconf
  version: 2.71
  epoch: 0
  description: "GNU tool for generating configure scripts"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: GPL-3.0-or-later
  dependencies:
    runtime:
      - m4
      - perl
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/bootstrap/stage3
    keyring:
      - https://packages.wolfi.dev/bootstrap/stage3/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - m4
      - perl
pipeline:
  - uses: fetch
    with:
      uri: https://ftp.gnu.org/gnu/autoconf/autoconf-${{package.version}}.tar.gz
      expected-sha256: 431075ad0bf529ef13cb41e9042c542381103e80015686222b8a9d4abef42a1c
  - runs: |
      M4=/usr/bin/m4 ./configure \
        --prefix=/usr
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: "autoconf-doc"
    description: "autoconf documentation"
    pipeline:
      - uses: split/manpages
      - runs: |
          rm -f "${{targets.destdir}}"/usr/share/info/dir
          rm -f "${{targets.destdir}}"/usr/share/info/standards.info

          mkdir -p "${{targets.subpkgdir}}"/usr/share
          mv "${{targets.destdir}}"/usr/share/info "${{targets.subpkgdir}}"/usr/share/
---
package:
  name: automake
  version: 1.16.5
  epoch: 0
  description: "GNU tool for generating makefiles"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: GPL-3.0-or-later
  dependencies:
    runtime:
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/bootstrap/stage3
    keyring:
      - https://packages.wolfi.dev/bootstrap/stage3/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - autoconf
pipeline:
  - uses: fetch
    with:
      uri: https://ftp.gnu.org/gnu/automake/automake-${{package.version}}.tar.xz
      expected-sha256: f01d58cd6d9d77fbdca9eb4bbd5ead1988228fdb73d6f7a201f5f8d6b118b469
  - runs: |
      M4=/usr/bin/m4 ./configure \
        --prefix=/usr
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: "automake-doc"
    description: "automake documentation"
    pipeline:
      - uses: split/manpages
---
package:
  name: bash
  version: 5.2_rc4
  epoch: 0
  description: "GNU bourne again shell"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: GPL-3.0-or-later
  dependencies:
    runtime:
environment:
  contents:
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - ncurses-dev
pipeline:
  - uses: fetch
    with:
      uri: https://ftp.gnu.org/gnu/bash/bash-5.2-rc4.tar.gz
      expected-sha256: eacca1115c1032d611cfccfc6225bcf7c500dc5a8a2e10508346607787ef7421
  - runs: |
      ./configure \
        --host=$(uname -m)-pc-linux-gnu \
        --target=$(uname -m)-pc-linux-gnu \
        --prefix=/usr \
        --bindir=/bin \
        --sysconfdir=/etc \
        --without-libidn \
        --with-ssl=openssl \
        --disable-nls \
        --enable-readline \
        --without-bash-malloc \
        --with-curses
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: "bash-doc"
    description: "bash documentation"
    pipeline:
      - uses: split/manpages
      - uses: split/infodir
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/share
          mv "${{targets.destdir}}"/usr/share/doc "${{targets.subpkgdir}}"/usr/share/
  - name: "bash-dev"
    description: "bash development headers"
    pipeline:
      - uses: split/dev
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/bin
          mv "${{targets.destdir}}"/bin/bashbug "${{targets.subpkgdir}}"/bin/

          mkdir -p "${{targets.subpkgdir}}"/usr/lib/bash
          mv "${{targets.destdir}}"/usr/lib/bash/Makefile* "${{targets.subpkgdir}}"/usr/lib/bash/
---
package:
  name: binutils
  version: 2.39
  epoch: 3
  description: "GNU binutils"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: GPL-3.0-or-later
  dependencies:
    runtime:
secfixes:
  2.39-r1:
    - CVE-2022-38126
  2.39-r2:
    - CVE-2022-38533
  2.39-r3:
    - CVE-2022-38128
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/bootstrap/stage3
    keyring:
      - https://packages.wolfi.dev/bootstrap/stage3/wolfi-signing.rsa.pub
    packages:
      - wolfi-baselayout
      - busybox
      - ca-certificates-bundle
      - build-base
      - isl
      - texinfo
pipeline:
  - uses: fetch
    with:
      uri: https://ftp.gnu.org/gnu/binutils/binutils-${{package.version}}.tar.gz
      expected-sha256: d12ea6f239f1ffe3533ea11ad6e224ffcb89eb5d01bbea589e9158780fa11f10
  - uses: patch
    with:
      patches: CVE-2022-38128.patch
  - uses: patch
    with:
      patches: CVE-2022-38533.patch
  - name: 'Configure binutils'
    runs: |
      ./configure \
        --prefix=/usr \
        --build=$(./config.guess) \
        --host=$(uname -m)-pc-linux-gnu \
        --target=$(uname -m)-pc-linux-gnu \
        --disable-nls \
        --disable-werror \
        --disable-multilib \
        --disable-gprofng
  - runs: |
      make -j$(nproc) V=1
  - uses: autoconf/make-install
  - name: 'Clean up documentation'
    runs: |
      rm -rf ${{targets.destdir}}/usr/share/info
  - uses: strip
subpackages:
  - name: "binutils-dev"
    description: "binutils development headers"
    pipeline:
      - uses: split/dev
---
package:
  name: bison
  version: 3.8.2
  epoch: 1
  description: "The GNU general-purposes parser generator"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: GPL-3.0-or-later
  dependencies:
    runtime:
      - m4
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/bootstrap/stage3
    keyring:
      - https://packages.wolfi.dev/bootstrap/stage3/wolfi-signing.rsa.pub
    packages:
      - wolfi-baselayout
      - busybox
      - ca-certificates-bundle
      - build-base
      - m4
pipeline:
  - uses: fetch
    with:
      uri: https://ftp.gnu.org/gnu/bison/bison-${{package.version}}.tar.gz
      expected-sha256: 06c9e13bdf7eb24d4ceb6b59205a4f67c2c7e7213119644430fe82fbd14a0abb
  - name: 'Configure bison'
    runs: |
      ./configure \
        --prefix=/usr \
        --libdir=/lib \
        --sysconfdir=/etc \
        --datadir=/usr/share \
        --mandir=/usr/share/man \
        --infodir=/usr/share/info \
        --host=$(uname -m)-pc-linux-gnu \
        --target=$(uname -m)-pc-linux-gnu
  - runs: |
      make -j$(nproc) V=1
  - uses: autoconf/make-install
  - runs: |
      rm -rf "${{targets.destdir}}"/usr/lib
  - uses: strip
---
package:
  name: brotli
  version: 1.0.9
  epoch: 0
  description: "a generic lossless compression algorithm"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: MIT
secfixes:
  1.0.9-r0:
    - CVE-2020-8927
environment:
  contents:
    packages:
      - wolfi-base
      - busybox
      - ca-certificates-bundle
      - build-base
      - autoconf
      - automake
      - libtool
pipeline:
  - uses: fetch
    with:
      uri: https://github.com/google/brotli/archive/v${{package.version}}.tar.gz
      expected-sha256: f9e8d81d0405ba66d181529af42a3354f838c939095ff99930da6aa9cdf6fe46
  - runs: |
      ./bootstrap
  - uses: autoconf/configure
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: "brotli-dev"
    description: "headers for brotli"
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - brotli
  - name: "libbrotlicommon1"
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/lib
          mv "${{targets.destdir}}"/usr/lib/libbrotlicommon.so.* "${{targets.subpkgdir}}"/usr/lib/
  - name: "libbrotlienc1"
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/lib
          mv "${{targets.destdir}}"/usr/lib/libbrotlienc.so.* "${{targets.subpkgdir}}"/usr/lib/
  - name: "libbrotlidec1"
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/lib
          mv "${{targets.destdir}}"/usr/lib/libbrotlidec.so.* "${{targets.subpkgdir}}"/usr/lib/
---
package:
  name: bubblewrap
  version: 0.6.2
  epoch: 0
  description: "Unprivileged sandboxing tool"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: LGPL-2.0-or-later
  dependencies:
    runtime:
environment:
  contents:
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    repositories:
      - https://packages.wolfi.dev/os
    packages:
      - ca-certificates-bundle
      - busybox
      - build-base
      - bash
      - meson
      - libcap-dev
pipeline:
  - uses: fetch
    with:
      uri: https://github.com/containers/bubblewrap/archive/refs/tags/v${{package.version}}.tar.gz
      expected-sha256: f8d21707b492d318380f0a76966e8cfa40c2df283de8bcf1ac51e7a4dcc12e97
  - runs: |
      meson --prefix=/usr -Drequire_userns=true . output
      meson compile -C output
      DESTDIR="${{targets.destdir}}" meson install --no-rebuild -C output
subpackages:
  - name: bubblewrap-bash-completion
    description: bash completion for bubblewrap
    pipeline:
      - runs: |
          set -x
          mkdir -p "${{targets.subpkgdir}}/usr/share/bash-completion/completions"
          mv "${{targets.destdir}}/usr/share/bash-completion/completions/bwrap" \
            "${{targets.subpkgdir}}/usr/share/bash-completion/completions/bwrap"
          rm -rf "${{targets.destdir}}/usr/share/bash-completion"
    dependencies:
      runtime:
        - bubblewrap
  - name: bubblewrap-zsh-completion
    description: zsh completion for bubblewrap
    pipeline:
      - runs: |
          set -x
          mkdir -p "${{targets.subpkgdir}}/usr/share/zsh/site-functions"
          mv "${{targets.destdir}}/usr/share/zsh/site-functions/_bwrap" \
            "${{targets.subpkgdir}}/usr/share/zsh/site-functions/_bwrap"
          rm -rf "${{targets.destdir}}/usr/share"
    dependencies:
      runtime:
        - bubblewrap
---
package:
  name: build-base
  version: 1
  epoch: 3
  description: "virtual package for builds"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: MIT
  dependencies:
    runtime:
      - wolfi-baselayout
      - binutils
      - gcc
      - pkgconf
      - make
      - glibc-dev
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/bootstrap/stage3
    keyring:
      - https://packages.wolfi.dev/bootstrap/stage3/wolfi-signing.rsa.pub
    packages:
      - wolfi-baselayout
      - busybox
pipeline:
  - name: Install
    runs: |
      mkdir -p "${{targets.destdir}}"
---
package:
  name: busybox
  version: 1.35.0
  epoch: 3
  description: "swiss-army knife for embedded systems"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: MIT
  dependencies:
    runtime:
  scriptlets:
    trigger:
      paths:
        - /bin
        - /sbin
        - /usr/bin
        - /usr/sbin
      script: |
        #!/bin/busybox sh
        /bin/busybox --install -s
secfixes:
  1.35.0-r3:
    - CVE-2022-28391
    - CVE-2022-30065
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/bootstrap/stage3
    keyring:
      - https://packages.wolfi.dev/bootstrap/stage3/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
pipeline:
  - uses: fetch
    with:
      uri: https://distfiles.alpinelinux.org/distfiles/edge/busybox-1.35.0.tar.bz2
      expected-sha256: faeeb244c35a348a334f4a59e44626ee870fb07b6884d68c10ae8bc19f83a694
  - uses: patch
    with:
      patches: CVE-2022-28391-1.patch
  - uses: patch
    with:
      patches: CVE-2022-28391-2.patch
  - uses: patch
    with:
      patches: CVE-2022-30065.patch
  - name: Configure
    runs: |
      cp busyboxconfig .config
  - runs: |
      make CC="$(uname -m)-pc-linux-gnu-gcc" V=1 -j$(nproc)
  - name: Install
    runs: |
      mkdir -p "${{targets.destdir}}"/usr/sbin
      mkdir -p "${{targets.destdir}}"/usr/bin
      mkdir -p "${{targets.destdir}}"/tmp
      mkdir -p "${{targets.destdir}}"/var/cache/misc
      mkdir -p "${{targets.destdir}}"/bin
      mkdir -p "${{targets.destdir}}"/sbin
      mkdir -p "${{targets.destdir}}"/etc
      mkdir -p "${{targets.destdir}}"/usr/share/man/man1
      chmod 1777 "${{targets.destdir}}"/tmp
      install -m755 busybox "${{targets.destdir}}"/bin/busybox
      install -m644 securetty "${{targets.destdir}}"/etc/securetty
  - uses: strip
---
package:
  name: bzip2
  version: 1.0.8
  epoch: 2
  description: "a library implementing the bzip2 compression algorithms"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: MPL-2.0 AND MIT
  dependencies:
    runtime:
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/bootstrap/stage3
    keyring:
      - https://packages.wolfi.dev/bootstrap/stage3/wolfi-signing.rsa.pub
    packages:
      - wolfi-baselayout
      - busybox
      - ca-certificates-bundle
      - build-base
      - make
pipeline:
  - uses: fetch
    with:
      uri: https://sourceware.org/pub/bzip2/bzip2-${{package.version}}.tar.gz
      expected-sha256: ab5a03176ee106d3f0fa90e381da478ddae405918153cca248e682cd0c4a2269
  - uses: patch
    with:
      patches: bzip2-1.0.2-progress.patch
  - uses: patch
    with:
      patches: bzip2-1.0.3-no-test.patch
  - uses: patch
    with:
      patches: bzip2-1.0.4-makefile-CFLAGS.patch
  - uses: patch
    with:
      patches: bzip2-1.0.4-man-links.patch
  - uses: patch
    with:
      patches: saneso.patch
  - runs: |
      sed -i \
        -e 's:\$(PREFIX)/man:\$(PREFIX)/share/man:g' \
        -e 's:ln -s -f $(PREFIX)/bin/:ln -s :' \
        Makefile

      sed -i \
        -e "s:1\.0\.4:${{package.version}}:" \
        bzip2.1 bzip2.txt Makefile-libbz2_so manual.*
  - runs: |
      make -f Makefile-libbz2_so all
      make all
  - runs: |
      make PREFIX="${{targets.destdir}}/usr" install

      install -D libbz2.so.${{package.version}} "${{targets.destdir}}"/usr/lib/libbz2.so.${{package.version}}
      ln -s libbz2.so.${{package.version}} "${{targets.destdir}}"/usr/lib/libbz2.so
      ln -s libbz2.so.${{package.version}} "${{targets.destdir}}"/usr/lib/libbz2.so.1
  - uses: strip
subpackages:
  - name: "bzip2-dev"
    description: "bzip2 headers"
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - bzip2
---
package:
  name: c-ares
  version: 1.18.1
  epoch: 0
  description: "an asynchronous DNS resolution library"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: MIT
environment:
  contents:
    packages:
      - wolfi-base
      - busybox
      - ca-certificates-bundle
      - build-base
pipeline:
  - uses: fetch
    with:
      uri: https://c-ares.haxx.se/download/c-ares-${{package.version}}.tar.gz
      expected-sha256: 1a7d52a8a84a9fbffb1be9133c0f6e17217d91ea5a6fa61f6b4729cda78ebbcf
  - uses: autoconf/configure
    with:
      opts: --enable-shared
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: "c-ares-dev"
    description: "headers for c-ares"
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - libev
  - name: "c-ares-doc"
    description: "c-ares documentation"
    pipeline:
      - uses: split/manpages
---
package:
  name: ca-certificates
  version: 20220614
  epoch: 2
  description: "CA certificates from the Mozilla trusted root program"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: MPL-2.0 AND MIT
  dependencies:
    runtime:
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/bootstrap/stage3
    keyring:
      - https://packages.wolfi.dev/bootstrap/stage3/wolfi-signing.rsa.pub
    packages:
      - busybox
      - perl
      - build-base
      - ca-certificates-bundle
      - openssl-dev
pipeline:
  - uses: fetch
    with:
      uri: https://gitlab.alpinelinux.org/alpine/ca-certificates/-/archive/${{package.version}}/ca-certificates-${{package.version}}.tar.gz
      expected-sha256: de497e371819f5dd2ad0764e89856fa674e3561d5f8003d79900c983d1075989
  - runs: |
      make CC="$(uname -m)-pc-linux-gnu-gcc"
  - runs: |
      make install DESTDIR="${{targets.destdir}}"

      (
        echo "# Automatically generated by ${{package.name}}-${{package.version}}-r${{package.epoch}}"
        echo "# Do not edit."
        cd "${{targets.destdir}}"/usr/share/ca-certificates
        find . -name '*.crt' | sort | cut -b3-
      ) > "${{targets.destdir}}"/etc/ca-certificates.conf

      for i in $(ls *.crt | sort); do
        cat "$i"
        printf "\n"
      done > "${{targets.destdir}}"/etc/ssl/certs/ca-certificates.crt

      mkdir -p "${{targets.destdir}}"/etc/apk/protected_paths.d
      cat > "${{targets.destdir}}"/etc/apk/protected_paths.d/ca-certificates.list <<-EOF
        -etc/ssl/certs/ca-certificates.crt
        -etc/ssl/certs/ca-cert-*.pem
        -etc/ssl/certs/[0-9a-f][0-9a-f][0-9a-f][0-9a-f][0-9a-f][0-9a-f][0-9a-f][0-9a-f].[r0-9]*
      EOF

      cat > "${{targets.destdir}}"/etc/ca-certificates/update.d/certhash <<-EOF
        #!/bin/sh
        exec /usr/bin/c_rehash /etc/ssl/certs
      EOF

      chmod +x "${{targets.destdir}}"/etc/ca-certificates/update.d/certhash
subpackages:
  - name: "ca-certificates-bundle"
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/etc/ssl/certs
          mv "${{targets.destdir}}"/etc/ssl/certs/ca-certificates.crt "${{targets.subpkgdir}}"/etc/ssl/certs
          ln -s certs/ca-certificates.crt "${{targets.subpkgdir}}"/etc/ssl/cert.pem
---
package:
  name: check
  version: 0.15.2
  epoch: 0
  description: A unit test framework for C
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: LGPL-2.0-or-later
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/os
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - automake
      - autoconf
      - texinfo
      - libtool
pipeline:
  - uses: fetch
    with:
      expected-sha256: a8de4e0bacfb4d76dd1c618ded263523b53b85d92a146d8835eb1a52932fa20a
      uri: https://github.com/libcheck/check/releases/download/${{package.version}}/check-${{package.version}}.tar.gz
  - uses: autoconf/configure
    with:
      opts: |
        --disable-static \
        --enable-build-docs
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: check-doc
    pipeline:
      - uses: split/manpages
    description: check manpages
  - name: check-dev
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - check
    description: check dev
---
package:
  name: cmake
  version: 3.24.2
  epoch: 0
  description: "cross-platform asynchronous I/O library"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: BSD-3-Clause
environment:
  contents:
    packages:
      - wolfi-base
      - busybox
      - ca-certificates-bundle
      - build-base
      - bzip2-dev
      - curl-dev
      - expat-dev
      - libarchive-dev
      - libuv-dev
      - ncurses-dev
      - rhash-dev
      - samurai
      - xz-dev
      - zlib-dev
pipeline:
  - uses: fetch
    with:
      uri: https://www.cmake.org/files/v3.24/cmake-${{package.version}}.tar.gz
      expected-sha256: 0d9020f06f3ddf17fb537dc228e1a56c927ee506b486f55fe2dc19f69bf0c8db
  - runs: |
      ./bootstrap \
        --prefix=/usr \
        --mandir=/share/man \
        --datadir=/share/cmake \
        --docdir=/share/doc/cmake \
        --system-libs \
        --no-system-jsoncpp \
        --generator=Ninja \
        --parallel=$(nproc)
  - runs: |
      ninja
  - runs: |
      DESTDIR="${{targets.destdir}}" ninja install
  - uses: strip
---
package:
  name: coreutils
  version: 9.1
  epoch: 0
  description: "GNU core utilities"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: GPL-3.0-or-later
  scriptlets:
    post-deinstall: |
      #!/bin/busybox sh
      /bin/busybox --install -s
secfixes:
  0:
    - CVE-2016-2781
environment:
  contents:
    packages:
      - wolfi-base
      - busybox
      - ca-certificates-bundle
      - build-base
      - acl-dev
      - attr-dev
      - texinfo
pipeline:
  - uses: fetch
    with:
      uri: https://ftp.gnu.org/gnu/coreutils/coreutils-${{package.version}}.tar.xz
      expected-sha256: 61a1f410d78ba7e7f37a5a4f50e6d1320aca33375484a3255eddf17a38580423
  - runs: |
      env FORCE_UNSAFE_CONFIGURE=1 ./configure \
         --prefix=/usr \
         --libdir=/lib \
         --libexecdir=/usr/libexec \
         --sysconfdir=/etc \
         --mandir=/usr/share/man \
         --infodir=/usr/share/info \
         --disable-nls \
         --enable-no-install-programs=hostname,su,kill,uptime,groups \
         --enable-single-binary=symlinks
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
  # Move things around to match busybox locations
  - runs: |
      cd "${{targets.destdir}}"

      rm -rf usr/lib/charset.alias
      rmdir -p usr/lib 2>/dev/null || true

      install -d bin usr/sbin

      for i in base64 cat chgrp chmod chown cp date dd df echo false ln ls mkdir mknod mktemp mv nice printenv pwd rm rmdir sleep stat stty sync touch true uname; do
        rm usr/bin/$i
        ln -s ../usr/bin/coreutils bin/$i
      done

      rm usr/bin/chroot
      ln -s ../bin/chroot usr/sbin/chroot

      # shouldn't be here, but you never know...
      rm -f usr/bin/groups
subpackages:
  - name: "coreutils-doc"
    description: "documentation for GNU coreutils"
    pipeline:
      - uses: split/manpages
      - uses: split/infodir
---
package:
  name: cups
  version: 2.4.2
  epoch: 0
  description: The CUPS Printing System
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: GPL-2.0-only
secfixes:
  2.4.2-r0:
    - CVE-2022-26691
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/os
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - automake
      - autoconf
      - zlib-dev
      - libpaper-dev
      - dbus
      - dbus-dev
      - libusb-dev
      - libgcrypt-dev
      - openssl-dev
      # - poppler-utils TODO add for CUPS to be useful for printing.
      # - libjpeg-turbo-dev TODO add for CUPS to be useful for printing.
      # - avahi-dev TODO add for CUPS to be useful for printing.
      # - gnutls-dev TODO add for CUPS to be useful for printing.
pipeline:
  - uses: fetch
    with:
      expected-sha256: 7095b2977bb728ded5566a5c802866062840d6541fd027836865949a407c3682
      uri: https://github.com/OpenPrinting/cups/archive/v${{package.version}}.tar.gz
  - uses: autoconf/configure
    with:
      opts: |
        --with-menudir=/usr/share/applications \
        --with-icondir=/usr/share/icons \
        --with-logdir=/var/log/cups \
        --with-docdir=/usr/share/cups \
        --with-rundir=/run/cups \
        --with-cupsd-file-perm=0755 \
        --with-cups-user=lp \
        --with-cups-group=lp \
        --with-system-groups=lpadmin \
        --with-domainsocket=/run/cups/cups.sock \
        --enable-libusb \
        --without-rcdir \
        --disable-pam \
        --enable-raw-printing \
        --enable-dbus \
        --with-dbusdir=/usr/share/dbus-1 \
        --enable-libpaper \
        --with-tls=openssl \
        --with-optim="$CFLAGS"
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: cups-doc
    description: cups manpages
    pipeline:
      - uses: split/manpages
  - name: cups-libs
    description: CUPS libraries
    pipeline:
      - runs: |
          mkdir -p ${{targets.subpkgdir}}/usr/lib
          mv ${{targets.destdir}}/usr/lib/*.so* ${{targets.subpkgdir}}/usr/lib

          mkdir -p ${{targets.subpkgdir}}/etc
          mv ${{targets.destdir}}/usr/etc/cups ${{targets.subpkgdir}}/etc
  - name: ipptool
    description: Perform internet printing protocol requests
    pipeline:
      - runs: |
          mkdir -p ${{targets.subpkgdir}}/usr/bin
          mv ${{targets.destdir}}/usr/bin/ipptool ${{targets.subpkgdir}}/usr/bin
  - name: cups-client
    description: CUPS command-line client programs
    pipeline:
      - runs: |
          mkdir -p ${{targets.subpkgdir}}/usr/bin
          mv ${{targets.destdir}}/usr/sbin/cupsaccept ${{targets.subpkgdir}}/usr/bin
          mv ${{targets.destdir}}/usr/sbin/cupsctl ${{targets.subpkgdir}}/usr/bin
          mv ${{targets.destdir}}/usr/sbin/cupsdisable ${{targets.subpkgdir}}/usr/bin
          mv ${{targets.destdir}}/usr/sbin/cupsenable ${{targets.subpkgdir}}/usr/bin
          mv ${{targets.destdir}}/usr/sbin/lpadmin ${{targets.subpkgdir}}/usr/bin
          mv ${{targets.destdir}}/usr/sbin/lpc ${{targets.subpkgdir}}/usr/bin
          mv ${{targets.destdir}}/usr/sbin/lpinfo ${{targets.subpkgdir}}/usr/bin
          mv ${{targets.destdir}}/usr/sbin/lpmove ${{targets.subpkgdir}}/usr/bin
  - name: cups-dev
    description: cups dev
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - cups
        - libgcrypt-dev
        # - gnutls-dev
        - zlib-dev
---
package:
  name: curl
  version: 7.85.0
  epoch: 1
  description: "URL retrieval utility and library"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: MIT
environment:
  contents:
    packages:
      - wolfi-base
      - busybox
      - ca-certificates-bundle
      - build-base
      - nghttp2-dev
      - openssl-dev
      - zlib-dev
      - brotli-dev
pipeline:
  - uses: fetch
    with:
      uri: https://curl.se/download/curl-${{package.version}}.tar.xz
      expected-sha256: 88b54a6d4b9a48cb4d873c7056dcba997ddd5b7be5a2d537a4acb55c20b04be6
  - uses: autoconf/configure
    with:
      opts: "--enable-ipv6 \\\n--enable-unix-sockets \\\n--with-openssl \\\n--with-nghttp2 \\\n--with-pic \\\n--disable-ldap \\\n--without-libssh2    \n"
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: "curl-dev"
    description: "headers for libcurl"
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - libcurl4
  - name: "curl-doc"
    description: "documentation for curl"
    pipeline:
      - uses: split/manpages
  - name: "libcurl4"
    description: "curl library"
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/lib
          mv "${{targets.destdir}}"/usr/lib/libcurl.so.* "${{targets.subpkgdir}}"/usr/lib/
---
package:
  name: dbus
  version: 1.14.4
  epoch: 0
  description: Freedesktop.org message bus system
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: AFL-2.1 OR GPL-2.0-or-later
secfixes:
  1.14.4-r0:
    - CVE-2022-42010
    - CVE-2022-42011
    - CVE-2022-42012
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/os
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - automake
      - autoconf
      - expat-dev
      - libsm-dev
      - libx11-dev
      - meson
      - xmlto
      - bash
      # - glib-dev # TODO needed by libdbus-glib
      # - util-linux-dev # TODO adding unit-linux at a later date
pipeline:
  - uses: fetch
    with:
      expected-sha256: 7c0f9b8e5ec0ff2479383e62c0084a3a29af99edf1514e9f659b81b30d4e353e
      uri: https://dbus.freedesktop.org/releases/dbus/dbus-${{package.version}}.tar.xz
  - uses: autoconf/configure
    with:
      opts: |
        --with-system-pid-file=/run/dbus/dbus.pid \
        --enable-xml-docs=false \
        --enable-doxygen-docs=false
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: dbus-doc
    pipeline:
      - runs: |
          mkdir -p ${{targets.subpkgdir}}/usr/share
          mv ${{targets.destdir}}/usr/share/doc ${{targets.subpkgdir}}/usr/share
    description: dbus manpages
  - name: dbus-libs
    pipeline:
      - runs: |
          mkdir -p ${{targets.subpkgdir}}/usr/lib
          mv ${{targets.destdir}}/usr/lib/lib*.so.* ${{targets.subpkgdir}}/usr/lib
    description: D-BUS access libraries
  - name: dbus-x11
    pipeline:
      - runs: |
          mkdir -p ${{targets.subpkgdir}}/usr/bin
          mv ${{targets.destdir}}/usr/bin/dbus-launch ${{targets.subpkgdir}}/usr/bin/dbus-launch
    description: X11 add-ons for D-BUS
  - name: dbus-dev
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - dbus
        # - util-linux-dev todo add when util-linux is packaged
    description: dbus dev
---
package:
  name: diffutils
  version: 3.8
  epoch: 0
  description: "GNU diff utilities"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: GPL-3.0-or-later
environment:
  contents:
    packages:
      - wolfi-base
      - busybox
      - ca-certificates-bundle
      - build-base
pipeline:
  - uses: fetch
    with:
      uri: https://ftp.gnu.org/gnu/diffutils/diffutils-${{package.version}}.tar.xz
      expected-sha256: a6bdd7d1b31266d11c4f4de6c1b748d4607ab0231af5188fc2533d0ae2438fec
  - runs: |
      env FORCE_UNSAFE_CONFIGURE=1 ./configure \
         --prefix=/usr \
         --libdir=/lib \
         --libexecdir=/usr/libexec \
         --sysconfdir=/etc \
         --mandir=/usr/share/man \
         --infodir=/usr/share/info \
         --disable-nls
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: "diffutils-doc"
    description: "documentation for GNU coreutils"
    pipeline:
      - uses: split/manpages
      - uses: split/infodir
---
package:
  name: execline
  version: 2.9.0.1
  epoch: 0
  description: "a small scripting language intended to be an alternative to shell scripting"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: ISC
  dependencies:
    runtime:
environment:
  contents:
    packages:
      - wolfi-baselayout
      - busybox
      - ca-certificates-bundle
      - build-base
      - skalibs-dev
pipeline:
  - uses: fetch
    with:
      uri: https://skarnet.org/software/execline/execline-${{package.version}}.tar.gz
      expected-sha256: 01260fcaf80ffbca2a94aa55ea474dfb9e39b3033b55c8af88126791879531f6
  - name: Configure
    runs: |
      ./configure \
        --enable-shared \
        --enable-static \
        --disable-allstatic \
        --libdir=/usr/lib \
        --with-dynlib=/lib
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: "execline-dev"
    description: "execline development headers"
    pipeline:
      - uses: split/dev
---
package:
  name: expat
  version: 2.5.0
  epoch: 0
  description: "XML SAX Parser library written in C"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: MIT
  dependencies:
    runtime:
secfixes:
  2.4.9-r0:
    - CVE-2022-40674
  2.5.0-r0:
    - CVE-2022-43680
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/bootstrap/stage3
    keyring:
      - https://packages.wolfi.dev/bootstrap/stage3/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
pipeline:
  - uses: fetch
    with:
      uri: https://downloads.sourceforge.net/project/expat/expat/${{package.version}}/expat-${{package.version}}.tar.bz2
      expected-sha256: 6f0e6e01f7b30025fa05c85fdad1e5d0ec7fd35d9f61b22f34998de11969ff67
  - name: Configure
    runs: |
      ./configure \
         --host=$(uname -m)-pc-linux-gnu \
         --target=$(uname -m)-pc-linux-gnu \
         --prefix=/usr \
         --datadir=/usr/share
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: "expat-dev"
    description: "expat headers"
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - expat
---
package:
  name: file
  version: 5.42
  epoch: 3
  description: "file-type identification utility"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: BSD-2-Clause
  dependencies:
    runtime:
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/bootstrap/stage3
    keyring:
      - https://packages.wolfi.dev/bootstrap/stage3/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - file
pipeline:
  - uses: fetch
    with:
      uri: http://ftp.astron.com/pub/file/file-${{package.version}}.tar.gz
      expected-sha256: c076fb4d029c74073f15c43361ef572cfb868407d347190ba834af3b1639b0e4
  - name: Configure
    runs: |
      ./configure \
         --host=$(uname -m)-pc-linux-gnu \
         --target=$(uname -m)-pc-linux-gnu \
         --prefix=/usr \
         --datadir=/usr/share
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: "libmagic-dev"
    description: "libmagic headers"
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - libmagic
  - name: "libmagic"
    description: "file-type guessing library"
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/lib
          mv "${{targets.destdir}}"/usr/lib/libmagic.so.* "${{targets.subpkgdir}}"/usr/lib

          mkdir -p "${{targets.subpkgdir}}"/usr/share
          mv "${{targets.destdir}}"/usr/share/misc "${{targets.subpkgdir}}"/usr/share
  - name: "file-doc"
    description: "file documentation"
    pipeline:
      - uses: split/manpages
---
package:
  name: findutils
  version: 4.9.0
  epoch: 0
  description: "GNU find utilities"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: GPL-3.0-or-later
environment:
  contents:
    packages:
      - wolfi-base
      - busybox
      - ca-certificates-bundle
      - build-base
pipeline:
  - uses: fetch
    with:
      uri: https://ftp.gnu.org/gnu/findutils/findutils-${{package.version}}.tar.xz
      expected-sha256: a2bfb8c09d436770edc59f50fa483e785b161a3b7b9d547573cb08065fd462fe
  - runs: |
      env FORCE_UNSAFE_CONFIGURE=1 ./configure \
         --prefix=/usr \
         --libdir=/lib \
         --libexecdir=/usr/libexec \
         --sysconfdir=/etc \
         --mandir=/usr/share/man \
         --infodir=/usr/share/info \
         --disable-nls
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: "findutils-doc"
    description: "documentation for GNU coreutils"
    pipeline:
      - uses: split/manpages
      - uses: split/infodir
  - name: "locate"
    description: "locate and updatedb from findutils"
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/libexec
          mkdir -p "${{targets.subpkgdir}}"/usr/bin

          mv "${{targets.destdir}}"/usr/libexec/frcode "${{targets.subpkgdir}}"/usr/libexec/

          for i in locate updatedb; do
            mv "${{targets.destdir}}"/usr/bin/$i "${{targets.subpkgdir}}"/usr/bin/
          done
---
package:
  name: flex
  version: 2.6.4
  epoch: 2
  description: "tool for generating text-scanning programs"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: BSD-2-Clause AND LGPL-2.0-or-later
  dependencies:
    runtime:
      - m4
      - libfl2
secfixes:
  0:
    - CVE-2019-6293
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/bootstrap/stage3
    keyring:
      - https://packages.wolfi.dev/bootstrap/stage3/wolfi-signing.rsa.pub
    packages:
      - wolfi-baselayout
      - busybox
      - ca-certificates-bundle
      - build-base
      - bison
pipeline:
  - uses: fetch
    with:
      uri: https://github.com/westes/flex/releases/download/v${{package.version}}/flex-${{package.version}}.tar.gz
      expected-sha256: e87aae032bf07c26f85ac0ed3250998c37621d95f8bd748b31f15b33c45ee995
  - name: 'Configure flex'
    runs: |
      ./configure \
        --prefix=/usr \
        --libdir=/usr/lib \
        --sysconfdir=/etc \
        --datadir=/usr/share \
        --mandir=/usr/share/man \
        --infodir=/usr/share/info \
        --host=$(uname -m)-pc-linux-gnu \
        --target=$(uname -m)-pc-linux-gnu
  - runs: |
      make -j$(nproc) V=1
  - uses: autoconf/make-install
  - runs: |
      ln -s flex ${{targets.destdir}}/usr/bin/lex
  - uses: strip
subpackages:
  - name: "flex-dev"
    description: "flex development headers"
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - flex
        - libfl2
  - name: "libfl2"
    description: "flex scanner library"
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/lib
          mv "${{targets.destdir}}"/usr/lib/libfl.so* "${{targets.subpkgdir}}"/usr/lib
---
package:
  name: fontconfig
  version: 2.14.0
  epoch: 0
  description: Library for configuring and customizing font access
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: MIT
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/os
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - automake
      - autoconf
      - freetype-dev
      - expat-dev
      - python3-dev
      - python3
      - gperf
      - zlib-dev
      - brotli-dev
      - libpng-dev
      - bzip2-dev
      # - docbook2x # TODO disabling docs so we can avoid docbook2x for now
pipeline:
  - uses: fetch
    with:
      expected-sha256: b8f607d556e8257da2f3616b4d704be30fd73bd71e367355ca78963f9a7f0434
      uri: https://www.freedesktop.org/software/fontconfig/release/fontconfig-${{package.version}}.tar.gz
  - runs: rm -f src/fcobjshash.h
  - uses: autoconf/configure
    with:
      opts: |
        --enable-static \
        --enable-docs \
        --disable-nls \
        --disable-docs
  # --disable-docs to avoid building docbook* packages for now
  - runs: rm -f src/fcobjhash.h
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: fontconfig-static
    description: fontconfig static library
    pipeline:
      - uses: split/static
  - name: fontconfig-dev
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - fontconfig
    description: fontconfig dev
---
package:
  name: freetype
  version: 2.12.1
  epoch: 0
  description: TrueType font rendering library
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: FTL GPL-2.0-or-later
secfixes:
  2.12.1-r0:
    - CVE-2022-27404
    - CVE-2022-27405
    - CVE-2022-27406
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/os
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - automake
      - autoconf
      - brotli-dev
      - bzip2-dev
      - libpng-dev
      - libx11-dev
      - zlib-dev
pipeline:
  - uses: fetch
    with:
      expected-sha256: 4766f20157cc4cf0cd292f80bf917f92d1c439b243ac3018debf6b9140c41a7f
      uri: https://download.savannah.gnu.org/releases/freetype/freetype-${{package.version}}.tar.xz
  - uses: autoconf/configure
    with:
      opts: |
        --enable-static \
        --with-brotli \
        --with-bzip2 \
        --with-png \
        --enable-freetype-config
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: freetype-static
    description: freetype static library
    pipeline:
      - uses: split/static
  - name: freetype-dev
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - freetype
        - libx11-dev
        - libpng-dev
        - bzip2-dev
        - brotli-dev
    description: freetype dev
  - name: freetype-doc
    pipeline:
      - uses: split/manpages
    description: freetype manpages
---
package:
  name: gawk
  version: 5.1.1
  epoch: 3
  description: "GNU awk pattern-matching language"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: GPL-3.0-or-later
  dependencies:
    runtime:
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/bootstrap/stage3
    keyring:
      - https://packages.wolfi.dev/bootstrap/stage3/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
pipeline:
  - uses: fetch
    with:
      uri: https://ftp.gnu.org/gnu/gawk/gawk-${{package.version}}.tar.gz
      expected-sha256: 6168d8d1dc8f74bd17d9dc22fa9634c49070f232343b744901da15fb4f06bffd
  - name: Configure
    runs: |
      ./configure \
         --host=$(uname -m)-pc-linux-gnu \
         --target=$(uname -m)-pc-linux-gnu \
         --prefix=/usr \
         --datadir=/usr/share
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
---
package:
  name: gcc
  version: 12.2.0
  epoch: 6
  description: "the GNU compiler collection"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: GPL-3.0-or-later
  dependencies:
    runtime:
      - binutils
      - libstdc++-dev
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/bootstrap/stage3
    keyring:
      - https://packages.wolfi.dev/bootstrap/stage3/wolfi-signing.rsa.pub
    packages:
      - wolfi-baselayout
      - busybox
      - build-base
      - ca-certificates-bundle
      - texinfo
      - gawk
      - bison
      - flex-dev
      - gmp-dev
      - mpfr-dev
      - mpc-dev
      - isl-dev
      - zlib-dev
      - make
pipeline:
  - uses: fetch
    with:
      uri: https://ftp.gnu.org/gnu/gcc/gcc-${{package.version}}/gcc-${{package.version}}.tar.gz
      expected-sha256: ac6b317eb4d25444d87cf29c0d141dedc1323a1833ec9995211b13e1a851261c
  - name: 'Set up build directory'
    runs: |
      mkdir build
  - name: 'Configure GCC'
    runs: |
      cd build
      ../configure \
        --prefix=/usr \
        --disable-nls \
        --disable-werror \
        --with-glibc-version=2.35 \
        --enable-initfini-array \
        --disable-nls \
        --disable-multilib \
        --enable-host-shared \
        --enable-shared \
        --enable-threads \
        --enable-tls \
        --enable-default-pie \
        --enable-default-ssp \
        --with-system-zlib \
        --enable-languages=c,c++,objc,fortran,jit \
        --enable-bootstrap \
        --enable-gnu-indirect-function \
        --enable-gnu-unique-object \
        --enable-cet=auto \
        --with-linker-hash-style=gnu
  - runs: |
      make -C build -j$(nproc)
  - runs: |
      make -C build -j$(nproc) install DESTDIR="${{targets.destdir}}"
  - runs: |
      chmod 755 ${{targets.destdir}}/usr/lib64/libgcc_s.*
  - runs: |
      ln -s gcc ${{targets.destdir}}/usr/bin/cc
  - name: 'Clean up documentation'
    runs: |
      rm -rf ${{targets.destdir}}/usr/share/info
  - uses: strip
subpackages:
  - name: 'libstdc++'
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/lib64
          mv "${{targets.destdir}}"/usr/lib64/*++.a "${{targets.subpkgdir}}"/usr/lib64/
          mv "${{targets.destdir}}"/usr/lib64/*++.so.* "${{targets.subpkgdir}}"/usr/lib64/
  - name: 'libstdc++-dev'
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/lib64
          mkdir -p "${{targets.subpkgdir}}"/usr/include
          mkdir -p "${{targets.subpkgdir}}"/usr/share/gcc-${{package.version}}/python/libstdcxx
          mv "${{targets.destdir}}"/usr/lib64/libstdc++.so "${{targets.subpkgdir}}"/usr/lib64/
          mv "${{targets.destdir}}"/usr/include/*++* "${{targets.subpkgdir}}"/usr/include/
          mv "${{targets.destdir}}"/usr/share/gcc-${{package.version}}/python/libstdcxx/* \
            "${{targets.subpkgdir}}"/usr/share/gcc-${{package.version}}/python/libstdcxx/
        #  - name: "libgo"
        #    description: "GCC go runtime"
        #    pipeline:
        #      - runs: |
        #          mkdir -p "${{targets.subpkgdir}}"/usr/lib64
        #          mv "${{targets.destdir}}"/usr/lib64/libgo.so.* "${{targets.subpkgdir}}"/usr/lib64/
        #
        #  - name: "gcc-go"
        #    description: "GCC support for Go"
        #    pipeline:
        #      - runs: |
        #          _libexecdir=/usr/libexec/gcc/$(uname -m)-pc-linux-gnu/${{package.version}}
        #          mkdir -p "${{targets.subpkgdir}}"/$_libexecdir
        #          mkdir -p "${{targets.subpkgdir}}"/usr/lib64
        #          mkdir -p "${{targets.subpkgdir}}"/usr/bin
        #
        #          mv "${{targets.destdir}}"/usr/lib64/go "${{targets.subpkgdir}}"/usr/lib64/
        #
        #          mv "${{targets.destdir}}"/*go "${{targets.subpkgdir}}"/usr/bin/
        #          mv "${{targets.destdir}}"/*gofmt "${{targets.subpkgdir}}"/usr/bin/
        #
        #          for i in go1 cgo buildid test2json vet; do
        #            mv "${{targets.destdir}}"/$_libexecdir/$i "${{targets.subpkgdir}}"/$_libexecdir/
        #          done
        #
        #          mv "${{targets.destdir}}"/usr/lib64/libgo* "${{targets.subpkgdir}}"/usr/lib64/
        #    dependencies:
        #      runtime:
        #        - gcc
        #        - libgo
        #        # gcc-go and go conflict with each other.
        #        - '!go'
  - name: "libquadmath"
    description: "128-bit math library provided by GCC"
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/lib64
          mv "${{targets.destdir}}"/usr/lib64/libquadmath.so.* "${{targets.subpkgdir}}"/usr/lib64/
  - name: "libgfortran"
    description: "Fortran runtime library provided by GCC"
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/lib64
          mv "${{targets.destdir}}"/usr/lib64/libgfortran.so.* "${{targets.subpkgdir}}"/usr/lib64/
  - name: "gfortran"
    description: "GNU Fortran Compiler"
    pipeline:
      - runs: |
          _libexecdir=/usr/libexec/gcc/$(uname -m)-pc-linux-gnu/${{package.version}}
          _libdir=/usr/lib/gcc/$(uname -m)-pc-linux-gnu/${{package.version}}

          for i in "$_libexecdir" "$_libdir" usr/lib64 usr/bin; do
            mkdir -p "${{targets.subpkgdir}}"/$i
          done

          mv "${{targets.destdir}}"/usr/bin/*fortran "${{targets.subpkgdir}}"/usr/bin
          mv "${{targets.destdir}}"/usr/lib64/libgfortran* "${{targets.subpkgdir}}"/usr/lib64
          mv "${{targets.destdir}}"/usr/lib64/libquadmath* "${{targets.subpkgdir}}"/usr/lib64

          mv "${{targets.destdir}}"/$_libdir/finclude "${{targets.subpkgdir}}"/$_libdir
          mv "${{targets.destdir}}"/$_libexecdir/f951 "${{targets.subpkgdir}}"/$_libexecdir
    dependencies:
      runtime:
        - gcc
        - libgfortran
  - name: "libobjc"
    description: "GNU Objective-C runtime"
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/lib64
          mv "${{targets.destdir}}"/usr/lib64/libobjc.so.* "${{targets.subpkgdir}}"/usr/lib64
  - name: "gcc-objc"
    description: "GNU Objective-C compiler"
    pipeline:
      - runs: |
          _libexecdir=/usr/libexec/gcc/$(uname -m)-pc-linux-gnu/${{package.version}}
          _libdir=/usr/lib/gcc/$(uname -m)-pc-linux-gnu/${{package.version}}

          for i in "$_libexecdir" "$_libdir"/include usr/lib64; do
            mkdir -p "${{targets.subpkgdir}}"/$i
          done

          mv "${{targets.destdir}}"/$_libexecdir/cc1obj "${{targets.subpkgdir}}"/$_libexecdir
          mv "${{targets.destdir}}"/$_libdir/include/objc "${{targets.subpkgdir}}"/$_libdir/include/
          mv "${{targets.destdir}}"/usr/lib64/libobjc.* "${{targets.subpkgdir}}"/usr/lib64
  - name: "libgccjit"
    description: "GCC JIT library"
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/lib
          mv "${{targets.destdir}}"/usr/lib/libgccjit.so.* "${{targets.subpkgdir}}"/usr/lib/
  - name: "libgccjit-dev"
    description: "GCC JIT library headers"
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/lib
          mkdir -p "${{targets.subpkgdir}}"/usr/include

          mv "${{targets.destdir}}"/usr/lib/libgccjit.so "${{targets.subpkgdir}}"/usr/lib/
          mv "${{targets.destdir}}"/usr/include/libgccjit*.h "${{targets.subpkgdir}}"/usr/include/
  - name: "libgomp"
    description: "GNU parallel programming library"
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/lib64
          mv "${{targets.destdir}}"/usr/lib64/libgomp.so.* "${{targets.subpkgdir}}"/usr/lib64/
  - name: "libgcc"
    description: "GCC runtime library"
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/lib64
          mv "${{targets.destdir}}"/usr/lib64/libgcc_s.so.* "${{targets.subpkgdir}}"/usr/lib64/
  - name: "libatomic"
    description: "GCC atomic library"
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/lib64
          mv "${{targets.destdir}}"/usr/lib64/libatomic.so.* "${{targets.subpkgdir}}"/usr/lib64/
---
package:
  name: gdbm
  version: 1.23
  epoch: 1
  description: "GNU dbm is a set of database routines which use extensible hashing"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: GPL-3.0-or-later
  dependencies:
    runtime:
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/bootstrap/stage3
    keyring:
      - https://packages.wolfi.dev/bootstrap/stage3/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
pipeline:
  - uses: fetch
    with:
      uri: https://ftp.gnu.org/gnu/gdbm/gdbm-${{package.version}}.tar.gz
      expected-sha256: 74b1081d21fff13ae4bd7c16e5d6e504a4c26f7cde1dca0d963a484174bbcacd
  - name: Configure
    runs: |
      ./configure \
         --host=$(uname -m)-pc-linux-gnu \
         --target=$(uname -m)-pc-linux-gnu \
         --prefix=/usr \
         --datadir=/usr/share
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: "gdbm-dev"
    description: "gdbm headers"
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - gdbm
---
package:
  name: git-lfs
  version: 3.1.4
  epoch: 1
  description: "large file support for git"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: MIT
  dependencies:
    runtime:
      - git
environment:
  contents:
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - go
      - git
pipeline:
  - uses: fetch
    with:
      uri: https://github.com/git-lfs/git-lfs/archive/v${{package.version}}.tar.gz
      expected-sha256: d7bfeb6f4c219c44773da4f93da28eb1e2e654efa4cd23294d9039247d8cde64
  - runs: |
      # mitigate CVE-2021-38561
      go get golang.org/x/text

      # mitigate CVE-2022-27191
      go get golang.org/x/crypto/ssh
  - runs: |
      make EXTRA_GO_FLAGS="-v -tags netcgo" GIT_LFS_SHA="v${{package.version}}" VERSION="v${{package.version}}"
  - runs: |
      install -Dm755 bin/git-lfs "${{targets.destdir}}"/usr/bin/git-lfs
  - uses: strip
---
package:
  name: git
  version: 2.38.1
  epoch: 0
  description: "distributed version control system"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: GPL-2.0-or-later
secfixes:
  2.38.1-r0:
    - CVE-2022-39253
    - CVE-2022-39260
environment:
  contents:
    packages:
      - wolfi-base
      - busybox
      - ca-certificates-bundle
      - build-base
      - curl-dev
      - expat-dev
      - openssl-dev
      - pcre2-dev
      - zlib-dev
pipeline:
  - uses: fetch
    with:
      uri: https://www.kernel.org/pub/software/scm/git/git-${{package.version}}.tar.xz
      expected-sha256: 97ddf8ea58a2b9e0fbc2508e245028ca75911bd38d1551616b148c1aa5740ad9
  - runs: |
      cat >> config.mak <<-EOF
      NO_GETTEXT=YesPlease
      NO_SVN_TESTS=YesPlease
      NO_REGEX=YesPlease
      NO_SYS_POLL_H=1
      ICONV_OMITS_BOM=Yes
      INSTALL_SYMLINKS=1
      USE_LIBPCRE2=YesPlease
      NO_PERL=YesPlease
      NO_PYTHON=YesPlease
      NO_TCLTK=YesPlease
      EOF
  - runs: |
      make prefix=/usr \
        CFLAGS="-O2 -Wall" \
        DESTDIR="${{targets.destdir}}" \
        INSTALLDIRS=vendor \
        install -j$(nproc)
  - runs: |
      mkdir -p "${{targets.destdir}}"/var/git
  - uses: strip
subpackages:
  - name: "git-daemon"
    description: "Git protocol daemon"
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/libexec/git-core

          for i in git-daemon git-http-backend git-shell; do
            mv "${{targets.destdir}}"/usr/libexec/git-core/$i "${{targets.subpkgdir}}"/usr/libexec/git-core/
          done

          mkdir -p "${{targets.subpkgdir}}"/usr/bin
          mv "${{targets.destdir}}"/usr/bin/git-shell "${{targets.subpkgdir}}"/usr/bin/
  - name: "git-email"
    description: "Git tools for email"
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/libexec/git-core

          for i in git-send-email git-imap-send; do
            mv "${{targets.destdir}}"/usr/libexec/git-core/$i "${{targets.subpkgdir}}"/usr/libexec/git-core/
          done
---
package:
  name: gmp
  version: 6.2.1
  epoch: 4
  description: "a library for arbitrary precision arithmetic"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: LGPL-3.0-or-later OR GPL-2.0-or-later
  dependencies:
    runtime:
secfixes:
  6.2.1-r4:
    - CVE-2021-43618
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/bootstrap/stage3
    keyring:
      - https://packages.wolfi.dev/bootstrap/stage3/wolfi-signing.rsa.pub
    packages:
      - wolfi-baselayout
      - busybox
      - build-base
      - ca-certificates-bundle
      - m4
      - texinfo
pipeline:
  - uses: fetch
    with:
      uri: https://gmplib.org/download/gmp/gmp-${{package.version}}.tar.xz
      expected-sha256: fd4829912cddd12f84181c3451cc752be224643e87fac497b69edddadc49b4f2
  - uses: patch
    with:
      patches: CVE-2021-43618.patch
  - runs: |
      ./configure \
        --host=$(uname -m)-pc-linux-gnu \
        --target=$(uname -m)-pc-linux-gnu \
        --prefix=/usr \
        --enable-cxx \
        --with-pic
  - uses: autoconf/make
  - uses: autoconf/make-install
  - name: 'Clean up documentation'
    runs: |
      rm -rf ${{targets.destdir}}/usr/share/info
subpackages:
  - name: "gmp-dev"
    description: "gmp headers"
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - gmp
---
package:
  name: go-stage0
  version: 1.19.1
  epoch: 0
  description: "bootstrap golang compiler built with Google-provided artifact"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: BSD-3-Clause
  dependencies:
    runtime:
      - build-base
      - bash
    provides:
      - go=1.19-r0
environment:
  contents:
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - bash
pipeline:
  - uses: fetch
    with:
      uri: https://go.dev/dl/go1.19.1.linux-amd64.tar.gz
      expected-sha256: acc512fbab4f716a8f97a8b3fbaa9ddd39606a28be6c2515ef7c6c6311acffde
      strip-components: 0
  # GOROOT cannot be the same as GOROOT_BOOTSTRAP.
  - runs: |
      mv go go1.19.1
  - uses: fetch
    with:
      uri: https://go.dev/dl/go1.19.1.src.tar.gz
      expected-sha256: 27871baa490f3401414ad793fba49086f6c855b1c584385ed7771e1204c7e179
      strip-components: 0
  - runs: |
      cd go/src
      env GOROOT_BOOTSTRAP=/home/build/go1.19.1 ./make.bash -v
  - runs: |
      cd go

      mkdir -p "${{targets.destdir}}"/usr/bin "${{targets.destdir}}"/usr/lib/go/bin "${{targets.destdir}}"/usr/share/doc/go

      for bin in go gofmt; do
        install -Dm755 bin/$bin "${{targets.destdir}}"/usr/lib/go/bin/$bin
        ln -s /usr/lib/go/bin/$bin "${{targets.destdir}}"/usr/bin/
      done

      cp -a pkg lib "${{targets.destdir}}"/usr/lib/go/
      cp -r doc misc "${{targets.destdir}}"/usr/share/doc/go
      cp -a src "${{targets.destdir}}"/usr/lib/go/

      rm -rf "${{targets.destdir}}"/usr/lib/go/pkg/obj
      rm -rf "${{targets.destdir}}"/usr/lib/go/pkg/bootstrap
      rm -f "${{targets.destdir}}"/usr/lib/go/pkg/tool/*/api

      # Remove tests from /usr/lib/go/src, not needed at runtime
      find "${{targets.destdir}}"/usr/lib/go/src \( -type f -a -name "*_test.go" \) \
        -exec rm -rf \{\} \+
      find "${{targets.destdir}}"/usr/lib/go/src \( -type d -a -name "testdata" \) \
        -exec rm -rf \{\} \+
      find "${{targets.destdir}}"/usr/lib/go/src \( -type f -a -name "*.rc" \) \
        -exec rm -rf \{\} \+
      find "${{targets.destdir}}"/usr/lib/go/src \( -type f -a -name "*.bat" \) \
        -exec rm -rf \{\} \+
  - uses: strip
subpackages:
  - name: "go-stage0-doc"
    description: "go stage0 documentation"
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/share
          mv "${{targets.destdir}}"/usr/share/doc "${{targets.subpkgdir}}"/usr/share/
---
package:
  name: go
  version: 1.19.3
  epoch: 0
  description: "bootstrap golang compiler built with Google-provided artifact"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: BSD-3-Clause
  dependencies:
    runtime:
      - build-base
      - bash
secfixes:
  1.19.3-r0:
    - CVE-2022-41716
environment:
  contents:
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - bash
      - go
pipeline:
  - uses: fetch
    with:
      uri: https://go.dev/dl/go${{package.version}}.src.tar.gz
      expected-sha256: 18ac263e39210bcf68d85f4370e97fb1734166995a1f63fb38b4f6e07d90d212
      strip-components: 0
  - runs: |
      cd go/src
      ./make.bash -v
  - runs: |
      cd go

      mkdir -p "${{targets.destdir}}"/usr/bin "${{targets.destdir}}"/usr/lib/go/bin "${{targets.destdir}}"/usr/share/doc/go

      for bin in go gofmt; do
        install -Dm755 bin/$bin "${{targets.destdir}}"/usr/lib/go/bin/$bin
        ln -s /usr/lib/go/bin/$bin "${{targets.destdir}}"/usr/bin/
      done

      cp -a pkg lib "${{targets.destdir}}"/usr/lib/go/
      cp -r doc misc "${{targets.destdir}}"/usr/share/doc/go
      cp -a src "${{targets.destdir}}"/usr/lib/go/

      rm -rf "${{targets.destdir}}"/usr/lib/go/pkg/obj
      rm -rf "${{targets.destdir}}"/usr/lib/go/pkg/bootstrap
      rm -f "${{targets.destdir}}"/usr/lib/go/pkg/tool/*/api

      # Remove tests from /usr/lib/go/src, not needed at runtime
      find "${{targets.destdir}}"/usr/lib/go/src \( -type f -a -name "*_test.go" \) \
        -exec rm -rf \{\} \+
      find "${{targets.destdir}}"/usr/lib/go/src \( -type d -a -name "testdata" \) \
        -exec rm -rf \{\} \+
      find "${{targets.destdir}}"/usr/lib/go/src \( -type f -a -name "*.rc" \) \
        -exec rm -rf \{\} \+
      find "${{targets.destdir}}"/usr/lib/go/src \( -type f -a -name "*.bat" \) \
        -exec rm -rf \{\} \+
  - uses: strip
subpackages:
  - name: "go-doc"
    description: "go documentation"
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/share
          mv "${{targets.destdir}}"/usr/share/doc "${{targets.subpkgdir}}"/usr/share/
---
package:
  name: gperf
  version: 3.1
  epoch: 0
  description: Perfect hash function generator.
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: GPL-3.0-or-later
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/os
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - automake
      - autoconf
pipeline:
  - uses: fetch
    with:
      expected-sha256: 588546b945bba4b70b6a3a616e80b4ab466e3f33024a352fc2198112cdbb3ae2
      uri: https://ftp.gnu.org/gnu/gperf/gperf-${{package.version}}.tar.gz
  - uses: autoconf/configure
  - uses: autoconf/make
  - uses: autoconf/make-install
subpackages:
  - name: gperf-doc
    pipeline:
      - uses: split/manpages
    description: gperf manpages
---
package:
  name: grep
  version: 3.7
  epoch: 2
  description: "GNU grep implementation"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: GPL-3.0-or-later
  dependencies:
    runtime:
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/bootstrap/stage3
    keyring:
      - https://packages.wolfi.dev/bootstrap/stage3/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
pipeline:
  - uses: fetch
    with:
      uri: https://ftp.gnu.org/gnu/grep/grep-${{package.version}}.tar.gz
      expected-sha256: c22b0cf2d4f6bbe599c902387e8058990e1eee99aef333a203829e5fd3dbb342
  - name: Configure
    runs: |
      ./configure \
         --host=$(uname -m)-pc-linux-gnu \
         --target=$(uname -m)-pc-linux-gnu \
         --prefix=/usr \
         --datadir=/usr/share
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
---
package:
  name: grype
  version: 0.50.2
  epoch: 1
  description: Vulnerability scanner for container images, filesystems, and SBOMs
  target-architecture:
    - all
  copyright:
    - license: Apache-2.0
      paths:
        - "*"
environment:
  contents:
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    repositories:
      - https://packages.wolfi.dev/os
    packages:
      - ca-certificates-bundle
      - busybox
      - go
pipeline:
  - uses: fetch
    with:
      uri: https://github.com/anchore/grype/archive/v${{package.version}}/grype-${{package.version}}.tar.gz
      expected-sha512: 528f521282bc952df805d89827bf9b347c3bbca5253e914b600db5aa3022b7d94c21fad37bd47ddc3fc75db8ae612a4cb31a06ec897400e388836fdbab3259ed
  - runs: |
      CGO_ENABLED=0 go build \
        -ldflags "-X github.com/anchore/grype/internal/version.version=${{package.version}}" \
        -o "${{targets.destdir}}/usr/bin/grype"
---
package:
  name: gzip
  version: 1.12
  epoch: 1
  description: "GNU data compression program"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: GPL-3.0-or-later
  dependencies:
    runtime:
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/bootstrap/stage3
    keyring:
      - https://packages.wolfi.dev/bootstrap/stage3/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
pipeline:
  - uses: fetch
    with:
      uri: https://ftp.gnu.org/gnu/gzip/gzip-${{package.version}}.tar.gz
      expected-sha256: 5b4fb14d38314e09f2fc8a1c510e7cd540a3ea0e3eb9b0420046b82c3bf41085
  - name: Configure
    runs: |
      export DEFS="NO_ASM"
      ./configure \
         --host=$(uname -m)-pc-linux-gnu \
         --target=$(uname -m)-pc-linux-gnu \
         --prefix=/usr \
         --datadir=/usr/share
  - uses: autoconf/make
  - uses: autoconf/make-install
  - runs: |
      mkdir -p ${{targets.destdir}}/bin

      for i in gzip gunzip; do
        mv ${{targets.destdir}}/usr/bin/${i} ${{targets.destdir}}/bin/${i}
        ln -s /bin/${i} ${{targets.destdir}}/usr/bin/${i}
      done

      ln -sf /bin/gunzip ${{targets.destdir}}/usr/bin/uncompress
  - uses: strip
---
package:
  name: help2man
  version: 1.49.2
  epoch: 0
  description: "Create simple man pages from --help output"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: GPL-3.0-or-later
  dependencies:
    runtime:
      - perl
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/bootstrap/stage3
    keyring:
      - https://packages.wolfi.dev/bootstrap/stage3/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - perl
pipeline:
  - uses: fetch
    with:
      uri: https://ftp.gnu.org/gnu/help2man/help2man-${{package.version}}.tar.xz
      expected-sha256: 9e2e0e213a7e0a36244eed6204d902b6504602a578b6ecd15268b1454deadd36
  - runs: |
      M4=/usr/bin/m4 ./configure \
        --prefix=/usr
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: "help2man-doc"
    description: "help2man documentation"
    pipeline:
      - uses: split/manpages
---
package:
  name: icu
  version: 71.1
  epoch: 0
  description: "International Components for Unicode library"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: MIT
  dependencies:
    runtime:
environment:
  contents:
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    repositories:
      - https://packages.wolfi.dev/os
    packages:
      - busybox
      - build-base
      - ca-certificates-bundle
  environment:
    ICU_DATA_FILTER_FILE: "./data-filter-en.json"
pipeline:
  - uses: fetch
    with:
      # TODO: cannot use package.version here since "71-1"/"71_1" are different from "71.1"
      uri: https://github.com/unicode-org/icu/releases/download/release-71-1/icu4c-71_1-src.tgz
      expected-sha512: 1fd2a20aef48369d1f06e2bb74584877b8ad0eb529320b976264ec2db87420bae242715795f372dbc513ea80047bc49077a064e78205cd5e8b33d746fd2a2912
  - runs: |
      # JSON-ified version of https://git.alpinelinux.org/aports/plain/main/icu/data-filter-en.yml?id=8db8f1a746ebc18ac3b56c91ed14224e424f57ec
      echo '{"localeFilter":{"filterType":"locale","includeChildren":false,"includelist":["en_US","en_GB"]},"featureFilters":{"brkitr_dictionaries":"exclude","brkitr_rules":{"filterType":"regex","excludelist":["^.*_cj$"]},"coll_tree":{"filterType":"language","includelist":["be","cs","de","el","en","es","ff","fr","ha","hu","ig","it","kk","ms","nl","pl","pt","ro","ru","tr","uk","xh","zu"]},"conversion_mappings":"exclude","stringprep":{"excludelist":["rfc3722","rfc3920node","rfc3920res"]}},"resourceFilters":[{"categories":["coll_tree"],"rules":["-/collations/emoji","-/collations/private-unihan"]},{"categories":["translit"],"rules":["-/","+/%%Parent","+/%%ALIAS","+/*/ASCII-Latin","+/*/Latin-ASCII","+/*/Accents-Any","+/*/Any-Accents","+/*/Publishing-Any","+/*/Any-Publishing","+/*/Cyrillic-Latin","+/*/Cyrl-Latn","+/*/Latin-Cyrillic","+/*/Latn-Cyrl","+/*/Greek-Latin","+/*/Grek-Latn","+/*/Greek-Latin/BGN","+/*/el-el_Latn/BGN","+/*/Latin-Greek","+/*/Latn-Grek","+/*/Russian-Latin/BGN","+/*/ru-ru_Latn/BGN","+/*/Latin-Russian/BGN","+/*/ru_Latn-ru/BGN","+/*/Ukrainian-Latin/BGN","+/*/uk-uk_Latn/BGN","+/*/de-ASCII","+/*/de-t-de-d0-ascii"]}],"collationUCAData":"implicithan"}' > ./source/data-filter-en.json
  - uses: autoconf/configure
    with:
      dir: source
      opts: |
        --build=$(uname -m)-pc-linux-gnu \
        --host=$(uname -m)-pc-linux-gnu \
        --sysconfdir=/etc \
        --with-data-packaging=archive \
        --disable-samples \
        --enable-static \
        --mandir=/usr/share/man
  - uses: autoconf/make-install
    with:
      dir: source
  - uses: strip
subpackages:
  - name: icu-dev
    description: icu development headers
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - icu
---
package:
  name: isl
  version: 0.24
  epoch: 2
  description: "an integer set library for the polyhedral model"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: MIT
  dependencies:
    runtime:
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/bootstrap/stage3
    keyring:
      - https://packages.wolfi.dev/bootstrap/stage3/wolfi-signing.rsa.pub
    packages:
      - wolfi-baselayout
      - busybox
      - build-base
      - ca-certificates-bundle
      - gmp-dev
pipeline:
  - uses: fetch
    with:
      uri: https://libisl.sourceforge.io/isl-${{package.version}}.tar.gz
      expected-sha256: 26e6e4d60ad59b3fff9948eb36743f0c874e124e410ef5bab930d0f546bc580d
  - runs: |
      ./configure \
        --host=$(uname -m)-pc-linux-gnu \
        --target=$(uname -m)-pc-linux-gnu \
        --prefix=/usr \
        --enable-shared
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: "isl-dev"
    description: "integer set library development headers"
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - isl
---
package:
  name: jq
  version: 1.6
  epoch: 0
  description: "a lightweight and flexible JSON processor"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: MIT
environment:
  contents:
    packages:
      - wolfi-base
      - busybox
      - ca-certificates-bundle
      - build-base
      - oniguruma-dev
pipeline:
  - uses: fetch
    with:
      uri: https://github.com/stedolan/jq/releases/download/jq-${{package.version}}/jq-${{package.version}}.tar.gz
      expected-sha256: 5de8c8e29aaa3fb9cc6b47bb27299f271354ebb72514e3accadc7d38b5bbaa72
  - uses: autoconf/configure
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: "jq-dev"
    description: "headers for libjq"
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - jq
  - name: "jq-doc"
    description: "jq documentation"
    pipeline:
      - uses: split/manpages
---
package:
  name: libarchive
  version: 3.6.1
  epoch: 1
  description: "multi-format archive and compression library"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: BSD-2-Clause
environment:
  contents:
    packages:
      - wolfi-base
      - busybox
      - ca-certificates-bundle
      - build-base
      - bzip2-dev
      - lz4-dev
      - zstd-dev
      - zlib-dev
      - xz-dev
      - acl-dev
      - attr-dev
      - openssl-dev
      - expat-dev
pipeline:
  - uses: fetch
    with:
      uri: http://libarchive.org/downloads/libarchive-${{package.version}}.tar.xz
      expected-sha256: 5a411aceb978f43e626f0c2d1812ddd8807b645ed892453acabd532376c148e6
  - uses: patch
    with:
      patches: 0003-libarchive-Do-not-include-sys-mount.h-when-linux-fs..patch
  - uses: autoconf/configure
    with:
      opts: --without-xml2
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: "libarchive-doc"
    description: "libarchive documentation"
    pipeline:
      - uses: split/manpages
      - uses: split/infodir
  - name: "libarchive-dev"
    description: "libarchive development headers"
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - libarchive
  - name: "libarchive-tools"
    description: "bsdtar and bsdcpio programs from libarchive"
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/bin
          mv "${{targets.destdir}}"/usr/bin/bsd* "${{targets.subpkgdir}}"/usr/bin/
---
package:
  name: libbsd
  version: 0.11.7
  epoch: 0
  description: commonly-used BSD functions not implemented by all libcs
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: BSD-3-Clause
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/os
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - automake
      - autoconf
      - libmd-dev
pipeline:
  - uses: fetch
    with:
      expected-sha256: 9baa186059ebbf25c06308e9f991fda31f7183c0f24931826d83aa6abd8a0261
      uri: https://libbsd.freedesktop.org/releases/libbsd-${{package.version}}.tar.xz
  - uses: autoconf/configure
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: libbsd-dev
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - libmd-dev
        - libbsd=${{package.version}}-${{package.epoch}}
    description: libbsd dev
  - name: libbsd-doc
    pipeline:
      - uses: split/manpages
    description: libbsd manpages
---
package:
  name: libcap
  version: 2.26
  epoch: 0
  description: "POSIX 1003.1e capabilities"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: BSD-3-Clause OR GPL-2.0-only
  dependencies:
    runtime:
environment:
  contents:
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    repositories:
      - https://packages.wolfi.dev/os
    packages:
      - ca-certificates-bundle
      - busybox
      - build-base
      - perl
pipeline:
  - uses: fetch
    with:
      uri: https://kernel.org/pub/linux/libs/security/linux-privs/libcap2/libcap-${{package.version}}.tar.xz
      expected-sha512: 1c2d59f007226405a924950b2c2090393527e06f0692a84e6463e33915a070df61a9070b8f30a624d5630ddd39290eac117e5d440577d1edd48510195b9d12f0
  - runs: |
      set -x
      make BUILD_CC=gcc CC=gcc lib=lib prefix=/usr DESTDIR="${{targets.destdir}}"
      make lib=/lib prefix=/usr RAISE_SETFCAP=no DESTDIR="${{targets.destdir}}" install
      chmod 755 "${{targets.destdir}}/usr/lib/libcap.so.${{package.version}}"
  - uses: strip
subpackages:
  - name: libcap-dev
    description: libcap development headers
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - libcap
        - libcap-utils
  - name: libcap-utils
    description: various utilities included with libcap
    pipeline:
      - runs: |
          set -x
          mkdir -p "${{targets.subpkgdir}}"/usr/sbin
          for i in capsh getcap getpcaps setcap; do
            mv "${{targets.destdir}}"/usr/sbin/$i "${{targets.subpkgdir}}"/usr/sbin/
          done
          rm -rf "${{targets.destdir}}/usr/sbin"
    dependencies:
      runtime:
        - libcap
  - name: libcap-doc
    description: libcap documentation
    pipeline:
      - uses: split/manpages
      - runs: |
          set -x
          rm -rf "${{targets.destdir}}/usr/share"
---
package:
  name: libedit
  version: 3.1
  epoch: 0
  description: "the NetBSD editline library"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: BSD-3-Clause
environment:
  contents:
    packages:
      - wolfi-base
      - busybox
      - ca-certificates-bundle
      - build-base
      - ncurses-dev
pipeline:
  - uses: fetch
    with:
      uri: https://www.thrysoee.dk/editline/libedit-20210910-${{package.version}}.tar.gz
      expected-sha256: 6792a6a992050762edcca28ff3318cdb7de37dccf7bc30db59fcd7017eed13c5
  - uses: autoconf/configure
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: "libedit-doc"
    description: "libedit documentation"
    pipeline:
      - uses: split/manpages
      - runs: |
          mv "${{targets.subpkgdir}}"/usr/share/man/man3/editline.3 "${{targets.subpkgdir}}"/usr/share/man/man3/libedit.3
          mv "${{targets.subpkgdir}}"/usr/share/man/man3/history.3 "${{targets.subpkgdir}}"/usr/share/man/man3/libedit-history.3
  - name: "libedit-dev"
    description: "libedit development headers"
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - libedit
        - ncurses-dev
---
package:
  name: libev
  version: 4.33
  epoch: 0
  description: "event dispatch library"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: BSD-2-Clause OR GPL-2.0-or-later
environment:
  contents:
    packages:
      - wolfi-base
      - busybox
      - ca-certificates-bundle
      - build-base
      - autoconf
      - automake
      - libtool
pipeline:
  - uses: fetch
    with:
      uri: http://dist.schmorp.de/libev/Attic/libev-${{package.version}}.tar.gz
      expected-sha256: 507eb7b8d1015fbec5b935f34ebed15bf346bed04a11ab82b8eee848c4205aea
  - uses: patch
    with:
      patches: libev-4.11-Add-pkgconfig-support.patch
  - runs: |
      autoreconf -vfi
  - uses: autoconf/configure
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: "libev-dev"
    description: "headers for libev"
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - libev
  - name: "libev-doc"
    description: "libev documentation"
    pipeline:
      - uses: split/manpages
---
package:
  name: libevent
  version: 2.1.12
  epoch: 0
  description: An event notification library
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: BSD-3-Clause
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/os
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - automake
      - autoconf
      - python3
      - python3-dev
      - openssl-dev
pipeline:
  - uses: fetch
    with:
      expected-sha256: 92e6de1be9ec176428fd2367677e61ceffc2ee1cb119035037a27d346b0403bb
      uri: https://github.com/libevent/libevent/releases/download/release-${{package.version}}-stable/libevent-${{package.version}}-stable.tar.gz
  - runs: |
      sed -i '1s|^#!/usr/bin/env python$|#!/usr/bin/python3|' event_rpcgen.py
      # help provides tracing work out correctly
      sed -i -e "s/@VERSION@/${{package.version}}-r${{package.epoch}}/" *.pc.in
  - uses: autoconf/configure
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: libevent-static
    description: libevent static library
    pipeline:
      - uses: split/static
  - name: libevent-dev
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - libevent
        - python3
    description: libevent dev
---
package:
  name: libffi
  version: 3.4.2
  epoch: 1
  description: "portable foreign function interface library"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: MIT
  dependencies:
    runtime:
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/bootstrap/stage3
    keyring:
      - https://packages.wolfi.dev/bootstrap/stage3/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - texinfo
pipeline:
  - uses: fetch
    with:
      uri: https://github.com/libffi/libffi/releases/download/v${{package.version}}/libffi-${{package.version}}.tar.gz
      expected-sha256: 540fb721619a6aba3bdeef7d940d8e9e0e6d2c193595bc243241b77ff9e93620
  - name: Configure
    runs: |
      ./configure \
         --host=$(uname -m)-pc-linux-gnu \
         --target=$(uname -m)-pc-linux-gnu \
         --prefix=/usr \
         --datadir=/usr/share \
         --enable-portable-binary \
         --enable-pax_emutramp \
         --disable-exec-static-tramp
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: "libffi-dev"
    description: "libffi headers"
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - libffi
---
package:
  name: libgcrypt
  version: 1.10.1
  epoch: 0
  description: General purpose crypto library based on the code used in GnuPG
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: LGPL-2.1-or-later
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/os
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - automake
      - autoconf
      - libgpg-error-dev
      - texinfo
pipeline:
  - uses: fetch
    with:
      expected-sha256: ef14ae546b0084cd84259f61a55e07a38c3b53afc0f546bffcef2f01baffe9de
      uri: https://www.gnupg.org/ftp/gcrypt/libgcrypt/libgcrypt-${{package.version}}.tar.bz2
  - uses: autoconf/configure
  - uses: autoconf/make
  - uses: autoconf/make-install
  - runs: |
      rm -f "${{targets.destdir}}"/usr/share/info/dir
  - uses: strip
subpackages:
  - name: libgcrypt-dev
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - libgcrypt
    description: libgcrypt dev
  - name: libgcrypt-doc
    pipeline:
      - uses: split/manpages
    description: libgcrypt manpages
---
package:
  name: libgpg-error
  version: 1.46
  epoch: 0
  description: Support library for libgcrypt
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: GPL-2.0-or-later LGPL-2.1-or-later
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/os
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - automake
      - autoconf
pipeline:
  - uses: fetch
    with:
      expected-sha256: b7e11a64246bbe5ef37748de43b245abd72cfcd53c9ae5e7fc5ca59f1c81268d
      uri: https://gnupg.org/ftp/gcrypt/libgpg-error/libgpg-error-${{package.version}}.tar.bz2
  - uses: autoconf/configure
    with:
      opts: |
        --disable-nls \
        --enable-static \
        --sysconfdir=/etc
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: libgpg-error-dev
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - libgpg-error
    description: libgpg-error dev
---
package:
  name: libice
  version: 1.0.10
  epoch: 0
  description: X11 Inter-Client Exchange library
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: X11
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/os
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - xorgproto
      - xtrans
      - util-macros
      - xmlto
      - check-dev
      - libtool
      - autoconf
      - automake
      - bash
pipeline:
  - uses: fetch
    with:
      expected-sha256: 6f86dce12cf4bcaf5c37dddd8b1b64ed2ddf1ef7b218f22b9942595fb747c348
      uri: https://www.x.org/releases/individual/lib/libICE-${{package.version}}.tar.bz2
  - uses: autoconf/configure
    with:
      opts: |
        --enable-ipv6 \
        --enable-docs \
        --with-xmlto \
        --without-fop
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: libice-static
    description: libice static library
    pipeline:
      - uses: split/static
  - name: libice-doc
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}/usr/share"
          mv "${{targets.destdir}}/usr/share/doc" "${{targets.subpkgdir}}/usr/share"
    description: libice manpages
  - name: libice-dev
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - libice
    description: libice dev
---
package:
  name: libmd
  version: 1.0.4
  epoch: 0
  description: Message Digest functions from BSD systems
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: Public Domain
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/os
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - automake
      - autoconf
pipeline:
  - uses: fetch
    with:
      expected-sha256: f51c921042e34beddeded4b75557656559cf5b1f2448033b4c1eec11c07e530f
      uri: https://archive.hadrons.org/software/libmd/libmd-${{package.version}}.tar.xz
  - uses: autoconf/configure
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: libmd-dev
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - libmd
    description: libmd dev
  - name: libmd-doc
    pipeline:
      - uses: split/manpages
    description: libmd manpages
---
package:
  name: libpaper
  version: 1.1.28
  epoch: 0
  description: Library for handling paper characteristics
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: GPL-2.0-only
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/os
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - automake
      - autoconf
      - libtool
pipeline:
  - uses: fetch
    with:
      expected-sha256: c8bb946ec93d3c2c72bbb1d7257e90172a22a44a07a07fb6b802a5bb2c95fddc
      uri: https://deb.debian.org/debian/pool/main/libp/libpaper/libpaper_${{package.version}}.tar.gz
  - runs: autoreconf -fi
  - uses: autoconf/configure
    with:
      opts: --disable-static
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: libpaper-dev
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - libpaper
    description: libpaper dev
  - name: libpaper-doc
    pipeline:
      - uses: split/manpages
    description: libpaper manpages
---
package:
  name: libpng
  version: 1.6.38
  epoch: 0
  description: Portable Network Graphics library
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: Libpng
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/os
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - automake
      - autoconf
      - zlib-dev
      - gawk
      - libtool
pipeline:
  - uses: fetch
    with:
      expected-sha256: e2b5e1b4329650992c041996cf1269681b341191dc07ffed816c555769cceb77
      uri: https://downloads.sourceforge.net/libpng/libpng-${{package.version}}.tar.gz
  - runs: autoreconf -vif
  - uses: autoconf/configure
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: libpng-doc
    pipeline:
      - uses: split/manpages
    description: libpng manpages
  - name: libpng-static
    description: libpng static library
    pipeline:
      - uses: split/static
  - name: libpng-utils
    pipeline:
      - runs: |
          mkdir -p ${{targets.subpkgdir}}/usr/share
          mv ${{targets.destdir}}/usr/bin ${{targets.subpkgdir}}/usr/
    description: libpng utils
  - name: libpng-dev
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - libpng
    description: libpng dev
---
package:
  name: libpthread-stubs
  version: 0.4
  epoch: 0
  description: Pthread functions stubs for platforms missing them
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: X11
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/os
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - automake
      - autoconf
pipeline:
  - uses: fetch
    with:
      expected-sha256: e4d05911a3165d3b18321cc067fdd2f023f06436e391c6a28dff618a78d2e733
      uri: https://xcb.freedesktop.org/dist/libpthread-stubs-${{package.version}}.tar.bz2
  - uses: autoconf/configure
  - uses: autoconf/make
  - uses: autoconf/make-install
---
package:
  name: libretls
  version: 3.5.2
  epoch: 0
  description: "port of libtls from libressl to openssl"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: 'ISC AND ( BSD-3-Clause OR MIT )'
  dependencies:
    runtime:
      - ca-certificates-bundle
environment:
  contents:
    packages:
      - wolfi-baselayout
      - busybox
      - ca-certificates-bundle
      - build-base
      - openssl-dev
pipeline:
  - uses: fetch
    with:
      uri: https://causal.agency/libretls/libretls-${{package.version}}.tar.gz
      expected-sha256: 59ce9961cb1b1a2859cacb9863eeccc3bbeadf014840a1c61a0ac12ad31bcc9e
  - uses: autoconf/configure
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: "libretls-dev"
    description: "libretls development headers"
    pipeline:
      - uses: split/dev
  - name: "libretls-doc"
    description: "libretls documentation"
    pipeline:
      - uses: split/manpages
---
package:
  name: libsm
  version: 1.2.3
  epoch: 0
  description: X11 Session Management library
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: MIT
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/os
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - automake
      - autoconf
      - libice-dev
      - xorgproto
      - xtrans
      # - util-linux-dev TODO let's do util-linux-dev later and enable the configure flag --with-libuuid below
      - util-macros
      - xmlto
      - bash
pipeline:
  - uses: fetch
    with:
      expected-sha256: 2d264499dcb05f56438dee12a1b4b71d76736ce7ba7aa6efbf15ebb113769cbb
      uri: https://www.x.org/releases/individual/lib/libSM-${{package.version}}.tar.bz2
  - uses: autoconf/configure
    with:
      opts: |
        --enable-docs \
        --with-xmlto \
        --without-fop
  # --with-libuuid TODO as above, would rather not build util-linux-dev yet
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: libsm-dev
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - libsm
    description: libsm dev
  - name: libsm-doc
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}/usr/share"
          mv "${{targets.destdir}}/usr/share/doc" "${{targets.subpkgdir}}/usr/share"
    description: libsm manpages
---
package:
  name: libtool
  version: 2.4.7
  epoch: 0
  description: "GNU libtool"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: LGPL-2.0-or-later AND GPL-2.0-or-later
  dependencies:
    runtime:
      - libltdl
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/bootstrap/stage3
    keyring:
      - https://packages.wolfi.dev/bootstrap/stage3/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - m4
      - help2man
pipeline:
  - uses: fetch
    with:
      uri: https://ftp.gnu.org/gnu/libtool/libtool-${{package.version}}.tar.xz
      expected-sha256: 4f7f217f057ce655ff22559ad221a0fd8ef84ad1fc5fcb6990cecc333aa1635d
  - uses: patch
    with:
      patches: libtool-fix-cross-compile.patch
  - runs: |
      M4=/usr/bin/m4 ./configure \
        --prefix=/usr
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: "libtool-doc"
    description: "libtool documentation"
    pipeline:
      - uses: split/manpages
  - name: "libltdl"
    description: "GNU libtool dynamic module loader"
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/lib
          mv "${{targets.destdir}}"/usr/lib/libltdl.so* "${{targets.subpkgdir}}"/usr/lib/
---
package:
  name: libusb
  version: 1.0.26
  epoch: 0
  description: Library that enables userspace access to USB devices
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: LGPL-2.0-or-later
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/os
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - automake
      - autoconf
      - linux-headers
      - libatomic
pipeline:
  - uses: fetch
    with:
      expected-sha256: 12ce7a61fc9854d1d2a1ffe095f7b5fac19ddba095c259e6067a46500381b5a5
      uri: https://github.com/libusb/libusb/releases/download/v${{package.version}}/libusb-${{package.version}}.tar.bz2
  - uses: autoconf/configure
    with:
      opts: |
        --disable-udev \
        --enable-static
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: libusb-dev
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - libusb
    description: libusb dev
---
package:
  name: libuv
  version: 1.44.2
  epoch: 1
  description: "cross-platform asynchronous I/O library"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: MIT AND ISC
environment:
  contents:
    packages:
      - wolfi-base
      - busybox
      - ca-certificates-bundle
      - build-base
pipeline:
  - uses: fetch
    with:
      uri: https://dist.libuv.org/dist/v${{package.version}}/libuv-v${{package.version}}-dist.tar.gz
      expected-sha256: 8ff28f6ac0d6d2a31d2eeca36aff3d7806706c7d3f5971f5ee013ddb0bdd2e9e
  - uses: autoconf/configure
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: "libuv-dev"
    description: "libuv development headers"
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - libuv
---
package:
  name: libx11
  version: 1.8.1
  epoch: 0
  description: X11 client-side library
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: custom:XFREE86
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/os
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - automake
      - autoconf
      - libxcb-dev
      - xtrans
      - xorgproto
      - util-macros
      - xmlto
pipeline:
  - uses: fetch
    with:
      expected-sha256: 1bc41aa1bbe01401f330d76dfa19f386b79c51881c7bbfee9eb4e27f22f2d9f7
      uri: https://www.x.org/releases/individual/lib/libX11-${{package.version}}.tar.xz
  - uses: autoconf/configure
    with:
      opts: |
        --with-xcb \
        --disable-thread-safety-constructor
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: libx11-static
    description: libx11 static library
    pipeline:
      - uses: split/static
  - name: libx11-doc
    pipeline:
      - uses: split/manpages
    description: libx11 manpages
  - name: libx11-dev
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - libx11
        - libxcb-dev
        - xtrans
    description: libx11 dev
---
package:
  name: libxau
  version: 1.0.10
  epoch: 0
  description: X11 authorisation library
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: MIT
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/os
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - automake
      - autoconf
      - xorgproto
      - util-macros
pipeline:
  - uses: fetch
    with:
      expected-sha256: 8be6f292334d2f87e5b919c001e149a9fdc27005d6b3e053862ac6ebbf1a0c0a
      uri: https://www.x.org/releases/individual/lib/libXau-${{package.version}}.tar.xz
  - uses: autoconf/configure
    with:
      opts: --sysconfdir=/etc
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: libxau-dev
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - libxau
        - xorgproto
    description: libxau dev
  - name: libxau-doc
    pipeline:
      - uses: split/manpages
    description: libxau manpages
---
package:
  name: libxcb
  version: 1.15
  epoch: 0
  description: X11 client-side library
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: MIT
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/os
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - automake
      - autoconf
      - libxau-dev
      - xcb-proto
      - libpthread-stubs
      - libxdmcp-dev
      - libxslt
      - python3
pipeline:
  - uses: fetch
    with:
      expected-sha256: cc38744f817cf6814c847e2df37fcb8997357d72fa4bcbc228ae0fe47219a059
      uri: https://xorg.freedesktop.org/archive/individual/lib/libxcb-${{package.version}}.tar.xz
  - uses: autoconf/configure
    with:
      opts: |
        --enable-xkb \
        --enable-xinput \
        --disable-xprint
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: libxcb-static
    description: libxcb static library
    pipeline:
      - uses: split/static
  - name: libxcb-doc
    pipeline:
      - uses: split/manpages
    description: libxcb manpages
  - name: libxcb-dev
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - libxcb
        - libxau-dev
        - xcb-proto
        - libxdmcp-dev
    description: libxcb dev
---
package:
  name: libxdmcp
  version: 1.1.3
  epoch: 0
  description: X11 Display Manager Control Protocol library
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: MIT
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/os
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - automake
      - autoconf
      - xorgproto
      - libbsd-dev
      - util-macros
      - xmlto
pipeline:
  - uses: fetch
    with:
      expected-sha256: 20523b44aaa513e17c009e873ad7bbc301507a3224c232610ce2e099011c6529
      uri: https://www.x.org/releases/individual/lib/libXdmcp-${{package.version}}.tar.bz2
  - uses: autoconf/configure
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: libxdmcp-doc
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}/usr/share"
          mv "${{targets.destdir}}/usr/share/doc" "${{targets.subpkgdir}}/usr/share"
    description: libxdmcp manpages
  - name: libxdmcp-dev
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - libxdmcp
    description: libxdmcp dev
---
package:
  name: libxext
  version: 1.3.4
  epoch: 0
  description: X11 miscellaneous extensions library
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: MIT
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/os
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - automake
      - autoconf
      - libxau-dev
      - libx11-dev
      - xorgproto
      - util-macros
      - xmlto
pipeline:
  - uses: fetch
    with:
      expected-sha256: 59ad6fcce98deaecc14d39a672cf218ca37aba617c9a0f691cac3bcd28edf82b
      uri: https://www.x.org/releases/individual/lib/libXext-${{package.version}}.tar.bz2
  - uses: autoconf/configure
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: libxext-doc
    pipeline:
      - uses: split/manpages
    description: libxext manpages
  - name: libxext-dev
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - libxext
        - libxau-dev
    description: libxext dev
---
package:
  name: libxfixes
  version: 6.0.0
  epoch: 0
  description: X11 miscellaneous 'fixes' extension library
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: custom
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/os
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - automake
      - autoconf
      - xorgproto
      - libx11-dev
      - util-macros
pipeline:
  - uses: fetch
    with:
      expected-sha256: a7c1a24da53e0b46cac5aea79094b4b2257321c621b258729bc3139149245b4c
      uri: https://www.x.org/releases/individual/lib/libXfixes-${{package.version}}.tar.bz2
  - uses: autoconf/configure
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: libxfixes-dev
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - libxfixes
    description: libxfixes dev
  - name: libxfixes-doc
    pipeline:
      - uses: split/manpages
    description: libxfixes manpages
---
package:
  name: libxi
  version: 1.8
  epoch: 0
  description: X11 Input extension library
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: MIT AND X11
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/os
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - automake
      - autoconf
      - xorgproto
      - libx11-dev
      - libxext-dev
      - libxfixes-dev
      - util-macros
      - xmlto
      - bash
pipeline:
  - uses: fetch
    with:
      expected-sha256: 2ed181446a61c7337576467870bc5336fc9e222a281122d96c4d39a3298bba00
      uri: https://www.x.org/releases/individual/lib/libXi-${{package.version}}.tar.bz2
  - uses: autoconf/configure
    with:
      opts: |
        --with-xmlto \
        --without-fop \
        --disable-static
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: libxi-dev
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - libxi
        - libxfixes-dev
    description: libxi dev
  - name: libxi-doc
    pipeline:
      - uses: split/manpages
    description: libxi manpages
---
package:
  name: libxml2
  version: 2.10.3
  epoch: 0
  description: XML parsing library, version 2
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: MIT
secfixes:
  2.10.3-r0:
    - CVE-2022-40303
    - CVE-2022-40304
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/os
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - automake
      - autoconf
      - zlib-dev
      - xz-dev
      - python3-dev
      - python3
pipeline:
  - uses: fetch
    with:
      expected-sha256: 5d2cc3d78bec3dbe212a9d7fa629ada25a7da928af432c93060ff5c17ee28a9c
      uri: https://download.gnome.org/sources/libxml2/2.10/libxml2-${{package.version}}.tar.xz
  - uses: autoconf/configure
    with:
      opts: |
        PYTHON=/usr/bin/python3 \
        --with-lzma \
        --with-zlib
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: libxml2-doc
    pipeline:
      - uses: split/manpages
    description: libxml2 manpages
  - name: libxml2-py3
    pipeline:
      - runs: |
          mkdir -p ${{targets.subpkgdir}}/usr/lib
          mv ${{targets.destdir}}/usr/lib/python3* ${{targets.subpkgdir}}/usr/lib
    description: libxml2 python3 bindings
  - name: libxml2-utils
    pipeline:
      - runs: |
          mkdir -p ${{targets.subpkgdir}}/usr/bin
          mv ${{targets.destdir}}/usr/bin ${{targets.subpkgdir}}/usr
    description: libxml2 utils
  - name: libxml2-dev
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - libxml2
        - zlib-dev
        - xz-dev
        - libxml2-utils
    description: libxml2 dev
---
package:
  name: libxrandr
  version: 1.5.2
  epoch: 0
  description: X11 RandR extension library
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: MIT
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/os
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - automake
      - autoconf
      - xorgproto
      - libxext-dev
      - libx11-dev
      - libxrender-dev
      - util-macros
pipeline:
  - uses: fetch
    with:
      expected-sha256: 8aea0ebe403d62330bb741ed595b53741acf45033d3bda1792f1d4cc3daee023
      uri: https://www.x.org/releases/individual/lib/libXrandr-${{package.version}}.tar.bz2
  - uses: autoconf/configure
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: libxrandr-dev
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - libxrandr
        - libxext-dev
    description: libxrandr dev
  - name: libxrandr-doc
    pipeline:
      - uses: split/manpages
    description: libxrandr manpages
---
package:
  name: libxrender
  version: 0.9.10
  epoch: 0
  description: X Rendering Extension client library
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: custom
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/os
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - automake
      - autoconf
      - xorgproto
      - libx11-dev
      - util-macros
pipeline:
  - uses: fetch
    with:
      expected-sha256: c06d5979f86e64cabbde57c223938db0b939dff49fdb5a793a1d3d0396650949
      uri: https://www.x.org/releases/individual/lib/libXrender-${{package.version}}.tar.bz2
  - uses: autoconf/configure
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: libxrender-dev
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - libxrender
    description: libxrender dev
  - name: libxrender-doc
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}/usr/share"
          mv "${{targets.destdir}}/usr/share/doc" "${{targets.subpkgdir}}/usr/share"
    description: libxrender manpages
---
package:
  name: libxslt
  version: 1.1.37
  epoch: 0
  description: XML stylesheet transformation library
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: custom
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/os
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - automake
      - autoconf
      - libtool
      - libxml2-dev
      - libgcrypt-dev
      - libgpg-error-dev
pipeline:
  - uses: fetch
    with:
      expected-sha256: 3a4b27dc8027ccd6146725950336f1ec520928f320f144eb5fa7990ae6123ab4
      uri: https://download.gnome.org/sources/libxslt/1.1/libxslt-${{package.version}}.tar.xz
  - uses: autoconf/configure
    with:
      opts: --with-python=no
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: libxslt-dev
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - libxslt
    description: libxslt dev
  - name: libxslt-doc
    pipeline:
      - uses: split/manpages
    description: libxslt manpages
---
package:
  name: libxt
  version: 1.2.1
  epoch: 0
  description: X11 toolkit intrinsics library
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: custom
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/os
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - automake
      - autoconf
      - libsm-dev
      - libice-dev
      - libx11-dev
      - util-macros
      - xorgproto
pipeline:
  - uses: fetch
    with:
      expected-sha256: 679cc08f1646dbd27f5e48ffe8dd49406102937109130caab02ca32c083a3d60
      uri: https://www.x.org/releases/individual/lib/libXt-${{package.version}}.tar.bz2
  - uses: autoconf/configure
    with:
      opts: --disable-static
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: libxt-dev
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - libxt
        - libsm-dev
    description: libxt dev
  - name: libxt-doc
    pipeline:
      - uses: split/manpages
    description: libxt manpages
---
package:
  name: libxtst
  version: 1.2.4
  epoch: 0
  description: X11 Testing -- Resource extension library
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: custom
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/os
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - automake
      - autoconf
      - xorgproto
      - libx11-dev
      - libxext-dev
      - libxi-dev
      - util-macros
pipeline:
  - uses: fetch
    with:
      expected-sha256: 84f5f30b9254b4ffee14b5b0940e2622153b0d3aed8286a3c5b7eeb340ca33c8
      uri: https://www.x.org/releases/individual/lib/libXtst-${{package.version}}.tar.xz
  - uses: autoconf/configure
    with:
      opts: --disable-static
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: libxtst-dev
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - libxtst
        - libxi # required by X11/extensions/XTest.h
    description: libxtst dev
  - name: libxtst-doc
    pipeline:
      - uses: split/manpages
    description: libxtst manpages
---
package:
  name: linenoise
  version: 1.0
  epoch: 0
  description: "minimal alternative to GNU readline"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: MIT
  dependencies:
    runtime:
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/bootstrap/stage3
    keyring:
      - https://packages.wolfi.dev/bootstrap/stage3/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
pipeline:
  - uses: fetch
    with:
      uri: https://github.com/antirez/linenoise/archive/${{package.version}}/linenoise-${{package.version}}.tar.gz
      expected-sha256: f5054a4fe120d43d85427cf58af93e56b9bb80389d507a9bec9b75531a340014
  - uses: patch
    with:
      patches: build-shared-lib.patch
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: "linenoise-dev"
    description: "linenoise headers"
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - linenoise
---
package:
  name: linux-headers
  version: 5.16.9
  epoch: 2
  description: "the Linux kernel headers (cross compilation)"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: GPL-3.0-or-later
  dependencies:
    runtime:
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/bootstrap/stage3
    keyring:
      - https://packages.wolfi.dev/bootstrap/stage3/wolfi-signing.rsa.pub
    packages:
      - wolfi-baselayout
      - busybox
      - build-base
      - scanelf
      - ca-certificates-bundle
pipeline:
  - uses: fetch
    with:
      uri: https://www.kernel.org/pub/linux/kernel/v5.x/linux-${{package.version}}.tar.gz
      expected-sha256: ca84521580c9e2a5d7648a6b98150780b0e65bc8fac85c3a07d00b1b9aa68ad3
  - runs: |
      make mrproper
  - runs: |
      make headers
      find usr/include -name '.*' -delete
      rm usr/include/Makefile

      # Copy to cross-sysroot
      mkdir -p ${{targets.destdir}}/usr/include
      cp -rv usr/include/* ${{targets.destdir}}/usr/include/
---
package:
  name: llvm15
  version: 15.0.3
  epoch: 0
  description: "low-level virtual machine - core frameworks"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: Apache-2.0
environment:
  contents:
    packages:
      - wolfi-base
      - busybox
      - ca-certificates-bundle
      - build-base
      - cmake
      - samurai
      - binutils-dev
      - libffi-dev
      - zlib-dev
      - libxml2-dev
      - pkgconf
      - python3
pipeline:
  - uses: fetch
    with:
      uri: https://github.com/llvm/llvm-project/releases/download/llvmorg-${{package.version}}/llvm-${{package.version}}.src.tar.xz
      expected-sha256: c39aec729662416dcbf0bfe53a9786b34e7d93d02908a0779a2f6d83ad0a4a27
  - uses: fetch
    with:
      uri: https://github.com/llvm/llvm-project/releases/download/llvmorg-${{package.version}}/cmake-${{package.version}}.src.tar.xz
      expected-sha256: 21cf3f52c53dc8b8972122ae35a5c18de09c7df693b48b5cd8553c3e3fed090d
      strip-components: 0
  - runs: |
      mv cmake-${{package.version}}.src ../cmake
  - runs: |
      ffi_include_dir="$(pkg-config --cflags-only-I libffi | sed 's|^-I||g')"

      cmake -B build -G Ninja -Wno-dev \
        -DCMAKE_BUILD_TYPE=Release \
        -DCMAKE_INSTALL_PREFIX=/usr/lib/llvm15 \
        -DFFI_INCLUDE_DIR="${ffi_include_dir}" \
        -DLLVM_BINUTILS_INCDIR=/usr/include \
        -DLLVM_BUILD_DOCS=OFF \
        -DLLVM_BUILD_EXAMPLES=OFF \
        -DLLVM_BUILD_EXTERNAL_COMPILER_RT=ON \
        -DLLVM_BUILD_LLVM_DYLIB=ON \
        -DLLVM_BUILD_TESTS=OFF \
        -DLLVM_DEFAULT_TARGET_TRIPLE="$(uname -m)-unknown-linux-gnu" \
        -DLLVM_ENABLE_ASSERTIONS=OFF \
        -DLLVM_ENABLE_FFI=ON \
        -DLLVM_ENABLE_LIBCXX=OFF \
        -DLLVM_ENABLE_PIC=ON \
        -DLLVM_ENABLE_RTTI=ON \
        -DLLVM_ENABLE_SPHINX=OFF \
        -DLLVM_ENABLE_TERMINFO=ON \
        -DLLVM_ENABLE_ZLIB=ON \
        -DLLVM_INSTALL_UTILS=ON \
        -DLLVM_HOST_TRIPLE="$(uname -m)-unknown-linux-gnu" \
        -DLLVM_INCLUDE_EXAMPLES=OFF \
        -DLLVM_LINK_LLVM_DYLIB=ON \
        -DLLVM_APPEND_VC_REV=OFF \
        -DLLVM_INCLUDE_BENCHMARKS=OFF
  - runs: |
      cmake --build build --target llvm-tblgen
  - runs: |
      cmake --build build
  - runs: |
      DESTDIR="${{targets.destdir}}" cmake --install build
  - runs: |
      cd "${{targets.destdir}}"/usr/lib/llvm15

      mkdir -p "${{targets.destdir}}"/usr/include
      mv include "${{targets.destdir}}"/usr/include/llvm15
      ln -s ../../include/llvm15 include
  - runs: |
      cd "${{targets.destdir}}"/usr/lib/llvm15

      mkdir -p "${{targets.destdir}}"/usr/lib/cmake
      mv lib/cmake/llvm "${{targets.destdir}}"/usr/lib/cmake/llvm15
      ln -s ../../../cmake/$pkgname lib/cmake/llvm
  - uses: strip
subpackages:
  - name: "llvm15-dev"
    description: "headers for llvm15"
    pipeline:
      - uses: split/dev
  - name: "libLLVM-15"
    description: "LLVM 15 runtime library"
    pipeline:
      - runs: |
          soname="libLLVM-15.so"
          sonamefull="libLLVM-${{package.version}}.so"

          mkdir -p "${{targets.subpkgdir}}"/usr/lib
          mv "${{targets.destdir}}"/usr/lib/llvm15/lib/$soname "${{targets.subpkgdir}}"/usr/lib/
          rm -f "${{targets.destdir}}"/usr/lib/llvm15/lib/$sonamefull
          ln -s $soname "${{targets.subpkgdir}}"/usr/lib/$sonamefull

          mkdir -p "${{targets.subpkgdir}}"/usr/lib/llvm15/lib
          ln -s ../../$soname "${{targets.subpkgdir}}"/usr/lib/llvm15/lib/$soname
          ln -s ../../$soname "${{targets.subpkgdir}}"/usr/lib/llvm15/lib/$sonamefull
---
package:
  name: lua5.3-lzlib
  version: 0.4.3
  epoch: 0
  description: "zlib binding for lua"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: MIT
  dependencies:
    runtime:
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/bootstrap/stage3
    keyring:
      - https://packages.wolfi.dev/bootstrap/stage3/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - lua5.3-dev
      - zlib-dev
      - pkgconf
pipeline:
  - uses: fetch
    with:
      uri: https://github.com/LuaDist/lzlib/archive/${{package.version}}.tar.gz
      expected-sha256: cbb0cac5825e940b4ea2f31a336d2aaf6db39847d456920afd8e443804420dbb
  - runs: |
      set -x
      make CFLAGS="$CFLAGS \\$(pkg-config --debug --cflags lua5.3)" \
           LDFLAGS="$LDFLAGS \\$(pkg-config --debug --libs lua5.3)"
  - runs: |
      install -Dm755 zlib.so "${{targets.destdir}}"/usr/lib/lua/5.3/zlib.so
      install -Dm644 gzip.lua "${{targets.destdir}}"/usr/share/lua/5.3/gzip.lua
---
package:
  name: lua5.3
  version: 5.3.6
  epoch: 2
  description: "powerful lightweight programming language"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: MIT
  dependencies:
    runtime:
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/bootstrap/stage3
    keyring:
      - https://packages.wolfi.dev/bootstrap/stage3/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - libtool
      - autoconf
      - automake
      - linenoise-dev
pipeline:
  - uses: fetch
    with:
      uri: https://www.lua.org/ftp/lua-${{package.version}}.tar.gz
      expected-sha256: fc5fd69bb8736323f026672b1b7235da613d7177e72558893a0bdcd320466d60
  - uses: patch
    with:
      patches: lua-5.3-make.patch
  - uses: patch
    with:
      patches: lua-5.3-module_paths.patch
  - uses: patch
    with:
      patches: linenoise.patch
  - runs: |
      cat >configure.ac <<-EOF
        top_builddir=.
        AC_INIT(src/luaconf.h)
        AC_PROG_LIBTOOL
        AC_OUTPUT
      EOF
      libtoolize --force --install
      aclocal
      autoconf
      sed -i '/#define LUA_USE_READLINE/d' src/luaconf.h
  - runs: |
      ./configure --prefix=/usr
  - runs: |
      make -C src V=5.3 \
        CFLAGS="$CFLAGS -DLUA_USE_LINUX -DLUA_COMPAT_5_2 -DLUA_USE_LINENOISE" \
        SYSLDFLAGS="$LDFLAGS" \
        RPATH="/usr/lib" \
        LIB_LIBS="-lpthread -lm -ldl -llinenoise" \
        alpine_all
  - runs: |
      make V=5.3 \
        INSTALL_TOP="${{targets.destdir}}"/usr \
        INSTALL_INC="${{targets.destdir}}"/usr/include/lua5.3 \
        INSTALL_LIB="${{targets.destdir}}"/usr/lib/lua5.3 \
        alpine_install

      chmod 755 "${{targets.destdir}}"/usr/lib/lua5.3/*.so*
  - runs: |
      for i in "${{targets.destdir}}"/usr/bin/* ; do
        mv "$i" "$i"5.3
      done

      for i in "${{targets.destdir}}"/usr/lib/lua5.3/*.so.*; do
        ln -s lua5.3/${i##*/} "${{targets.destdir}}"/usr/lib/${i##*/}
      done

      for i in lua luac; do
        install -D -m 644 doc/$i.1 "${{targets.destdir}}"/usr/share/man/man1/"$i""$_luaver".1
      done

      install -d "${{targets.destdir}}"/usr/lib/pkgconfig
      cat > "${{targets.destdir}}"/usr/lib/pkgconfig/lua5.3.pc <<-EOF
      # lua.pc -- pkg-config data for Lua
      V=5.3
      R=${{package.version}}
      prefix=/usr
      INSTALL_BIN=\${prefix}/bin
      INSTALL_INC=\${prefix}/include
      INSTALL_LIB=\${prefix}/lib
      INSTALL_MAN=\${prefix}/man/man1
      INSTALL_LMOD=\${prefix}/share/lua/\${V}
      INSTALL_CMOD=\${prefix}/lib/lua/\${V}
      exec_prefix=\${prefix}
      libdir=\${exec_prefix}/lib/${{package.name}}
      includedir=\${exec_prefix}/include/${{package.name}}

      Name: Lua
      Description: An extensible extension language
      Version: ${{package.version}}
      Requires:
      Libs: -L\${libdir} -llua -lm
      Cflags: -I\${includedir}
      EOF
  - uses: strip
subpackages:
  - name: "lua5.3-doc"
    description: "lua documentation"
    pipeline:
      - uses: split/manpages
  - name: "lua5.3-dev"
    description: "lua development headers"
    pipeline:
      - uses: split/dev
---
package:
  name: lz4
  version: 1.9.4
  epoch: 0
  description: "lossless high performance compression algorithm"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: BSD-2-Clause AND GPL-2.0-only
environment:
  contents:
    packages:
      - wolfi-base
      - busybox
      - ca-certificates-bundle
      - build-base
pipeline:
  - uses: fetch
    with:
      uri: https://github.com/lz4/lz4/archive/refs/tags/v${{package.version}}.tar.gz
      expected-sha256: 0b0e3aa07c8c063ddf40b082bdf7e37a1562bda40a0ff5272957f3e987e0e54b
  - runs: |
      make -j$(nproc) CC=$(uname -m)-pc-linux-gnu-gcc
  - runs: |
      make install PREFIX="/usr" DESTDIR="${{targets.destdir}}"
  - uses: strip
subpackages:
  - name: "lz4-doc"
    description: "lz4 documentation"
    pipeline:
      - uses: split/manpages
      - uses: split/infodir
  - name: "lz4-dev"
    description: "lz4 development headers"
    pipeline:
      - uses: split/dev
  - name: "liblz4-1"
    description: "lz4 runtime libraries"
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/lib
          mv "${{targets.destdir}}"/usr/lib/liblz4.so.* "${{targets.subpkgdir}}"/usr/lib/
---
package:
  name: m4
  version: 1.4.19
  epoch: 2
  description: "GNU macro processor"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: bzip2-1.0.6
  dependencies:
    runtime:
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/bootstrap/stage3
    keyring:
      - https://packages.wolfi.dev/bootstrap/stage3/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
pipeline:
  - uses: fetch
    with:
      uri: https://ftp.gnu.org/gnu/m4/m4-${{package.version}}.tar.gz
      expected-sha256: 3be4a26d825ffdfda52a56fc43246456989a3630093cced3fbddf4771ee58a70
  - name: Configure
    runs: |
      ./configure \
        --prefix=/usr \
        --host=$(uname -m)-pc-linux-gnu
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
---
package:
  name: make
  version: 4.3
  epoch: 1
  description: "GNU make"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: GPL-3.0-or-later
  dependencies:
    runtime:
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/bootstrap/stage3
    keyring:
      - https://packages.wolfi.dev/bootstrap/stage3/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
pipeline:
  - uses: fetch
    with:
      uri: https://ftp.gnu.org/gnu/make/make-${{package.version}}.tar.gz
      expected-sha256: e05fdde47c5f7ca45cb697e973894ff4f5d79e13b750ed57d7b66d8defc78e19
  - name: Configure
    runs: |
      ./configure \
         --host=$(uname -m)-pc-linux-gnu \
         --target=$(uname -m)-pc-linux-gnu \
         --prefix=/usr \
         --datadir=/usr/share \
         --without-guile
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
---
package:
  name: maven
  version: 3.8.6
  epoch: 0
  description: A Java project management and project comprehension tool.
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: Apache-2.0
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/os
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    packages:
      - ca-certificates-bundle
      - build-base
      - busybox
pipeline:
  - uses: fetch
    with:
      expected-sha256: c7047a48deb626abf26f71ab3643d296db9b1e67f1faa7d988637deac876b5a9
      uri: https://archive.apache.org/dist/maven/maven-3/${{package.version}}/binaries/apache-maven-${{package.version}}-bin.tar.gz
  - runs: |2
      mkdir -p ${{targets.destdir}}/usr/share/java/maven
      mkdir -p ${{targets.destdir}}/usr/share/java/maven/bin
      mkdir -p ${{targets.destdir}}/usr/share/java/maven/boot
      mkdir -p ${{targets.destdir}}/usr/share/java/maven/lib

      install -m644 -Dt ${{targets.destdir}}/usr/share/java/maven/bin ./bin/*.conf
      install -m644 -Dt ${{targets.destdir}}/usr/share/java/maven/boot ./boot/*.jar
      install -m644 -Dt ${{targets.destdir}}/usr/share/java/maven/lib ./lib/*.jar
      cp -Rp ./conf ${{targets.destdir}}/usr/share/java/maven/

      mkdir -p ${{targets.destdir}}/usr/bin

      install -m755 -Dt ${{targets.destdir}}/usr/share/java/maven/bin ./bin/mvn
      ln -sf /usr/share/java/maven/bin/mvn ${{targets.destdir}}/usr/bin/mvn

      install -m755 -Dt ${{targets.destdir}}/usr/share/java/maven/bin ./bin/mvnDebug
      ln -sf /usr/share/java/maven/bin/mvnDebug ${{targets.destdir}}/usr/bin/mvnDebug

      install -m755 -Dt ${{targets.destdir}}/usr/share/java/maven/bin ./bin/mvnyjp
      ln -sf /usr/share/java/maven/bin/mvnyjp ${{targets.destdir}}/usr/bin/mvnyjp

      mkdir ${{targets.destdir}}/etc
      cat > ${{targets.destdir}}/etc/mavenrc <<-EOF
      M2_HOME="/usr/share/java/maven"
      EOF
---
package:
  name: meson
  version: 0.63.3
  epoch: 0
  description: Fast and user friendly build system
  target-architecture:
    - all
  copyright:
    - paths:
        - '*'
      attestation: TODO
      license: Apache-2.0
  dependencies:
    runtime:
      - python3
      - samurai
environment:
  contents:
    packages:
      - busybox
      - ca-certificates-bundle
      - py3-setuptools
      - python3
      - samurai
pipeline:
  - uses: fetch
    with:
      expected-sha256: 519c0932e1a8b208741f0fdce90aa5c0b528dd297cf337009bf63539846ac056
      uri: https://github.com/mesonbuild/meson/releases/download/${{package.version}}/meson-${{package.version}}.tar.gz
  - runs: python3 setup.py build
  - runs: python3 setup.py install --prefix=/usr --root=${{targets.destdir}}
  - uses: strip
subpackages:
  - name: meson-doc
    pipeline:
      - uses: split/manpages
    description: meson manpages
---
package:
  name: mpc
  version: 1.2.1
  epoch: 2
  description: "multiple-precision C library"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: LGPL-3.0-or-later
  dependencies:
    runtime:
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/bootstrap/stage3
    keyring:
      - https://packages.wolfi.dev/bootstrap/stage3/wolfi-signing.rsa.pub
    packages:
      - wolfi-baselayout
      - busybox
      - build-base
      - ca-certificates-bundle
      - gmp-dev
      - mpfr-dev
pipeline:
  - uses: fetch
    with:
      uri: https://ftp.gnu.org/gnu/mpc/mpc-${{package.version}}.tar.gz
      expected-sha256: 17503d2c395dfcf106b622dc142683c1199431d095367c6aacba6eec30340459
  - runs: |
      EGREP=egrep ./configure \
        --host=$(uname -m)-pc-linux-gnu \
        --target=$(uname -m)-pc-linux-gnu \
        --prefix=/usr \
        --enable-shared
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: "mpc-dev"
    description: "multiple-precision C library headers"
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - mpc
---
package:
  name: mpdecimal
  version: 2.5.1
  epoch: 1
  description: "complete implementation of the general decimal arithmetic specification"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: MIT
  dependencies:
    runtime:
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/bootstrap/stage3
    keyring:
      - https://packages.wolfi.dev/bootstrap/stage3/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
pipeline:
  - uses: fetch
    with:
      uri: https://www.bytereef.org/software/mpdecimal/releases/mpdecimal-${{package.version}}.tar.gz
      expected-sha256: 9f9cd4c041f99b5c49ffb7b59d9f12d95b683d88585608aa56a6307667b2b21f
  - name: Configure
    runs: |
      ./configure \
         --host=$(uname -m)-pc-linux-gnu \
         --target=$(uname -m)-pc-linux-gnu \
         --prefix=/usr
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: "mpdecimal-dev"
    description: "mpdecimal headers"
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - mpdecimal
---
package:
  name: mpfr
  version: 4.1.0
  epoch: 3
  description: "multiple-precision floating-point library"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: LGPL-3.0-or-later
  dependencies:
    runtime:
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/bootstrap/stage3
    keyring:
      - https://packages.wolfi.dev/bootstrap/stage3/wolfi-signing.rsa.pub
    packages:
      - wolfi-baselayout
      - busybox
      - build-base
      - ca-certificates-bundle
      - texinfo
      - gmp-dev
pipeline:
  - uses: fetch
    with:
      uri: https://www.mpfr.org/mpfr-${{package.version}}/mpfr-${{package.version}}.tar.xz
      expected-sha256: 0c98a3f1732ff6ca4ea690552079da9c597872d30e96ec28414ee23c95558a7f
  - runs: |
      ./configure \
        --host=$(uname -m)-pc-linux-gnu \
        --target=$(uname -m)-pc-linux-gnu \
        --prefix=/usr \
        --enable-shared
  - uses: autoconf/make
  - uses: autoconf/make-install
  - name: 'Clean up documentation'
    runs: |
      rm -rf ${{targets.destdir}}/usr/share/info
subpackages:
  - name: "mpfr-dev"
    description: "mpfr headers"
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - mpfr
---
package:
  name: ncurses
  version: 6.3
  epoch: 2
  description: "console display library"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: MIT
  dependencies:
    runtime:
      - ncurses-terminfo-base
secfixes:
  6.3-r0:
    - CVE-2022-29458
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/bootstrap/stage3
    keyring:
      - https://packages.wolfi.dev/bootstrap/stage3/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - ncurses
pipeline:
  - uses: fetch
    with:
      #      uri: https://invisible-mirror.net/archives/ncurses/current/ncurses-${{package.version}}-20220820.tgz
      uri: https://distfiles.alpinelinux.org/distfiles/edge/ncurses-${{package.version}}-20220820.tgz
      expected-sha256: 7b810b01f71609fd31107a0b7794d0940d3ecc10c98ba19e83749419ba0934b9
  - name: Configure
    runs: |
      ./configure \
        --prefix=/usr \
        --host=$(uname -m)-pc-linux-gnu \
        --mandir=/usr/share/man \
        --without-ada \
        --without-tests \
        --disable-termcap \
        --disable-rpath-hack \
        --disable-stripping \
        --with-pkg-config-libdir=/usr/lib/pkgconfig \
        --without-cxx-binding \
        --with-terminfo-dirs="/etc/terminfo:/usr/share/terminfo:/lib/terminfo:/usr/lib/terminfo" \
        --enable-pc-files \
        --with-shared \
        --enable-widec \
        --with-xterm-kbs=DEL
  - uses: autoconf/make
  - uses: autoconf/make-install
  - name: 'Set up development files'
    runs: |
      for lib in ncurses ncurses++ form panel menu; do
        ln -s ${lib}w.pc ${{targets.destdir}}/usr/lib/pkgconfig/${lib}.pc
        ln -s lib${lib}w.a ${{targets.destdir}}/usr/lib/lib${lib}.a
        echo "INPUT(-l${lib}w)" > ${{targets.destdir}}/usr/lib/lib${lib}.so
      done

      ln -s libncurses.a ${{targets.destdir}}/usr/lib/libcurses.a
      ln -s libncurses.so ${{targets.destdir}}/usr/lib/libcurses.so
      echo 'INPUT(-lncursesw)' > ${{targets.destdir}}/usr/lib/libcursesw.so
  - uses: strip
subpackages:
  - name: "ncurses-dev"
    description: "ncurses headers"
    pipeline:
      - uses: split/dev
      - runs: |
          mv "${{targets.destdir}}"/usr/lib/lib*.so "${{targets.subpkgdir}}"/usr/lib/
    dependencies:
      runtime:
        - ncurses
  - name: "ncurses-doc"
    description: "ncurses documentation"
    pipeline:
      - uses: split/manpages
  - name: "ncurses-terminfo-base"
    description: "descriptions of common terminals"
    pipeline:
      # TODO(kaniini): This would be a good usecase for a capture pipeline
      # operator in Melange.
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/etc/terminfo/a
          mv "${{targets.destdir}}"/usr/share/terminfo/a/alacritty "${{targets.subpkgdir}}"/etc/terminfo/a
          mv "${{targets.destdir}}"/usr/share/terminfo/a/ansi "${{targets.subpkgdir}}"/etc/terminfo/a

          mkdir -p "${{targets.subpkgdir}}"/etc/terminfo/d
          mv "${{targets.destdir}}"/usr/share/terminfo/d/dumb "${{targets.subpkgdir}}"/etc/terminfo/d

          mkdir -p "${{targets.subpkgdir}}"/etc/terminfo/g
          mv "${{targets.destdir}}"/usr/share/terminfo/g/gnome* "${{targets.subpkgdir}}"/etc/terminfo/g

          mkdir -p "${{targets.subpkgdir}}"/etc/terminfo/k
          mv "${{targets.destdir}}"/usr/share/terminfo/k/konsole* "${{targets.subpkgdir}}"/etc/terminfo/k

          mkdir -p "${{targets.subpkgdir}}"/etc/terminfo/l
          mv "${{targets.destdir}}"/usr/share/terminfo/l/linux "${{targets.subpkgdir}}"/etc/terminfo/l

          mkdir -p "${{targets.subpkgdir}}"/etc/terminfo/p
          mv "${{targets.destdir}}"/usr/share/terminfo/p/putty* "${{targets.subpkgdir}}"/etc/terminfo/p

          mkdir -p "${{targets.subpkgdir}}"/etc/terminfo/s
          mv "${{targets.destdir}}"/usr/share/terminfo/s/screen* "${{targets.subpkgdir}}"/etc/terminfo/s
          mv "${{targets.destdir}}"/usr/share/terminfo/s/st-* "${{targets.subpkgdir}}"/etc/terminfo/s
          mv "${{targets.destdir}}"/usr/share/terminfo/s/sun "${{targets.subpkgdir}}"/etc/terminfo/s

          mkdir -p "${{targets.subpkgdir}}"/etc/terminfo/t
          mv "${{targets.destdir}}"/usr/share/terminfo/t/terminator "${{targets.subpkgdir}}"/etc/terminfo/t
          mv "${{targets.destdir}}"/usr/share/terminfo/t/terminology* "${{targets.subpkgdir}}"/etc/terminfo/t
          mv "${{targets.destdir}}"/usr/share/terminfo/t/tmux* "${{targets.subpkgdir}}"/etc/terminfo/t

          mkdir -p "${{targets.subpkgdir}}"/etc/terminfo/v
          mv "${{targets.destdir}}"/usr/share/terminfo/v/vt1* "${{targets.subpkgdir}}"/etc/terminfo/v
          mv "${{targets.destdir}}"/usr/share/terminfo/v/vt2* "${{targets.subpkgdir}}"/etc/terminfo/v
          mv "${{targets.destdir}}"/usr/share/terminfo/v/vt52 "${{targets.subpkgdir}}"/etc/terminfo/v
          mv "${{targets.destdir}}"/usr/share/terminfo/v/vte* "${{targets.subpkgdir}}"/etc/terminfo/v

          mkdir -p "${{targets.subpkgdir}}"/etc/terminfo/x
          mv "${{targets.destdir}}"/usr/share/terminfo/x/xterm* "${{targets.subpkgdir}}"/etc/terminfo/x
  - name: "ncurses-terminfo"
    description: "other terminal descriptions"
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/share
          mv "${{targets.destdir}}"/usr/share/terminfo "${{targets.subpkgdir}}"/usr/share
---
package:
  name: nghttp2
  version: 1.49.0
  epoch: 0
  description: "experimental HTTP/2 client, server and library"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: MIT
environment:
  contents:
    packages:
      - wolfi-base
      - busybox
      - ca-certificates-bundle
      - build-base
      - libev-dev
      - openssl-dev
      - zlib-dev
      - c-ares-dev
pipeline:
  - uses: fetch
    with:
      uri: https://github.com/nghttp2/nghttp2/releases/download/v${{package.version}}/nghttp2-${{package.version}}.tar.xz
      expected-sha256: b0cfd492bbf0b131c472e8f6501c9f4ee82b51b68130f47b278c0b7c9848a66e
  - uses: autoconf/configure
    with:
      opts: --enable-app
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: "nghttp2-dev"
    description: "headers for nghttp2"
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - nghttp2
  - name: "nghttp2-doc"
    description: "documentation for nghttp2"
    pipeline:
      - uses: split/manpages
  - name: "libnghttp2-14"
    description: "nghttp2 client library"
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/lib
          mv "${{targets.destdir}}"/usr/lib/libnghttp2.so.* "${{targets.subpkgdir}}"/usr/lib/
---
package:
  name: nodejs
  version: 18.12.1
  epoch: 0
  description: "JavaScript runtime built on V8 engine - LTS version"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: MIT
environment:
  contents:
    packages:
      - brotli-dev
      - c-ares-dev
      - icu-dev
      - linux-headers
      - nghttp2-dev
      - openssl-dev
      - python3
      - py3-jinja2
      - samurai
      - zlib-dev
      - wolfi-base
      - busybox
      - ca-certificates-bundle
      - build-base
pipeline:
  - uses: fetch
    with:
      uri: https://nodejs.org/dist/v${{package.version}}/node-v${{package.version}}.tar.gz
      expected-sha256: ba8174dda00d5b90943f37c6a180a1d37c861d91e04a4cb38dc1c0c74981c186
  - name: Configure and build
    runs: |
      # Add defines recommended in libuv readme.
      common_flags="-D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64"

      # Compiling with O2 instead of Os increases binary size by ~10%
      # (53.1 MiB -> 58.6 MiB), but also increases performance by ~20%
      # according to v8/web-tooling-benchmark. Node.js is quite huge anyway;
      # there are better options for size constrained environments.
      export CFLAGS="${CFLAGS/-Os/-O2} $common_flags"
      export CXXFLAGS="${CXXFLAGS/-Os/-O2} $common_flags"
      export CPPFLAGS="${CPPFLAGS/-Os/-O2} $common_flags"
      python3 configure.py --prefix=/usr \
        --shared-brotli \
        --shared-zlib \
        --shared-openssl \
        --shared-cares \
        --shared-nghttp2 \
        --ninja \
        --openssl-use-def-ca-store \
        --with-icu-default-data-dir=$(icu-config --icudatadir) \
        --with-intl=system-icu \
        --without-corepack

        make BUILDTYPE=Release
  - uses: autoconf/make
  - uses: autoconf/make-install
  - runs: |
      make DESTDIR="$${{targets.destdir}}" install
  - uses: strip
---
package:
  name: oniguruma
  version: 6.9.8
  epoch: 0
  description: "a regular expressions library"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: BSD-2-Clause
environment:
  contents:
    packages:
      - wolfi-base
      - busybox
      - ca-certificates-bundle
      - build-base
      - automake
      - autoconf
      - libtool
pipeline:
  - uses: fetch
    with:
      uri: https://github.com/kkos/oniguruma/archive/v${{package.version}}.tar.gz
      expected-sha256: 26372720bab6733c869a9eb69377f73971138dc5e3eff4a81f5ba8aea5435fb2
  - name: Run autoreconf
    runs: |
      autoreconf -vfi
  - uses: autoconf/configure
    with:
      opts: --enable-posix-api
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: "oniguruma-dev"
    description: "oniguruma headers"
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - oniguruma
---
package:
  name: openjdk-11
  version: 11.0.17.8
  epoch: 0
  description:
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation:
      license: GPL-2.0-only
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/os
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - automake
      - autoconf
      - file
      - freetype-dev
      - cups-dev
      - libx11-dev
      - libxext-dev
      - libxrender-dev
      - libxrandr-dev
      - libxtst-dev
      - libxt-dev
      - alsa-lib-dev
      - libffi-dev
      - bash
      - zip
      - fontconfig-dev
      - libxi-dev
pipeline:
  - uses: fetch
    with:
      uri: https://github.com/adoptium/temurin11-binaries/releases/download/jdk-11.0.16.1%2B1/OpenJDK11U-jdk_x64_linux_hotspot_11.0.16.1_1.tar.gz
      expected-sha256: 5f6b513757d386352cf91514ed5859d1ab59364b4453e1f1c57152ba2039b8e2
      strip-components: 0
  - uses: fetch
    with:
      uri: https://github.com/adoptium/temurin11-binaries/releases/download/jdk-11.0.17%2B8/OpenJDK11U-jdk-sources_11.0.17_8.tar.gz
      expected-sha256: 0e403992d3ea664df8c10b4c3e5b71d6c02ee3dddd8b474b05bab3fb2c525cd5
  - runs: chmod +x configure
  - uses: autoconf/configure
    with:
      opts: |
        --with-boot-jdk=./jdk-11.0.16.1+1 \
        --with-vendor-name=wolfi \
        --with-vendor-url=https://wolfi.dev \
        --with-vendor-bug-url=https://github.com/wolfi-dev/os/issues \
        --with-version-opt="wolfi-r${{package.epoch}}" \
        --disable-warnings-as-errors \
        --disable-precompiled-headers \
        --enable-dtrace=no \
        --with-zlib=system \
        --with-native-debug-symbols=none \
        --with-jvm-variants=server \
        --with-debug-level=release \
        --with-jtreg=no  \
        --with-libpng=system \
        --with-jvm-variants=server \
        --with-debug-level=release
  # TODO revisit below args
  #         --with-libjpeg=system \
  #         --with-giflib=system \
  #         --with-lcms=system \
  - runs: make images
  - runs: |
      mkdir -p ${{targets.destdir}}/usr/lib/jvm/openjdk
      cp -r ./build/linux-*-server-release/images/jdk/* ${{targets.destdir}}/usr/lib/jvm/openjdk

      mkdir -p ${{targets.destdir}}/usr/bin
      ln -sf /usr/lib/jvm/openjdk/bin/java ${{targets.destdir}}/usr/bin/java
subpackages:
  - name: openjdk-11-jre
    pipeline:
      - runs: |
          # generate JRE via jlink

          mkdir -p ${{targets.subpkgdir}}/usr/lib/jvm
          ${{targets.destdir}}/usr/lib/jvm/openjdk/bin/jlink \
            --no-header-files \
            --no-man-pages \
            --compress=2 \
            --add-modules ALL-MODULE-PATH \
            --output ${{targets.subpkgdir}}/usr/lib/jvm/openjdk-jre

          mkdir -p ${{targets.subpkgdir}}/usr/bin
          ln -sf /usr/lib/jvm/openjdk-jre/bin/java ${{targets.subpkgdir}}/usr/bin/java
        description: OpenJDK 11 (JRE)
      - name: openjdk-11-jre-doc
        pipeline:
          - runs: |
              mkdir -p ${{targets.subpkgdir}}/usr/share
              mv  ${{targets.destdir}}/usr/lib/jvm/openjdk/man ${{targets.subpkgdir}}/usr/share
        description: OpenJDK 11 manpages
---
package:
  name: openjdk-17
  version: 17.0.5.8
  epoch: 0
  description:
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation:
      license: GPL-2.0-only
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/os
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - automake
      - autoconf
      - file
      - freetype-dev
      - cups-dev
      - libx11-dev
      - libxext-dev
      - libxrender-dev
      - libxrandr-dev
      - libxtst-dev
      - libxt-dev
      - alsa-lib-dev
      - libffi-dev
      - bash
      - zip
      - fontconfig-dev
      - libxi-dev
pipeline:
  - uses: fetch
    with:
      uri: https://github.com/adoptium/temurin16-binaries/releases/download/jdk-16.0.2%2B7/OpenJDK16U-jdk_x64_linux_hotspot_16.0.2_7.tar.gz
      expected-sha256: 323d6d7474a359a28eff7ddd0df8e65bd61554a8ed12ef42fd9365349e573c2c
      strip-components: 0
  - uses: fetch
    with:
      uri: https://github.com/adoptium/temurin17-binaries/releases/download/jdk-17.0.5%2B8/OpenJDK17U-jdk-sources_17.0.5_8.tar.gz
      expected-sha256: d72b23fcd805a0bc56b113b658ede140be44ca19d1058704f6ac93d803663155
  - uses: fetch
    with:
      uri: https://github.com/google/googletest/archive/release-1.8.1.tar.gz
      expected-sha256: 9bf1fe5182a604b4135edc1a425ae356c9ad15e9b23f9f12a02e80184c3a249c
      strip-components: 0
  - runs: chmod +x configure
  - uses: autoconf/configure
    with:
      opts: |
        --with-boot-jdk=./jdk-16.0.2+7 \
        --with-vendor-name=wolfi \
        --with-vendor-url=https://wolfi.dev \
        --with-vendor-bug-url=https://github.com/wolfi-dev/os/issues \
        --with-version-opt="wolfi-r${{package.epoch}}" \
        --with-gtest=./googletest-release-1.8.1 \
        --disable-warnings-as-errors \
        --disable-precompiled-headers \
        --enable-dtrace=no \
        --with-zlib=system \
        --with-native-debug-symbols=none \
        --disable-warnings-as-errors \
        --disable-precompiled-headers \
        --with-jvm-variants=server \
        --with-debug-level=release \
        --with-jtreg=no  \
        --with-libpng=system
  # TODO revisit below args
  #         --with-libjpeg=system \
  #         --with-giflib=system \
  #         --with-lcms=system \
  - runs: make jdk-image
  - runs: |
      mkdir -p ${{targets.destdir}}/usr/lib/jvm/openjdk
      cp -r ./build/linux-*-server-release/images/jdk/* ${{targets.destdir}}/usr/lib/jvm/openjdk

      mkdir -p ${{targets.destdir}}/usr/bin
      ln -sf /usr/lib/jvm/openjdk/bin/java ${{targets.destdir}}/usr/bin/java
subpackages:
  - name: openjdk-17-jre
    pipeline:
      - runs: |
          # generate JRE via jlink

          mkdir -p ${{targets.subpkgdir}}/usr/lib/jvm

          ${{targets.destdir}}/usr/lib/jvm/openjdk/bin/jlink \
            --no-header-files \
            --no-man-pages \
            --compress=2 \
            --add-modules ALL-MODULE-PATH \
            --output ${{targets.subpkgdir}}/usr/lib/jvm/openjdk-jre

          mkdir -p ${{targets.subpkgdir}}/usr/bin
          ln -sf /usr/lib/jvm/openjdk-jre/bin/java ${{targets.subpkgdir}}/usr/bin/java
    description: OpenJDK 17 (JRE)
  - name: openjdk-17-doc
    pipeline:
      - runs: |
          mkdir -p ${{targets.subpkgdir}}/usr/share
          mv  ${{targets.destdir}}/usr/lib/jvm/openjdk/man ${{targets.subpkgdir}}/usr/share
    description: OpenJDK 17 manpages
---
package:
  name: openssh
  version: 9.0_p1
  epoch: 0
  description: "the OpenBSD SSH implementation"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: ISC
  dependencies:
    runtime:
      - openssh-client
      - openssh-sftp-server
      - openssh-server
environment:
  contents:
    packages:
      - wolfi-baselayout
      - busybox
      - ca-certificates-bundle
      - build-base
      - openssl-dev
      - zlib-dev
      - libedit-dev
pipeline:
  - uses: fetch
    with:
      uri: https://ftp.openbsd.org/pub/OpenBSD/OpenSSH/portable/openssh-9.0p1.tar.gz
      expected-sha256: 03974302161e9ecce32153cfa10012f1e65c8f3750f573a73ab1befd5972a28a
  - name: Configure
    runs: |
      ./configure \
         --host=$(uname -m)-pc-linux-gnu \
         --target=$(uname -m)-pc-linux-gnu \
         --prefix=/usr \
         --datadir=/usr/share \
         --sysconfdir=/etc/ssh \
         --libexecdir=/usr/lib/ssh \
         --with-pid-dir=/run \
         --with-mantype=doc \
         --with-cflags="-O2 -D_FORTIFY_SOURCE=2 -Wall" \
         --disable-utmp \
         --disable-wtmp \
         --disable-lastlog \
         --disable-strip \
         --with-privsep-path=/var/empty \
         --with-xauth=/usr/bin/xauth \
         --with-default-path='/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin' \
         --with-privsep-user=sshd \
         --with-ssl-engine \
         --with-libedit
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: "openssh-doc"
    description: "OpenSSH documentation"
    pipeline:
      - uses: split/manpages
  - name: "openssh-keygen"
    description: "OpenSSH key generator"
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/bin
          mv "${{targets.destdir}}"/usr/bin/ssh-keygen "${{targets.subpkgdir}}"/usr/bin/
  - name: "openssh-keyscan"
    description: "OpenSSH key scanner"
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/bin
          mv "${{targets.destdir}}"/usr/bin/ssh-keyscan "${{targets.subpkgdir}}"/usr/bin/
  - name: "openssh-keysign"
    description: "OpenSSH key signing tool"
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/lib/ssh
          mv "${{targets.destdir}}"/usr/lib/ssh/ssh-keysign "${{targets.subpkgdir}}"/usr/lib/ssh/
  - name: "openssh-sftp-server"
    description: "OpenSSH SFTP server"
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/lib/ssh
          mv "${{targets.destdir}}"/usr/lib/ssh/sftp-server "${{targets.subpkgdir}}"/usr/lib/ssh/
  - name: "openssh-pkcs11-helper"
    description: "PKCS11 helper for OpenSSH"
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/lib/ssh
          mv "${{targets.destdir}}"/usr/lib/ssh/ssh-pkcs11-helper "${{targets.subpkgdir}}"/usr/lib/ssh/
  - name: "openssh-sk-helper"
    description: "Security key helper for OpenSSH"
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/lib/ssh
          mv "${{targets.destdir}}"/usr/lib/ssh/ssh-sk-helper "${{targets.subpkgdir}}"/usr/lib/ssh/
  - name: "openssh-client"
    description: "OpenSSH client"
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr
          mv "${{targets.destdir}}"/usr/bin "${{targets.subpkgdir}}"/usr/

          mkdir -p "${{targets.subpkgdir}}"/etc/ssh
          mv "${{targets.destdir}}"/etc/ssh/moduli "${{targets.subpkgdir}}"/etc/ssh/
          mv "${{targets.destdir}}"/etc/ssh/ssh_config "${{targets.subpkgdir}}"/etc/ssh/
  - name: "openssh-server"
    description: "OpenSSH server"
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/sbin
          mv "${{targets.destdir}}"/usr/sbin/sshd "${{targets.subpkgdir}}"/usr/sbin/

          mkdir -p "${{targets.subpkgdir}}"/etc
          mv "${{targets.destdir}}"/etc/ssh "${{targets.subpkgdir}}"/etc/
    dependencies:
      runtime:
        - openssh-keygen
---
package:
  name: openssl
  version: 3.0.7
  epoch: 0
  description: "the OpenSSL cryptography suite"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: Apache-2.0
  dependencies:
    runtime:
secfixes:
  3.0.7-r0:
    - CVE-2022-3358
    - CVE-2022-3602
    - CVE-2022-3786
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/bootstrap/stage3
    keyring:
      - https://packages.wolfi.dev/bootstrap/stage3/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - perl
      - build-base
pipeline:
  - uses: fetch
    with:
      uri: https://www.openssl.org/source/openssl-${{package.version}}.tar.gz
      expected-sha256: 83049d042a260e696f62406ac5c08bf706fd84383f945cf21bd61e9ed95c396e
  - name: Configure and build
    runs: |
      export CC=$(uname -m)-pc-linux-gnu-gcc
      export CXX=$(uname -m)-pc-linux-gnu-g++
      export CPP=$(uname -m)-pc-linux-gnu-cpp

      perl ./Configure \
         linux-x86_64 \
         --prefix=/usr \
         --libdir=lib \
         --openssldir=/etc/ssl \
         enable-ktls \
         shared \
         no-zlib \
         no-async \
         no-comp \
         no-idea \
         no-mdc2 \
         no-rc5 \
         no-ec2m \
         no-sm2 \
         no-sm4 \
         no-ssl3 \
         no-seed \
         no-weak-ssl-ciphers \
         -Wa,--noexecstack
      make -j$(nproc)
  - uses: autoconf/make-install
  - runs: |
      rm ${{targets.destdir}}/usr/bin/c_rehash
  - uses: strip
subpackages:
  - name: "openssl-doc"
    description: "OpenSSL documentation"
    pipeline:
      - uses: split/manpages
      - runs: |
          mv "${{targets.destdir}}"/usr/share/doc "${{targets.subpkgdir}}"/usr/share
  - name: "libcrypto3"
    description: "OpenSSL libcrypto library"
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/lib
          mv "${{targets.destdir}}"/usr/lib/libcrypto.so.3 "${{targets.subpkgdir}}"/usr/lib
  - name: "libssl3"
    description: "OpenSSL libssl library"
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/lib
          mv "${{targets.destdir}}"/usr/lib/libssl.so.3 "${{targets.subpkgdir}}"/usr/lib
  - name: "openssl-dev"
    description: "OpenSSL headers"
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - libcrypto3
        - libssl3
---
package:
  name: patch
  version: 2.7.6
  epoch: 3
  description: "GNU patch"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: GPL-3.0-or-later
  dependencies:
    runtime:
secfixes:
  2.7.6-r3:
    - CVE-2019-20633
    - CVE-2018-1000156
    - CVE-2019-13638
    - CVE-2018-20969
    - CVE-2019-13636
    - CVE-2018-6951
    - CVE-2018-6952
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/bootstrap/stage3
    keyring:
      - https://packages.wolfi.dev/bootstrap/stage3/wolfi-signing.rsa.pub
    packages:
      - wolfi-baselayout
      - busybox
      - ca-certificates-bundle
      - build-base
      - autoconf
      - automake
      - libtool
pipeline:
  - uses: fetch
    with:
      uri: https://ftp.gnu.org/gnu/patch/patch-${{package.version}}.tar.gz
      expected-sha256: 8cf86e00ad3aaa6d26aca30640e86b0e3e1f395ed99f189b06d4c9f74bc58a4e
  - uses: patch
    with:
      patches: CVE-2018-6951.patch
  - uses: patch
    with:
      patches: CVE-2018-6952.patch
  - uses: patch
    with:
      patches: 0001-Allow-input-files-to-be-missing-for-ed-style-patches.patch
  - uses: patch
    with:
      patches: 0002-Fix-arbitrary-command-execution-in-ed-style-patches-.patch
  - uses: patch
    with:
      patches: CVE-2019-13636.patch
  - uses: patch
    with:
      patches: CVE-2019-13638.patch
  - uses: patch
    with:
      patches: CVE-2019-20633.patch
  - runs: |
      autoreconf -vfi
  - name: Configure
    runs: |
      ./configure \
         --host=$(uname -m)-pc-linux-gnu \
         --target=$(uname -m)-pc-linux-gnu \
         --prefix=/usr \
         --datadir=/usr/share
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
---
package:
  name: pax-utils
  version: 1.3.4
  epoch: 2
  description: "ELF related utilities for 32-bit and 64-bit binaries"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: GPL-2.0-only
  dependencies:
    runtime:
      - scanelf
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/bootstrap/stage3
    keyring:
      - https://packages.wolfi.dev/bootstrap/stage3/wolfi-signing.rsa.pub
    packages:
      - wolfi-baselayout
      - busybox
      - ca-certificates-bundle
      - build-base
      - xz
pipeline:
  - uses: fetch
    with:
      uri: https://dev.gentoo.org/~xen0n/distfiles/pax-utils-${{package.version}}.tar.xz
      expected-sha256: 8baed2f9c5ae8e0cda1b9c75990864101afc64fad0a4616e10f3ff8ef891040b
  - runs: |
      make -j$(nproc) USE_CAP=no CC="$(uname -m)-pc-linux-gnu-gcc"
  - uses: autoconf/make-install
  - runs: |
      rm -f "${{targets.destdir}}"/usr/bin/lddtree
subpackages:
  - name: "scanelf"
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/bin
          mv "${{targets.destdir}}"/usr/bin/scanelf "${{targets.subpkgdir}}"/usr/bin/scanelf
---
package:
  name: pcre2
  version: 10.40
  epoch: 0
  description: "perl-compatible regular expression library"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: BSD-3-Clause
secfixes:
  10.40-r0:
    - CVE-2022-1586
    - CVE-2022-1587
environment:
  contents:
    packages:
      - wolfi-base
      - busybox
      - ca-certificates-bundle
      - build-base
      - libedit-dev
      - zlib-dev
pipeline:
  - uses: fetch
    with:
      uri: https://github.com/PCRE2Project/pcre2/releases/download/pcre2-${{package.version}}/pcre2-${{package.version}}.tar.bz2
      expected-sha256: 14e4b83c4783933dc17e964318e6324f7cae1bc75d8f3c79bc6969f00c159d68
  - uses: autoconf/configure
    with:
      opts: --enable-jit --enable-pcre2-16 --enable-pcre2-32 --enable-pcre2grep-libz --enable-pcre2test-libedit
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: "pcre2-doc"
    description: "pcre2 documentation"
    pipeline:
      - uses: split/manpages
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/share
          mv "${{targets.destdir}}"/usr/share/doc "${{targets.subpkgdir}}"/usr/share/
  - name: "pcre2-dev"
    description: "pcre2 development headers"
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - libpcre2-8-0
        - libpcre2-16-0
        - libpcre2-32-0
        - libpcre2-posix-3
        - libedit-dev
        - zlib-dev
  - name: "libpcre2-8-0"
    description: "pcre2 runtime library 8-bit"
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/lib
          mv "${{targets.destdir}}"/usr/lib/libpcre2-8* "${{targets.subpkgdir}}"/usr/lib/
  - name: "libpcre2-16-0"
    description: "pcre2 runtime library 16-bit"
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/lib
          mv "${{targets.destdir}}"/usr/lib/libpcre2-16* "${{targets.subpkgdir}}"/usr/lib/
  - name: "libpcre2-32-0"
    description: "pcre2 runtime library 32-bit"
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/lib
          mv "${{targets.destdir}}"/usr/lib/libpcre2-32* "${{targets.subpkgdir}}"/usr/lib/
  - name: "libpcre2-posix-3"
    description: "pcre2 runtime library (posix)"
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/lib
          mv "${{targets.destdir}}"/usr/lib/libpcre2-posix* "${{targets.subpkgdir}}"/usr/lib/
---
package:
  name: perl-test-pod
  version: 1.52
  epoch: 0
  description: check for POD errors in files
  target-architecture:
    - noarch
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: GPL-1.0-or-later OR Artistic-1.0-Perl
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/os
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - automake
      - autoconf
      - perl
pipeline:
  - uses: fetch
    with:
      expected-sha256: 60a8dbcc60168bf1daa5cc2350236df9343e9878f4ab9830970a5dde6fe8e5fc
      uri: https://cpan.metacpan.org/authors/id/E/ET/ETHER/Test-Pod-${{package.version}}.tar.gz
  - runs: |
      export CFLAGS=$(perl -MConfig -E 'say $Config{ccflags}')
      PERL_MM_USE_DEFAULT=1 perl Makefile.PL INSTALLDIRS=vendor
  - runs: |
      export CFLAGS=$(perl -MConfig -E 'say $Config{ccflags}')
      make
  - uses: autoconf/make-install
  - runs: find ${{targets.destdir}} \( -name perllocal.pod -o -name .packlist \) -delete
  - uses: strip
subpackages:
  - name: perl-test-pod-doc
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}/usr/share"
          mv "${{targets.destdir}}/usr/share/man" "${{targets.subpkgdir}}/usr/share"
          mv "${{targets.destdir}}/usr/share/perl5" "${{targets.subpkgdir}}/usr/share"
---
package:
  name: perl-yaml-syck
  version: 1.34
  epoch: 0
  description: Fast, lightweight YAML loader and dumper
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: MIT
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/os
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - automake
      - autoconf
      - perl-dev
      - perl
pipeline:
  - uses: fetch
    with:
      expected-sha256: cc9156ccaebda798ebfe2f31b619e806577f860ed1704262f17ffad3c6e34159
      uri: https://cpan.metacpan.org/authors/id/T/TO/TODDR/YAML-Syck-${{package.version}}.tar.gz
  - runs: |
      export CFLAGS=$(perl -MConfig -E 'say $Config{ccflags}')
      PERL_MM_USE_DEFAULT=1 perl Makefile.PL INSTALLDIRS=vendor
  - runs: |
      export CFLAGS=$(perl -MConfig -E 'say $Config{ccflags}')
      make
  - uses: autoconf/make-install
  - runs: find ${{targets.destdir}} \( -name perllocal.pod -o -name .packlist \) -delete
  - uses: strip
subpackages:
  - name: perl-yaml-syck-doc
    pipeline:
      - uses: split/manpages
---
package:
  name: perl
  version: 5.36.0
  epoch: 1
  description: "Larry Wall's Practical Extraction and Report Language"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: Artistic-Perl OR GPL-1.0-or-later
  dependencies:
    runtime:
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/bootstrap/stage3
    keyring:
      - https://packages.wolfi.dev/bootstrap/stage3/wolfi-signing.rsa.pub
    packages:
      - wolfi-baselayout
      - busybox
      - ca-certificates-bundle
      - build-base
      - bison
      - zlib-dev
      - bzip2-dev
pipeline:
  - uses: fetch
    with:
      uri: https://www.cpan.org/src/5.0/perl-${{package.version}}.tar.gz
      expected-sha256: e26085af8ac396f62add8a533c3a0ea8c8497d836f0689347ac5abd7b7a4e00a
  # Delete bundled zlib and bzip2 sources
  - runs: |
      rm -rf cpan/Compress-Raw-Zlib/zlib-src
      rm -rf cpan/Compress-Raw-Bzip2/bzip2-src
      sed -i '/\(bzip2\|zlib\)-src/d' MANIFEST
  - name: 'Configure perl'
    runs: |
      BUILD_ZLIB=0
      BUILD_BZIP2=0
      BZIP2_LIB=/usr/lib
      BZIP2_INCLUDE=/usr/include

      export BUILD_ZLIB BUILD_BZIP2 BZIP2_LIB BZIP2_INCLUDE

      ./Configure -des \
         -Dcc=gcc \
         -Dcccdlflags='-fPIC' \
         -Dcccdlflags='-fPIC' \
         -Dccdlflags='-rdynamic' \
         -Dprefix=/usr \
         -Dprivlib=/usr/share/perl5/core_perl \
         -Darchlib=/usr/lib/perl5/core_perl \
         -Dvendorprefix=/usr \
         -Dvendorlib=/usr/share/perl5/vendor_perl \
         -Dvendorarch=/usr/lib/perl5/vendor_perl \
         -Dsiteprefix=/usr/local \
         -Dsitelib=/usr/local/share/perl5/site_perl \
         -Dsitearch=/usr/local/lib/perl5/site_perl \
         -Dlocincpth=' ' \
         -Duselargefiles \
         -Dusethreads \
         -Duseshrplib \
         -Dd_semctl_semun \
         -Dman1dir=/usr/share/man/man1 \
         -Dman3dir=/usr/share/man/man3 \
         -Dinstallman1dir=/usr/share/man/man1 \
         -Dinstallman3dir=/usr/share/man/man3 \
         -Dman1ext='1' \
         -Dman3ext='3pm' \
         -Dcf_by='Wolfi GNU/Linux' \
         -Ud_csh

      make -j$(nproc) libperl.so
      make -j$(nproc)
  - uses: autoconf/make-install
  - runs: |
      find "${{targets.destdir}}" -name '.*' -delete
  - uses: strip
subpackages:
  - name: "perl-dev"
    description: "libperl development headers"
    pipeline:
      - runs: |
          _privlib=/usr/share/perl5/core_perl
          _archlib=/usr/lib/perl5/core_perl

          mkdir -p "${{targets.subpkgdir}}"/usr/bin
          mkdir -p "${{targets.subpkgdir}}"/$_privlib
          mkdir -p "${{targets.subpkgdir}}"/$_archlib

          mv "${{targets.destdir}}"/$_archlib/Devel "${{targets.subpkgdir}}"/$_archlib/
          mv "${{targets.destdir}}"/$_privlib/Encode "${{targets.subpkgdir}}"/$_privlib/

          for i in h2xs perlivp enc2xs xsubpp; do
            mv "${{targets.destdir}}"/usr/bin/$i "${{targets.subpkgdir}}"/usr/bin/
          done
      - uses: split/dev
    dependencies:
      runtime:
        - perl
        - perl-utils
  - name: "perl-doc"
    description: "perl documentation"
    pipeline:
      - uses: split/manpages
      - runs: |
          for file in $(find "${{targets.destdir}}" -name "*.pod"); do
            file=${file#${{targets.destdir}}/}
            mkdir -p "${{targets.subpkgdir}}"/${file%/*}
            mv "${{targets.destdir}}"/$file "${{targets.subpkgdir}}"/$file
          done
  - name: "perl-utils"
    description: "various utilities included with perl"
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/bin

          for i in corelist cpan encguess libnetcfg h2ph instmodsh json_pp perlbug perlthanks piconv pl2pm prove ptar \
            ptardiff ptargrep shasum splain zipdetails
          do
            mv "${{targets.destdir}}"/usr/bin/$i "${{targets.subpkgdir}}"/usr/bin/
          done
    dependencies:
      runtime:
        - perl
---
package:
  name: pkgconf
  version: 1.9.3
  epoch: 3
  description: "An implementation of pkg-config"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: ISC
  dependencies:
    runtime:
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/bootstrap/stage3
    keyring:
      - https://packages.wolfi.dev/bootstrap/stage3/wolfi-signing.rsa.pub
    packages:
      - wolfi-baselayout
      - busybox
      - ca-certificates-bundle
      - build-base
pipeline:
  - uses: fetch
    with:
      uri: https://distfiles.dereferenced.org/pkgconf/pkgconf-${{package.version}}.tar.gz
      expected-sha256: 6d73ac21a9410f5cc636acf730f3a5bf46b28d1e18a239c89efc4b2c5548792f
  - name: 'Configure pkgconf'
    runs: |
      ./configure \
        --prefix=/usr \
        --libdir=/lib \
        --sysconfdir=/etc \
        --mandir=/usr/share/man \
        --infodir=/usr/share/info \
        --with-pkg-config-dir=/usr/local/lib/pkgconfig:/usr/local/share/pkgconfig:/usr/lib/pkgconfig:/usr/share/pkgconfig \
        --host=$(uname -m)-pc-linux-gnu \
        --target=$(uname -m)-pc-linux-gnu
  - runs: |
      make -j$(nproc) V=1
  - uses: autoconf/make-install
  - runs: |
      ln -s pkgconf "${{targets.destdir}}"/usr/bin/pkg-config
  - name: 'Clean up documentation'
    runs: |
      rm -rf ${{targets.destdir}}/usr/share/info
  - uses: strip
subpackages:
  - name: "pkgconf-dev"
    description: "pkgconf headers"
    pipeline:
      - uses: split/dev
      - runs: |
          mv "${{targets.subpkgdir}}"/usr/bin/pkg-config "${{targets.destdir}}"/usr/bin/
    dependencies:
      runtime:
        - pkgconf
  - name: "pkgconf-doc"
    description: "pkgconf documentation"
    pipeline:
      - uses: split/manpages
---
package:
  name: postgresql-11
  version: 11.17
  epoch: 0
  description: A sophisticated object-relational DBMS
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: BSD
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/os
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - automake
      - autoconf
      - openssl-dev
      - libedit-dev
      - zlib-dev
      - libxml2-dev
      - bison
      - flex
      - execline-dev
      # - util-linux-dev TODO add once util-linux is packaged
pipeline:
  - uses: fetch
    with:
      expected-sha256: 6e984963ae0765e61577995103a7e6594db0f0bd01528ac123e0de4a6a4cb4c4
      uri: https://ftp.postgresql.org/pub/source/v${{package.version}}/postgresql-${{package.version}}.tar.bz2
  - uses: autoconf/configure
    with:
      opts: |
        --mandir=/usr/share/man \
        --with-openssl \
        --with-libedit-preferred
  # --with-uuid=e2fs requores util-linux, let's avoid this package for now
  # MAKELEVEL=0 is used because of a postgresql build system bug:
  # https://www.postgresql.org/message-id/15407-7b64e5de97dedc5e%40postgresql.org
  - uses: autoconf/make
    with:
      opts: MAKELEVEL=0
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: postgresql-11-dev
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - postgresql-11
        - openssl-dev
        - postgresql-11-client
        - libpq-11
    description: postgresql dev
  - name: postgresql-11-client
    description: PostgreSQL client
    pipeline:
      - runs: |
          mkdir -p ${{targets.subpkgdir}}/usr/bin
          mv ${{targets.destdir}}/usr/bin/psql ${{targets.subpkgdir}}/usr/bin/
  - name: postgresql-11-contrib
    pipeline:
      - runs: |
          mkdir -p ${{targets.subpkgdir}}
          make DESTDIR=${{targets.subpkgdir}} -C contrib install
    description: Extension modules distributed with PostgreSQL
  - name: libpq-11
    description: PostgreSQL libraries
    pipeline:
      - runs: |
          mkdir -p ${{targets.subpkgdir}}/usr/lib
          mv ${{targets.destdir}}/usr/lib/libpq.so* ${{targets.subpkgdir}}/usr/lib/
  - name: postgresql-11-oci-entrypoint
    description: Entrypoint for using PostgreSQL in OCI containers
    dependencies:
      runtime:
        - bash
    pipeline:
      - runs: |
          mkdir -p ${{targets.subpkgdir}}/var/lib/postgres/initdb
          cp postgresql-entrypoint.sh ${{targets.subpkgdir}}/var/lib/postgres/initdb/
          chmod +x ${{targets.subpkgdir}}/var/lib/postgres/initdb/postgresql-entrypoint.sh
---
package:
  name: postgresql-12
  version: 12.12
  epoch: 0
  description: A sophisticated object-relational DBMS
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: BSD
environment:
  contents:
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - automake
      - autoconf
      - openssl-dev
      - libedit-dev
      - zlib-dev
      - libxml2-dev
      - bison
      - flex
      - execline-dev
      # - util-linux-dev TODO add once util-linux is packaged
pipeline:
  - uses: fetch
    with:
      expected-sha256: 34b3f1c69408e22068c0c71b1827691f1c89153b0ad576c1a44f8920a858039c
      uri: https://ftp.postgresql.org/pub/source/v${{package.version}}/postgresql-${{package.version}}.tar.bz2
  - uses: autoconf/configure
    with:
      opts: |
        --mandir=/usr/share/man \
        --with-openssl \
        --with-libedit-preferred
  # --with-uuid=e2fs requores util-linux, let's avoid this package for now
  # MAKELEVEL=0 is used because of a postgresql build system bug:
  # https://www.postgresql.org/message-id/15407-7b64e5de97dedc5e%40postgresql.org
  - uses: autoconf/make
    with:
      opts: MAKELEVEL=0
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: postgresql-12-dev
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - postgresql-12
        - openssl-dev
        - postgresql-12-client
        - libpq-12
    description: postgresql dev
  - name: postgresql-12-client
    description: PostgreSQL client
    pipeline:
      - runs: |
          mkdir -p ${{targets.subpkgdir}}/usr/bin
          mv ${{targets.destdir}}/usr/bin/psql ${{targets.subpkgdir}}/usr/bin/
  - name: postgresql-12-contrib
    pipeline:
      - runs: |
          mkdir -p ${{targets.subpkgdir}}
          make DESTDIR=${{targets.subpkgdir}} -C contrib install
    description: Extension modules distributed with PostgreSQL
  - name: libpq-12
    description: PostgreSQL libraries
    pipeline:
      - runs: |
          mkdir -p ${{targets.subpkgdir}}/usr/lib
          mv ${{targets.destdir}}/usr/lib/libpq.so* ${{targets.subpkgdir}}/usr/lib/
  - name: postgresql-12-oci-entrypoint
    description: Entrypoint for using PostgreSQL in OCI containers
    dependencies:
      runtime:
        - bash
    pipeline:
      - runs: |
          mkdir -p ${{targets.subpkgdir}}/var/lib/postgres/initdb
          cp postgresql-entrypoint.sh ${{targets.subpkgdir}}/var/lib/postgres/initdb/
          chmod +x ${{targets.subpkgdir}}/var/lib/postgres/initdb/postgresql-entrypoint.sh
---
package:
  name: postgresql-13
  version: 13.8
  epoch: 0
  description: A sophisticated object-relational DBMS
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: BSD
environment:
  contents:
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - automake
      - autoconf
      - openssl-dev
      - libedit-dev
      - zlib-dev
      - libxml2-dev
      - bison
      - flex
      - execline-dev
      # - util-linux-dev TODO add once util-linux is packaged
pipeline:
  - uses: fetch
    with:
      expected-sha256: 73876fdd3a517087340458dca4ce15b8d2a4dbceb334c0441424551ae6c4cded
      uri: https://ftp.postgresql.org/pub/source/v${{package.version}}/postgresql-${{package.version}}.tar.bz2
  - uses: autoconf/configure
    with:
      opts: |
        --mandir=/usr/share/man \
        --with-openssl \
        --with-libedit-preferred
  # --with-uuid=e2fs requores util-linux, let's avoid this package for now
  # MAKELEVEL=0 is used because of a postgresql build system bug:
  # https://www.postgresql.org/message-id/15407-7b64e5de97dedc5e%40postgresql.org
  - uses: autoconf/make
    with:
      opts: MAKELEVEL=0
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: postgresql-13-dev
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - postgresql-13
        - openssl-dev
        - postgresql-13-client
        - libpq-13
    description: postgresql dev
  - name: postgresql-13-client
    description: PostgreSQL client
    pipeline:
      - runs: |
          mkdir -p ${{targets.subpkgdir}}/usr/bin
          mv ${{targets.destdir}}/usr/bin/psql ${{targets.subpkgdir}}/usr/bin/
  - name: postgresql-13-contrib
    pipeline:
      - runs: |
          mkdir -p ${{targets.subpkgdir}}
          make DESTDIR=${{targets.subpkgdir}} -C contrib install
    description: Extension modules distributed with PostgreSQL
  - name: libpq-13
    description: PostgreSQL libraries
    pipeline:
      - runs: |
          mkdir -p ${{targets.subpkgdir}}/usr/lib
          mv ${{targets.destdir}}/usr/lib/libpq.so* ${{targets.subpkgdir}}/usr/lib/
  - name: postgresql-13-oci-entrypoint
    description: Entrypoint for using PostgreSQL in OCI containers
    dependencies:
      runtime:
        - bash
    pipeline:
      - runs: |
          mkdir -p ${{targets.subpkgdir}}/var/lib/postgres/initdb
          cp postgresql-entrypoint.sh ${{targets.subpkgdir}}/var/lib/postgres/initdb/
          chmod +x ${{targets.subpkgdir}}/var/lib/postgres/initdb/postgresql-entrypoint.sh
---
package:
  name: postgresql-14
  version: 14.5
  epoch: 0
  description: A sophisticated object-relational DBMS
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: BSD
environment:
  contents:
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - automake
      - autoconf
      - openssl-dev
      - libedit-dev
      - zlib-dev
      - libxml2-dev
      - bison
      - flex
      - execline-dev
      # - util-linux-dev TODO add once util-linux is packaged
pipeline:
  - uses: fetch
    with:
      expected-sha256: d4f72cb5fb857c9a9f75ec8cf091a1771272802f2178f0b2e65b7b6ff64f4a30
      uri: https://ftp.postgresql.org/pub/source/v${{package.version}}/postgresql-${{package.version}}.tar.bz2
  - uses: autoconf/configure
    with:
      opts: |
        --mandir=/usr/share/man \
        --with-openssl \
        --with-libedit-preferred
  # --with-uuid=e2fs requores util-linux, let's avoid this package for now
  # MAKELEVEL=0 is used because of a postgresql build system bug:
  # https://www.postgresql.org/message-id/15407-7b64e5de97dedc5e%40postgresql.org
  - uses: autoconf/make
    with:
      opts: MAKELEVEL=0
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: postgresql-14-dev
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - postgresql-14
        - openssl-dev
        - postgresql-14-client
        - libpq-14
    description: postgresql dev
  - name: postgresql-14-client
    description: PostgreSQL client
    pipeline:
      - runs: |
          mkdir -p ${{targets.subpkgdir}}/usr/bin
          mv ${{targets.destdir}}/usr/bin/psql ${{targets.subpkgdir}}/usr/bin/
  - name: postgresql-14-contrib
    pipeline:
      - runs: |
          mkdir -p ${{targets.subpkgdir}}
          make DESTDIR=${{targets.subpkgdir}} -C contrib install
    description: Extension modules distributed with PostgreSQL
  - name: libpq-14
    description: PostgreSQL libraries
    pipeline:
      - runs: |
          mkdir -p ${{targets.subpkgdir}}/usr/lib
          mv ${{targets.destdir}}/usr/lib/libpq.so* ${{targets.subpkgdir}}/usr/lib/
  - name: postgresql-14-oci-entrypoint
    description: Entrypoint for using PostgreSQL in OCI containers
    dependencies:
      runtime:
        - bash
    pipeline:
      - runs: |
          mkdir -p ${{targets.subpkgdir}}/var/lib/postgres/initdb
          cp postgresql-entrypoint.sh ${{targets.subpkgdir}}/var/lib/postgres/initdb/
          chmod +x ${{targets.subpkgdir}}/var/lib/postgres/initdb/postgresql-entrypoint.sh
---
package:
  name: postgresql-15
  version: 15.0
  epoch: 0
  description: A sophisticated object-relational DBMS
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: BSD
secfixes:
  0:
    - CVE-2017-8806
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/os
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - automake
      - autoconf
      - openssl-dev
      - libedit-dev
      - zlib-dev
      - libxml2-dev
      - bison
      - flex
      - execline-dev
      # - util-linux-dev TODO add once util-linux is packaged
pipeline:
  - uses: fetch
    with:
      expected-sha256: 72ec74f4a7c16e684f43ea42e215497fcd4c55d028a68fb72e99e61ff40da4d6
      uri: https://ftp.postgresql.org/pub/source/v${{package.version}}/postgresql-${{package.version}}.tar.bz2
  - uses: autoconf/configure
    with:
      opts: |
        --mandir=/usr/share/man \
        --with-openssl \
        --with-libedit-preferred
  # --with-uuid=e2fs requores util-linux, let's avoid this package for now
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: postgresql-15-dev
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - postgresql-15
        - openssl-dev
        - postgresql-15-client
        - libpq-15
    description: postgresql dev
  - name: postgresql-15-client
    description: PostgreSQL client
    pipeline:
      - runs: |
          mkdir -p ${{targets.subpkgdir}}/usr/bin
          mv ${{targets.destdir}}/usr/bin/psql ${{targets.subpkgdir}}/usr/bin/
  - name: postgresql-15-contrib
    pipeline:
      - runs: |
          mkdir -p ${{targets.subpkgdir}}
          make DESTDIR=${{targets.subpkgdir}} -C contrib install
    description: Extension modules distributed with PostgreSQL
  - name: libpq-15
    description: PostgreSQL libraries
    pipeline:
      - runs: |
          mkdir -p ${{targets.subpkgdir}}/usr/lib
          mv ${{targets.destdir}}/usr/lib/libpq.so* ${{targets.subpkgdir}}/usr/lib/
  - name: postgresql-15-oci-entrypoint
    description: Entrypoint for using PostgreSQL in OCI containers
    dependencies:
      runtime:
        - bash
    pipeline:
      - runs: |
          mkdir -p ${{targets.subpkgdir}}/var/lib/postgres/initdb
          cp postgresql-entrypoint.sh ${{targets.subpkgdir}}/var/lib/postgres/initdb/
          chmod +x ${{targets.subpkgdir}}/var/lib/postgres/initdb/postgresql-entrypoint.sh
---
package:
  name: procps
  version: 4.0.0
  epoch: 0
  description: "utilities for monitor processes on a system"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: GPL-2.0-or-later AND LGPL-2.1-or-later
environment:
  contents:
    packages:
      - wolfi-base
      - busybox
      - ca-certificates-bundle
      - build-base
      - ncurses-dev
pipeline:
  - uses: fetch
    with:
      uri: https://downloads.sourceforge.net/project/procps-ng/Production/procps-ng-4.0.0.tar.xz
      expected-sha256: 0f4d92794edb7a1c95bb3b8c1f823de62be5d0043459c2155fd07fa859c16513
  - runs: |
      env FORCE_UNSAFE_CONFIGURE=1 ./configure \
         --prefix=/usr \
         --libexecdir=/usr/libexec \
         --sysconfdir=/etc \
         --mandir=/usr/share/man \
         --docdir=/usr/share/doc/procps \
         --infodir=/usr/share/info \
         --disable-nls
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: "procps-doc"
    description: "procps documentation"
    pipeline:
      - uses: split/manpages
      - uses: split/infodir
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/share
          mv "${{targets.destdir}}"/usr/share/doc "${{targets.subpkgdir}}"/usr/share/
  - name: "procps-dev"
    description: "libproc development headers"
    pipeline:
      - uses: split/dev
  - name: "libproc-2-0"
    description: "libproc runtime"
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/lib
          mv "${{targets.destdir}}"/usr/lib/libproc*.so.* "${{targets.subpkgdir}}"/usr/lib/
---
package:
  name: py3-appdirs
  version: 1.4.4
  epoch: 0
  description: "a small python module for appdir support"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: MIT
  dependencies:
    runtime:
      - python3
environment:
  contents:
    packages:
      - wolfi-base
      - busybox
      - ca-certificates-bundle
      - build-base
      - python3
pipeline:
  - uses: fetch
    with:
      uri: https://files.pythonhosted.org/packages/source/a/appdirs/appdirs-${{package.version}}.tar.gz
      expected-sha256: 7d5d0167b2b1ba821647616af46a749d1c653740dd0d2415100fe26e27afdf41
  - runs: |
      python3 setup.py build
  - runs: |
      python3 setup.py install --prefix=/usr --root="${{targets.destdir}}"
  - uses: strip
---
package:
  name: py3-contextlib2
  version: 21.6.0
  epoch: 0
  description: "backports of the contextlib module from newer versions of python"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: PSF-2.0 AND Apache-2.0
  dependencies:
    runtime:
      - python3
environment:
  contents:
    packages:
      - wolfi-base
      - busybox
      - ca-certificates-bundle
      - build-base
      - python3
      - py3-setuptools
pipeline:
  - uses: fetch
    with:
      uri: https://files.pythonhosted.org/packages/source/c/contextlib2/contextlib2-${{package.version}}.tar.gz
      expected-sha256: ab1e2bfe1d01d968e1b7e8d9023bc51ef3509bba217bb730cee3827e1ee82869
  - runs: |
      python3 setup.py build
  - runs: |
      python3 setup.py install --prefix=/usr --root="${{targets.destdir}}"
  - uses: strip
---
package:
  name: py3-flit-core
  version: 3.7.1
  epoch: 0
  description: "simple packaging tool for simple packages (core)"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: BSD-3-Clause
  dependencies:
    runtime:
      - python3
environment:
  contents:
    packages:
      - wolfi-base
      - busybox
      - ca-certificates-bundle
      - build-base
      - python3
      - py3-installer
pipeline:
  - uses: fetch
    with:
      uri: https://files.pythonhosted.org/packages/source/f/flit/flit-${{package.version}}.tar.gz
      expected-sha256: 3c9bd9c140515bfe62dd938c6610d10d6efb9e35cc647fc614fe5fb3a5036682
  - runs: |
      cd flit_core
      python3 build_dists.py
  - runs: |
      cd flit_core
      python3 -m installer -d "${{targets.destdir}}" dist/flit_core-${{package.version}}-py3-none-any.whl
  - runs: |
      rm -rf "${{targets.destdir}}"/usr/lib/python3*/site-packages/flit_core/tests
  - uses: strip
---
package:
  name: py3-gpep517
  version: 9
  epoch: 1
  description: "PEP517 build system support for distros"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: MIT
  dependencies:
    runtime:
      - python3
      - py3-installer
      - py3-tomli
environment:
  contents:
    packages:
      - wolfi-base
      - busybox
      - ca-certificates-bundle
      - build-base
      - python3
pipeline:
  - uses: fetch
    with:
      uri: https://github.com/mgorny/gpep517/archive/v${{package.version}}/gpep517-v${{package.version}}.tar.gz
      expected-sha256: e03eaee68c7e745638b18921e53bc55d0b39af0892167621b542e41bd9aa425a
  - runs: |
      _site_pkgs="$(python3 -c 'import site; print(site.getsitepackages()[0])')"
      _py3ver=$(python3 -c 'import sys; print("{}.{}".format(sys.version_info.major, sys.version_info.minor))')

      mkdir -p "${{targets.destdir}}"/"$_site_pkgs"
      cp -a gpep517 "${{targets.destdir}}"/$_site_pkgs/
  - uses: strip
---
package:
  name: py3-installer
  version: 0.5.1
  epoch: 0
  description: "tool for installing from a Python wheel distribution"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: MIT
  dependencies:
    runtime:
      - python3
environment:
  contents:
    packages:
      - wolfi-base
      - busybox
      - ca-certificates-bundle
      - build-base
      - python3
pipeline:
  - uses: fetch
    with:
      uri: https://files.pythonhosted.org/packages/source/i/installer/installer-${{package.version}}.tar.gz
      expected-sha256: f970995ec2bb815e2fdaf7977b26b2091e1e386f0f42eafd5ac811953dc5d445
  - runs: |
      python3 setup.py build
  - runs: |
      python3 setup.py install --prefix=/usr --root="${{targets.destdir}}"
  - uses: strip
---
package:
  name: py3-jinja2
  version: 3.1.2
  epoch: 0
  description: "A small but fast and easy to use stand-alone python template engine"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: BSD-3-Clause
  dependencies:
    runtime:
      - py3-markupsafe
environment:
  contents:
    packages:
      - wolfi-base
      - busybox
      - ca-certificates-bundle
      - build-base
      - python3-dev
      - py3-setuptools
pipeline:
  - uses: fetch
    with:
      uri: https://files.pythonhosted.org/packages/source/J/Jinja2/Jinja2-3.1.2.tar.gz
      expected-sha512: 5dfe122c1beef5305b34d25f22f96607bd3a6cba098b03091850ea36fefe62b645a7218d7584b35bea252393ac922c9bb3654a9e90f23bcfb273e811fcf2f2c1
  - runs: |
      python3 setup.py install --prefix=/usr --root="${{targets.destdir}}"

      docdir="/usr/share/doc/${{package.name}}"
      # Note: The documentation in the docs directory needs to be generated
      # by py-sphinx, however, this package (py-jinja2) is a dependency of
      # Sphinx itself!
      mkdir -p "$docdir"
      cp -R docs examples "$docdir"/

      install -m 644 -D LICENSE.rst /usr/share/licenses/${{package.name}}/LICENSE.rst
  - uses: strip
---
package:
  name: py3-markupsafe
  version: 2.1.1
  epoch: 0
  description: "Implements a XML/HTML/XHTML Markup safe string"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: BSD-3-Clause
  dependencies:
    runtime:
      - python3
environment:
  contents:
    packages:
      - wolfi-base
      - busybox
      - ca-certificates-bundle
      - build-base
      - python3-dev
      - py3-setuptools
pipeline:
  - uses: fetch
    with:
      uri: https://files.pythonhosted.org/packages/source/M/MarkupSafe/MarkupSafe-${{package.version}}.tar.gz
      expected-sha512: 1d9bf55614b4e0aeca726ebda7bab2829452212f03f2295efdd0340f3dd05eefc9733d6dd0e37f0d06a432ce00ed7d06b28c9e817fc25212675006577f468b3e
  - runs: |
      python3 setup.py install --prefix=/usr --root="${{targets.destdir}}"
  - uses: strip
---
package:
  name: py3-more-itertools
  version: 8.13.0
  epoch: 0
  description: "more routines for operating on iterables, beyond itertools"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: MIT
  dependencies:
    runtime:
      - python3
environment:
  contents:
    packages:
      - wolfi-base
      - busybox
      - ca-certificates-bundle
      - build-base
      - python3
      - py3-installer
pipeline:
  - uses: fetch
    with:
      uri: https://files.pythonhosted.org/packages/py3/m/more_itertools/more_itertools-${{package.version}}-py3-none-any.whl
      expected-sha256: c5122bffc5f104d37c1626b8615b511f3427aa5389b94d61e5ef8236bfbc3ddb
      extract: false
  - runs: |
      python3 -m installer -d "${{targets.destdir}}" more_itertools-${{package.version}}-py3-none-any.whl
  - uses: strip
---
package:
  name: py3-ordered-set
  version: 4.0.2
  epoch: 0
  description: "mutableset which remembers its order"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: MIT
  dependencies:
    runtime:
      - python3
environment:
  contents:
    packages:
      - wolfi-base
      - busybox
      - ca-certificates-bundle
      - build-base
      - python3
pipeline:
  - uses: fetch
    with:
      uri: https://files.pythonhosted.org/packages/source/o/ordered-set/ordered-set-${{package.version}}.tar.gz
      expected-sha256: ba93b2df055bca202116ec44b9bead3df33ea63a7d5827ff8e16738b97f33a95
  - runs: |
      _site_pkgs="$(python3 -c 'import site; print(site.getsitepackages()[0])')"
      _py3ver=$(python3 -c 'import sys; print("{}.{}".format(sys.version_info.major, sys.version_info.minor))')

      mkdir -p "${{targets.destdir}}"/"$_site_pkgs"
      cp -rv ordered_set.egg-info "${{targets.destdir}}"/"$_site_pkgs"/ordered_set-${{package.version}}-py$_py3ver.egg-info
      cp -rv ordered_set.py "${{targets.destdir}}"/$_site_pkgs/

      python3 -m compileall -f -q "${{targets.destdir}}"/$_site_pkgs/*.py
  - uses: strip
---
package:
  name: py3-packaging
  version: 21.3
  epoch: 0
  description: "core utilities for python3 packaging"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: Apache-2.0 AND BSD-2-Clause
  dependencies:
    runtime:
      - python3
      - py3-parsing
environment:
  contents:
    packages:
      - wolfi-base
      - busybox
      - ca-certificates-bundle
      - build-base
      - python3
      - py3-parsing
pipeline:
  - uses: fetch
    with:
      uri: https://files.pythonhosted.org/packages/source/p/packaging/packaging-${{package.version}}.tar.gz
      expected-sha256: dd47c42927d89ab911e606518907cc2d3a1f38bbd026385970643f9c5b8ecfeb
  - runs: |
      python3 setup.py build
  - runs: |
      python3 setup.py install --prefix=/usr --root="${{targets.destdir}}"
  - uses: strip
---
package:
  name: py3-parsing
  version: 3.0.9
  epoch: 0
  description: "simple packaging tool for simple packages (core)"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: MIT
  dependencies:
    runtime:
      - python3
environment:
  contents:
    packages:
      - wolfi-base
      - busybox
      - ca-certificates-bundle
      - build-base
      - python3
      - py3-installer
      - py3-flit-core
      - py3-gpep517
pipeline:
  - uses: fetch
    with:
      uri: https://files.pythonhosted.org/packages/source/p/pyparsing/pyparsing-${{package.version}}.tar.gz
      expected-sha256: 2b020ecf7d21b687f219b71ecad3631f644a47f01403fa1d1036b0c6416d70fb
  - runs: |
      mkdir -p dist
      backend="$(python3 -m gpep517 get-backend)"
      python3 -m gpep517 build-wheel --wheel-dir dist --backend "$backend" --output-fd 1
  - runs: |
      python3 -m installer -d "${{targets.destdir}}" dist/pyparsing-${{package.version}}-py3-none-any.whl
  - uses: strip
---
package:
  name: py3-pep517
  version: 0.13.0
  epoch: 0
  description: "wrappers to build python3 packages with PEP 517 hooks"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: MIT
  dependencies:
    runtime:
      - python3
      - py3-tomli
environment:
  contents:
    packages:
      - wolfi-base
      - busybox
      - ca-certificates-bundle
      - build-base
      - python3
      - py3-installer
      - py3-flit-core
      - py3-gpep517
pipeline:
  - uses: fetch
    with:
      uri: https://files.pythonhosted.org/packages/source/p/pep517/pep517-${{package.version}}.tar.gz
      expected-sha256: ae69927c5c172be1add9203726d4b84cf3ebad1edcd5f71fcdc746e66e829f59
  - runs: |
      mkdir -p dist
      backend="$(python3 -m gpep517 get-backend)"
      python3 -m gpep517 build-wheel --wheel-dir dist --backend "$backend" --output-fd 1
  - runs: |
      python3 -m installer -d "${{targets.destdir}}" dist/pep517-${{package.version}}-py3-none-any.whl
  - uses: strip
---
package:
  name: py3-pip
  version: 22.2.2
  epoch: 0
  description: "tool for installing and managing python packages"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: MIT
  dependencies:
    runtime:
      - python3
      - py3-contextlib2
      - py3-pep517
      - py3-retrying
      - py3-setuptools
environment:
  contents:
    packages:
      - wolfi-base
      - busybox
      - ca-certificates-bundle
      - build-base
      - python3
      - py3-contextlib2
      - py3-pep517
      - py3-retrying
      - py3-setuptools
pipeline:
  - uses: fetch
    with:
      uri: https://files.pythonhosted.org/packages/source/p/pip/pip-${{package.version}}.tar.gz
      expected-sha256: 3fd1929db052f056d7a998439176d3333fa1b3f6c1ad881de1885c0717608a4b
  - runs: |
      python3 setup.py build
  - runs: |
      python3 setup.py install --prefix=/usr --root="${{targets.destdir}}"
  - uses: strip
---
package:
  name: py3-retrying
  version: 1.3.3
  epoch: 0
  description: "python 2 and 3 compatibility library"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: Apache-2.0
  dependencies:
    runtime:
      - python3
      - py3-six
environment:
  contents:
    packages:
      - wolfi-base
      - busybox
      - ca-certificates-bundle
      - build-base
      - python3
      - py3-six
      - py3-setuptools
pipeline:
  - uses: fetch
    with:
      uri: https://files.pythonhosted.org/packages/source/r/retrying/retrying-${{package.version}}.tar.gz
      expected-sha256: 08c039560a6da2fe4f2c426d0766e284d3b736e355f8dd24b37367b0bb41973b
  - runs: |
      python3 setup.py build
  - runs: |
      python3 setup.py install --prefix=/usr --root="${{targets.destdir}}"
  - uses: strip
---
package:
  name: py3-setuptools-stage0
  version: 52.0.0
  epoch: 0
  description: "collection of enhancements to the python3 distutils"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: MIT
  dependencies:
    runtime:
      - python3
      - py3-appdirs
      - py3-more-itertools
      - py3-ordered-set
      - py3-packaging
      - py3-parsing
    provides:
      - py3-setuptools=52.0.0-r0
environment:
  contents:
    packages:
      - wolfi-base
      - busybox
      - ca-certificates-bundle
      - build-base
      - python3
      - py3-appdirs
      - py3-more-itertools
      - py3-ordered-set
      - py3-packaging
      - py3-parsing
pipeline:
  - uses: fetch
    with:
      uri: https://files.pythonhosted.org/packages/source/s/setuptools/setuptools-${{package.version}}.tar.gz
      expected-sha256: fb3a1ee622509550dbf1d419f241296169d7f09cb1eb5b1736f2f10965932b96
  - name: "Unbundle vendored dependencies"
    runs: |
      rm -rf pkg_resources/extern pkg_resources/_vendor \
        setuptools/extern setuptools/_vendor

      for _module in setuptools pkg_resources '' ; do
        find . -name \*.py -exec sed -i \
          -e 's/from '$_module.extern' import/import/' \
          -e 's/from '$_module.extern'./from /' \
          -e 's/import '$_module.extern'./import /' \
          -e "s/__import__('$_module.extern./__import__('/" \
          {} +
      done

      sed -e '/tag_build = .post/d' \
          -e '/tag_date = 1/d' \
          -i setup.cfg

      python3 bootstrap.py
  - runs: |
      python3 setup.py build
  - runs: |
      mkdir -p build/scripts-3.10
      python3 setup.py install --prefix=/usr --root="${{targets.destdir}}"
  - uses: strip
---
package:
  name: py3-setuptools
  # NOTE: Be very careful when upgrading this package as upstream
  # aggressively deprecates functionality used by packages in
  # production.
  version: 59.4.0
  epoch: 0
  description: "collection of enhancements to the python3 distutils"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: MIT
  dependencies:
    runtime:
      - python3
      - py3-appdirs
      - py3-more-itertools
      - py3-ordered-set
      - py3-packaging
      - py3-parsing
environment:
  contents:
    packages:
      - wolfi-base
      - busybox
      - ca-certificates-bundle
      - build-base
      - python3
      - py3-appdirs
      - py3-more-itertools
      - py3-ordered-set
      - py3-packaging
      - py3-parsing
      - py3-setuptools
pipeline:
  - uses: fetch
    with:
      uri: https://files.pythonhosted.org/packages/source/s/setuptools/setuptools-${{package.version}}.tar.gz
      expected-sha256: b4c634615a0cf5b02cf83c7bedffc8da0ca439f00e79452699454da6fbd4153d
  - name: "Unbundle vendored dependencies"
    runs: |
      rm -rf pkg_resources/extern pkg_resources/_vendor \
        setuptools/extern setuptools/_vendor

      for _module in setuptools pkg_resources '' ; do
        find . -name \*.py -exec sed -i \
          -e 's/from '$_module.extern' import/import/' \
          -e 's/from '$_module.extern'./from /' \
          -e 's/import '$_module.extern'./import /' \
          -e "s/__import__('$_module.extern./__import__('/" \
          {} +
      done

      sed -e '/tag_build = .post/d' \
          -e '/tag_date = 1/d' \
          -i setup.cfg
  - runs: |
      python3 setup.py build
  - runs: |
      mkdir -p build/scripts-3.10
      python3 setup.py install --prefix=/usr --root="${{targets.destdir}}" --skip-build
  - uses: strip
---
package:
  name: py3-six
  version: 1.16.0
  epoch: 0
  description: "python 2 and 3 compatibility library"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: MIT
  dependencies:
    runtime:
      - python3
environment:
  contents:
    packages:
      - wolfi-base
      - busybox
      - ca-certificates-bundle
      - build-base
      - python3
pipeline:
  - uses: fetch
    with:
      uri: https://files.pythonhosted.org/packages/source/s/six/six-${{package.version}}.tar.gz
      expected-sha256: 1e61c37477a1626458e36f7b1d82aa5c9b094fa4802892072e49de9c60c4c926
  - runs: |
      python3 setup.py build
  - runs: |
      python3 setup.py install --prefix=/usr --root="${{targets.destdir}}"
  - uses: strip
---
package:
  name: py3-tomli
  version: 2.0.1
  epoch: 0
  description: "TOML parser"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: MIT
  dependencies:
    runtime:
      - python3
environment:
  contents:
    packages:
      - wolfi-base
      - busybox
      - ca-certificates-bundle
      - build-base
      - python3
      - py3-installer
pipeline:
  - uses: fetch
    with:
      uri: https://files.pythonhosted.org/packages/py3/t/tomli/tomli-${{package.version}}-py3-none-any.whl
      expected-sha256: 939de3e7a6161af0c887ef91b7d41a53e7c5a1ca976325f429cb46ea9bc30ecc
      extract: false
  - runs: |
      python3 -m installer -d "${{targets.destdir}}" tomli-${{package.version}}-py3-none-any.whl
  - uses: strip
---
package:
  name: python3
  version: 3.10.7
  epoch: 0
  description: "the Python programming language"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: PSF-2.0
  dependencies:
    runtime:
secfixes:
  3.0.7-r0:
    - CVE-2020-10735
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/bootstrap/stage3
    keyring:
      - https://packages.wolfi.dev/bootstrap/stage3/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - bzip2-dev
      - expat-dev
      - gdbm-dev
      - libffi-dev
      - linux-headers
      - mpdecimal-dev
      - ncurses-dev
      - openssl-dev
      - readline-dev
      - sqlite-dev
      - xz-dev
      - zlib-dev
pipeline:
  - uses: fetch
    with:
      uri: https://www.python.org/ftp/python/${{package.version}}/Python-${{package.version}}.tar.xz
      expected-sha256: 6eed8415b7516fb2f260906db5d48dd4c06acc0cb24a7d6cc15296a604dcdc48
  - name: Force use of system libraries
    runs: |
      rm -rf Modules/expat \
        Modules/_ctypes/darwin* \
        Modules/_ctypes/libffi*
  - name: Configure
    runs: |
      ./configure \
         --host=$(uname -m)-pc-linux-gnu \
         --build=$(uname -m)-pc-linux-gnu \
         --target=$(uname -m)-pc-linux-gnu \
         --prefix=/usr \
         --enable-ipv6 \
         --enable-loadable-sqlite-extensions \
         --enable-optimizations \
         --enable-shared \
         --without-lto \
         --with-computed-gotos \
         --with-dbmliborder=gdbm:ndbm \
         --with-system-expat \
         --with-system-ffi \
         --with-system-libmpdec \
         --without-ensurepip
  - uses: autoconf/make
  - uses: autoconf/make-install
  - name: Install python symlink
    runs: |
      ln -s python3 "${{targets.destdir}}"/usr/bin/python
  - uses: strip
subpackages:
  - name: "python3-doc"
    description: "python3 documentation"
    pipeline:
      - uses: split/manpages
  - name: "python3-dev"
    description: "python3 development headers"
    pipeline:
      - uses: split/dev
      # pyconfig.h is needed at runtime... ugh.
      - runs: |
          mkdir -p "${{targets.destdir}}"/usr/include/python3.10
          mv "${{targets.subpkgdir}}"/usr/include/python3.10/pyconfig.h "${{targets.destdir}}"/usr/include/python3.10
---
package:
  name: readline
  version: 8.1.2
  epoch: 1
  description: "GNU readline library"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: GPL-3.0-or-later
  dependencies:
    runtime:
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/bootstrap/stage3
    keyring:
      - https://packages.wolfi.dev/bootstrap/stage3/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - ncurses-dev
pipeline:
  - uses: fetch
    with:
      uri: https://ftp.gnu.org/gnu/readline/readline-8.1.tar.gz
      expected-sha256: f8ceb4ee131e3232226a17f51b164afc46cd0b9e6cef344be87c65962cb82b02
  - uses: patch
    with:
      patches: readline81-001.patch
      strip-components: 0
  - uses: patch
    with:
      patches: readline81-002.patch
      strip-components: 0
  - uses: patch
    with:
      patches: fix-ncurses-underlinking.patch
      strip-components: 0
  - name: Configure
    runs: |
      ./configure \
         --host=$(uname -m)-pc-linux-gnu \
         --target=$(uname -m)-pc-linux-gnu \
         --prefix=/usr
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: "readline-dev"
    description: "GNU readline headers"
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - readline
---
package:
  name: rhash
  version: 1.4.3
  epoch: 1
  description: "cross-platform asynchronous I/O library"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: 0BSD
environment:
  contents:
    packages:
      - wolfi-base
      - busybox
      - ca-certificates-bundle
      - build-base
      - openssl-dev
pipeline:
  - uses: fetch
    with:
      uri: https://downloads.sourceforge.net/rhash/rhash-${{package.version}}-src.tar.gz
      expected-sha256: 1e40fa66966306920f043866cbe8612f4b939b033ba5e2708c3f41be257c8a3e
  - runs: |
      ./configure \
        --prefix=/usr \
        --sysconfdir=/etc \
        --enable-openssl \
        --disable-openssl-runtime
  - uses: autoconf/make
  - uses: autoconf/make-install
  - runs: |
      make DESTDIR="${{targets.destdir}}" install-lib-headers install-lib-shared install-lib-so-link
  - uses: strip
subpackages:
  - name: "rhash-doc"
    description: "rhash documentation"
    pipeline:
      - uses: split/manpages
  - name: "rhash-dev"
    description: "rhash development headers"
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - librhash0
  - name: "librhash0"
    description: "librhash runtime library"
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/lib
          mv "${{targets.destdir}}"/usr/lib/librhash.so.* "${{targets.subpkgdir}}"/usr/lib/
---
package:
  name: ruby-3.0
  version: 3.0.4
  epoch: 0
  description: "the Ruby programming language"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: PSF-2.0
  dependencies:
    runtime:
environment:
  contents:
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - bzip2-dev
      - expat-dev
      - gdbm-dev
      - libffi-dev
      - linux-headers
      - mpdecimal-dev
      - ncurses-dev
      - openssl-dev
      - readline-dev
      - sqlite-dev
      - xz-dev
      - zlib-dev
      - oniguruma-dev
pipeline:
  - uses: fetch
    with:
      uri: https://cache.ruby-lang.org/pub/ruby/3.0/ruby-${{package.version}}.tar.gz
      expected-sha256: 70b47c207af04bce9acea262308fb42893d3e244f39a4abc586920a1c723722b
  - name: Configure
    runs: |
      ./configure \
         --host=$(uname -m)-pc-linux-gnu \
         --build=$(uname -m)-pc-linux-gnu \
         --target=$(uname -m)-pc-linux-gnu \
         --prefix=/usr \
         --enable-ipv6 \
         --enable-loadable-sqlite-extensions \
         --enable-optimizations \
         --enable-shared \
         --without-lto \
         --with-computed-gotos \
         --with-dbmliborder=gdbm:ndbm \
         --with-system-expat \
         --with-system-ffi \
         --with-system-libmpdec \
         --without-ensurepip
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: "ruby-3.0-doc"
    description: "ruby documentation"
    pipeline:
      - uses: split/manpages
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/share
          mv "${{targets.destdir}}"/usr/share/doc "${{targets.subpkgdir}}"/usr/share/
  - name: "ruby-3.0-dev"
    description: "ruby development headers"
    pipeline:
      - uses: split/dev
---
package:
  name: ruby-3.1
  version: 3.1.2
  epoch: 0
  description: "the Ruby programming language"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: PSF-2.0
  dependencies:
    runtime:
environment:
  contents:
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - bzip2-dev
      - expat-dev
      - gdbm-dev
      - libffi-dev
      - linux-headers
      - mpdecimal-dev
      - ncurses-dev
      - openssl-dev
      - readline-dev
      - sqlite-dev
      - xz-dev
      - zlib-dev
      - oniguruma-dev
pipeline:
  - uses: fetch
    with:
      uri: https://cache.ruby-lang.org/pub/ruby/3.1/ruby-${{package.version}}.tar.gz
      expected-sha256: 61843112389f02b735428b53bb64cf988ad9fb81858b8248e22e57336f24a83e
  - name: Configure
    runs: |
      ./configure \
         --host=$(uname -m)-pc-linux-gnu \
         --build=$(uname -m)-pc-linux-gnu \
         --target=$(uname -m)-pc-linux-gnu \
         --prefix=/usr \
         --enable-ipv6 \
         --enable-loadable-sqlite-extensions \
         --enable-optimizations \
         --enable-shared \
         --without-lto \
         --with-computed-gotos \
         --with-dbmliborder=gdbm:ndbm \
         --with-system-expat \
         --with-system-ffi \
         --with-system-libmpdec \
         --without-ensurepip
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: "ruby-3.1-doc"
    description: "ruby documentation"
    pipeline:
      - uses: split/manpages
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/share
          mv "${{targets.destdir}}"/usr/share/doc "${{targets.subpkgdir}}"/usr/share/
  - name: "ruby-3.1-dev"
    description: "ruby development headers"
    pipeline:
      - uses: split/dev
---
package:
  name: rust-stage0
  version: 1.64.0
  epoch: 0
  description: "bootstrap package for rust"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: blessing
  dependencies:
    runtime:
    provides:
      - rust=1.64.0
environment:
  contents:
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
pipeline:
  - uses: fetch
    with:
      uri: https://static.rust-lang.org/dist/rust-${{package.version}}-x86_64-unknown-linux-gnu.tar.gz
      expected-sha256: a893977f238291370ab96726a74b6b9ae854dc75fbf5730954d901a93843bf9b
  - runs: |
      sh install.sh --verbose --destdir="${{targets.destdir}}" --prefix="/usr"
  - runs: |
      mv "${{targets.destdir}}"/usr/etc "${{targets.destdir}}"/etc
  - uses: strip
subpackages:
  - name: "rust-stage0-doc"
    description: "rust stage0 documentation"
    pipeline:
      - uses: split/manpages
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/share
          mv "${{targets.destdir}}"/usr/share/doc "${{targets.subpkgdir}}"/usr/share/
---
package:
  name: s6
  version: 2.11.1.2
  epoch: 0
  description: "skarnet.org's small & secure supervision software suite."
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: ISC
  dependencies:
    runtime:
      - execline
  scriptlets:
    trigger:
      paths:
        - /run/service
      script: |
        #!/bin/execlineb -P
        s6-svscanctl -an /run/service
environment:
  contents:
    packages:
      - wolfi-baselayout
      - busybox
      - ca-certificates-bundle
      - build-base
      - skalibs-dev
      - execline-dev
pipeline:
  - uses: fetch
    with:
      uri: https://skarnet.org/software/s6/s6-${{package.version}}.tar.gz
      expected-sha256: 6c1474be3e889dac392cee307abe015cd4be0c85c725c84ea7f184f0e34503a2
  - name: Configure
    runs: |
      ./configure \
        --enable-shared \
        --enable-static \
        --disable-allstatic \
        --libdir=/usr/lib \
        --libexecdir=/lib/s6 \
        --with-dynlib=/lib
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: "s6-dev"
    description: "s6 development headers"
    pipeline:
      - uses: split/dev
  - name: "s6-ipcserver"
    description: "s6 ipcserver"
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/bin

          for i in s6-ipcserver s6-ipcserver-socketbinder s6-ipcserverd s6-applyuidgid; do
            mv "${{targets.destdir}}"/bin/$i "${{targets.subpkgdir}}"/bin/$i
          done
---
package:
  name: samurai
  version: 1.2
  epoch: 0
  description: "ninja-compatible build tool written in C"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: Apache-2.0
  dependencies:
    provides:
      - ninja=1.9.0
secfixes:
  1.2-r0:
    - CVE-2021-30218
    - CVE-2021-30219
environment:
  contents:
    packages:
      - wolfi-base
      - busybox
      - ca-certificates-bundle
      - build-base
pipeline:
  - uses: fetch
    with:
      uri: https://github.com/michaelforney/samurai/releases/download/${{package.version}}/samurai-${{package.version}}.tar.gz
      expected-sha256: 3b8cf51548dfc49b7efe035e191ff5e1963ebc4fe8f6064a5eefc5343eaf78a5
  - uses: patch
    with:
      patches: CVE-2021-30218.patch
  - uses: patch
    with:
      patches: CVE-2021-30219.patch
  - runs: |
      make -j$(nproc) CC=$(uname -m)-pc-linux-gnu-gcc
  - runs: |
      make install PREFIX="/usr" DESTDIR="${{targets.destdir}}"
  - uses: strip
  - runs: |
      ln -s samu "${{targets.destdir}}"/usr/bin/ninja
subpackages:
  - name: "samurai-doc"
    description: "samurai documentation"
    pipeline:
      - uses: split/manpages
      - uses: split/infodir
---
package:
  name: scdoc
  version: 1.11.2
  epoch: 1
  description: "simple man page generator written for POSIX systems with C99"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: MIT
  dependencies:
    runtime:
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/bootstrap/stage3
    keyring:
      - https://packages.wolfi.dev/bootstrap/stage3/wolfi-signing.rsa.pub
    packages:
      - wolfi-baselayout
      - busybox
      - ca-certificates-bundle
      - build-base
pipeline:
  - uses: fetch
    with:
      uri: https://git.sr.ht/~sircmpwn/scdoc/archive/${{package.version}}.tar.gz
      expected-sha256: e9ff9981b5854301789a6778ee64ef1f6d1e5f4829a9dd3e58a9a63eacc2e6f0
  - uses: autoconf/make
  - runs: |
      make install DESTDIR="${{targets.destdir}}" PREFIX="/usr"
  - uses: strip
subpackages:
  - name: "scdoc-doc"
    description: "scdoc documentation"
    pipeline:
      - uses: split/manpages
---
package:
  name: sed
  version: 4.8
  epoch: 1
  description: "GNU stream editor"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: GPL-3.0-or-later
  dependencies:
    runtime:
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/bootstrap/stage3
    keyring:
      - https://packages.wolfi.dev/bootstrap/stage3/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
pipeline:
  - uses: fetch
    with:
      uri: https://ftp.gnu.org/gnu/sed/sed-${{package.version}}.tar.gz
      expected-sha256: 53cf3e14c71f3a149f29d13a0da64120b3c1d3334fba39c4af3e520be053982a
  - name: Configure
    runs: |
      ./configure \
         --host=$(uname -m)-pc-linux-gnu \
         --target=$(uname -m)-pc-linux-gnu \
         --prefix=/usr \
         --datadir=/usr/share
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
---
package:
  name: skalibs
  version: 2.12.0.0
  epoch: 0
  description: "set of general-purpose C programming libraries for skarnet.org software"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: ISC
  dependencies:
    runtime:
environment:
  contents:
    packages:
      - wolfi-baselayout
      - busybox
      - ca-certificates-bundle
      - build-base
pipeline:
  - uses: fetch
    with:
      uri: https://skarnet.org/software/skalibs/skalibs-${{package.version}}.tar.gz
      expected-sha256: e6d724b4c628f093df75c98f1274d8bd6c0ecdb09cc6816d3268bacb58647f30
  - name: Configure
    runs: |
      ./configure \
        --enable-shared \
        --enable-static \
        --libdir=/usr/lib
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: "skalibs-dev"
    description: "skalibs development headers"
    pipeline:
      - uses: split/dev
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/lib/skalibs
          mv "${{targets.destdir}}"/usr/lib/skalibs/sysdeps "${{targets.subpkgdir}}"/usr/lib/skalibs/
---
package:
  name: sqlite
  version: 3.39.4
  epoch: 1
  description: "C library which implements an SQL database engine"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: blessing
  dependencies:
    runtime:
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/bootstrap/stage3
    keyring:
      - https://packages.wolfi.dev/bootstrap/stage3/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - readline
pipeline:
  - uses: fetch
    with:
      uri: https://www.sqlite.org/2022/sqlite-autoconf-3390400.tar.gz
      expected-sha256: f31d445b48e67e284cf206717cc170ab63cbe4fd7f79a82793b772285e78fdbb
  - name: Configure
    runs: |
      _amalgamation="-DSQLITE_ENABLE_FTS4 \
        -DSQLITE_ENABLE_FTS3_PARENTHESIS \
        -DSQLITE_ENABLE_FTS3 \
        -DSQLITE_ENABLE_FTS5 \
        -DSQLITE_ENABLE_COLUMN_METADATA \
        -DSQLITE_SECURE_DELETE \
        -DSQLITE_ENABLE_UNLOCK_NOTIFY \
        -DSQLITE_ENABLE_RTREE \
        -DSQLITE_ENABLE_GEOPOLY \
        -DSQLITE_USE_URI \
        -DSQLITE_ENABLE_DBSTAT_VTAB \
        -DSQLITE_MAX_VARIABLE_NUMBER=250000"
      export CFLAGS="$CFLAGS $_amalgamation"

      ./configure \
         --host=$(uname -m)-pc-linux-gnu \
         --target=$(uname -m)-pc-linux-gnu \
         --prefix=/usr \
         --enable-threadsafe \
         --enable-readline \
         --enable-static \
         --enable-dynamic-extensions \
         --enable-fts3

      sed -i 's|^hardcode_libdir_flag_spec=.*|hardcode_libdir_flag_spec=""|g' libtool
      sed -i 's|^runpath_var=LD_RUN_PATH|runpath_var=DIE_RPATH_DIE|g' libtool

      make -j$(nproc) V=1
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: "sqlite-dev"
    description: "sqlite headers"
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - sqlite
  - name: "sqlite-doc"
    description: "sqlite documentation"
    pipeline:
      - uses: split/manpages
---
package:
  name: su-exec
  version: 0.2
  epoch: 0
  description: switch user and group id, setgroups and exec
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: MIT
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/os
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - automake
      - autoconf
pipeline:
  - uses: fetch
    with:
      expected-sha256: ec4acbd8cde6ceeb2be67eda1f46c709758af6db35cacbcde41baac349855e25
      uri: https://github.com/ncopa/su-exec/archive/v${{package.version}}.tar.gz
  - uses: autoconf/make
  - runs: |
      mkdir -p ${{targets.destdir}}/sbin
      install -D su-exec ${{targets.destdir}}/sbin
---
package:
  name: texinfo
  version: 6.8
  epoch: 0
  description: "GNU documentation tool"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: GPL-3.0-or-later
  dependencies:
    runtime:
      - perl
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/bootstrap/stage3
    keyring:
      - https://packages.wolfi.dev/bootstrap/stage3/wolfi-signing.rsa.pub
    packages:
      - wolfi-baselayout
      - busybox
      - ca-certificates-bundle
      - build-base
      - ncurses
      - perl
      - xz
pipeline:
  - uses: fetch
    with:
      uri: https://ftp.gnu.org/gnu/texinfo/texinfo-${{package.version}}.tar.xz
      expected-sha256: 8eb753ed28bca21f8f56c1a180362aed789229bd62fff58bf8368e9beb59fec4
  - name: 'Configure texinfo'
    runs: |
      ./configure \
        --prefix=/usr \
        --libdir=/lib \
        --sysconfdir=/etc \
        --datadir=/usr/share \
        --mandir=/usr/share/man \
        --infodir=/usr/share/info \
        --host=$(uname -m)-pc-linux-gnu \
        --target=$(uname -m)-pc-linux-gnu
  - runs: |
      make -j$(nproc) V=1
  - uses: autoconf/make-install
  - runs: |
      rm -f "${{targets.destdir}}"/usr/share/info/dir
  - uses: strip
---
package:
  name: tree
  version: 2.0.4
  epoch: 0
  description: A recursive directory indented listing of files
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: GPL-2.0-or-later
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/bootstrap/stage3
      - https://packages.wolfi.dev/os
    keyring:
      - https://packages.wolfi.dev/bootstrap/stage3/wolfi-signing.rsa.pub
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - automake
      - autoconf
pipeline:
  - uses: fetch
    with:
      expected-sha256: c51b3a758fcbc25c7f88316491db5ac6926d032f45af96687297a95a3b7b15de
      uri: https://gitlab.com/OldManProgrammer/unix-tree/-/archive/${{package.version}}/unix-tree-${{package.version}}.tar.gz
  - uses: autoconf/make
  - runs: |
      make PREFIX="${{targets.destdir}}/usr" \
        MANDIR="${{targets.destdir}}/usr/share/man" \
        install
  - uses: strip
subpackages:
  - name: tree-doc
    pipeline:
      - uses: split/manpages
    description: tree manpages
---
package:
  name: trivy
  version: 0.32.0
  epoch: 1
  description: Simple and comprehensive vulnerability scanner for containers
  target-architecture:
    - all
  copyright:
    - license: Apache-2.0
      paths:
        - "*"
environment:
  contents:
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    repositories:
      - https://packages.wolfi.dev/os
    packages:
      - ca-certificates-bundle
      - busybox
      - go
pipeline:
  - uses: fetch
    with:
      uri: https://github.com/aquasecurity/trivy/archive/v${{package.version}}/trivy-${{package.version}}.tar.gz
      expected-sha512: 3a31fea34f9d8f021eb3a1d522ef47e555d7559eba50b7d64bb25aeef9fd99fc4146316f1e176dcc7ce02033b20c1f6cc7cafee563d9c54f9e4301fbf9db0b5c
  - runs: |
      CGO_ENABLED=0 go build \
        -ldflags "-s -w -X=main.version=${{package.version}}" \
        -o "${{targets.destdir}}/usr/bin/trivy" ./cmd/trivy
---
package:
  name: tzdata
  version: 2022f
  epoch: 0
  description: "Timezone data provided by IANA"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: Public-Domain
  dependencies:
    runtime:
environment:
  contents:
    packages:
      - wolfi-baselayout
      - busybox
      - ca-certificates-bundle
      - build-base
      - tzutils
pipeline:
  - uses: fetch
    with:
      uri: https://www.iana.org/time-zones/repository/releases/tzcode${{package.version}}.tar.gz
      expected-sha256: e4543e90f84f91fa82809ea98930052fdbc13880c8a623ee3a4eaa42f8a64c15
      strip-components: 0
  - uses: fetch
    with:
      uri: https://www.iana.org/time-zones/repository/releases/tzdata${{package.version}}.tar.gz
      expected-sha256: 9990d71f675d212567b931fe8aae1cab7027f89fefb8a79d808a6933a67af000
      strip-components: 0
  - runs: |
      make cc="${CC:-gcc}" CFLAGS="$CFLAGS -DHAVE_STDINT_H=1" TZDIR="/usr/share/zoneinfo"
  - runs: |
      _timezones="africa antarctica asia australasia europe northamerica southamerica etcetera backward factory"

      zic -b fat -y ./yearistype -d "${{targets.destdir}}"/usr/share/zoneinfo $_timezones
      zic -b fat -y ./yearistype -d "${{targets.destdir}}"/usr/share/zoneinfo/right -L leapseconds $_timezones
      zic -b fat -y ./yearistype -d "${{targets.destdir}}"/usr/share/zoneinfo -p America/New_York

      install -m444 -t "${{targets.destdir}}"/usr/share/zoneinfo iso3166.tab zone1970.tab zone.tab
      install -Dm644 leap-seconds.list "${{targets.destdir}}"/usr/share/zoneinfo
---
package:
  name: util-macros
  version: 1.19.3
  epoch: 0
  description: X.Org Autotools macros
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: MIT
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/os
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - automake
      - autoconf
pipeline:
  - uses: fetch
    with:
      expected-sha256: 0f812e6e9d2786ba8f54b960ee563c0663ddbe2434bf24ff193f5feab1f31971
      uri: https://www.x.org/releases/individual/util/util-macros-${{package.version}}.tar.bz2
  - uses: autoconf/configure
  - uses: autoconf/make
  - uses: autoconf/make-install
---
package:
  name: wget
  version: 1.21.3
  epoch: 2
  description: "GNU wget"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: MPL-2.0 AND MIT
  dependencies:
    runtime:
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/bootstrap/stage3
    keyring:
      - https://packages.wolfi.dev/bootstrap/stage3/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - openssl-dev
pipeline:
  - uses: fetch
    with:
      uri: https://ftp.gnu.org/gnu/wget/wget-${{package.version}}.tar.gz
      expected-sha256: 5726bb8bc5ca0f6dc7110f6416e4bb7019e2d2ff5bf93d1ca2ffcc6656f220e5
  - runs: |
      ./configure \
        --host=$(uname -m)-pc-linux-gnu \
        --target=$(uname -m)-pc-linux-gnu \
        --prefix=/usr \
        --sysconfdir=/etc \
        --without-libidn \
        --with-ssl=openssl \
        --disable-nls
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
---
package:
  name: wolfi-base
  version: 1
  epoch: 1
  description: "Wolfi base metapackage"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: MIT
  dependencies:
    runtime:
      - apk-tools
      - busybox
      - wolfi-keys
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/bootstrap/stage3
    keyring:
      - https://packages.wolfi.dev/bootstrap/stage3/wolfi-signing.rsa.pub
    packages:
      - busybox
pipeline:
  - name: Install
    runs: |
      mkdir -p "${{targets.destdir}}"
---
package:
  name: wolfi-baselayout
  version: 20221104
  epoch: 0
  description: "baselayout data for Wolfi"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: MIT
  dependencies:
    runtime:
      - glibc-locale-posix
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/bootstrap/stage3
    keyring:
      - https://packages.wolfi.dev/bootstrap/stage3/wolfi-signing.rsa.pub
    packages:
      - wolfi-baselayout
      - busybox
pipeline:
  - name: Generate /etc/shadow
    runs: |
      awk -F: '{
          pw = ":!:"
          if ($1 == "root") { pw = "::" }
          print($1 pw ":0:::::")
      }' vendor/etc/passwd > vendor/etc/shadow
  - name: Install
    runs: |
      for i in bin etc etc/profile.d etc/secfixes.d home lib root var usr/bin usr/sbin usr/local tmp var/spool/cron; do
        mkdir -p "${{targets.destdir}}"/${i}
      done

      for i in lib64 usr/lib64 usr/local/lib64; do
        ln -s lib "${{targets.destdir}}"/${i}
      done

      for i in etc/passwd etc/group etc/shadow etc/services etc/hosts etc/profile etc/shells etc/protocols etc/inittab etc/profile.d/locale.sh etc/nsswitch.conf etc/os-release etc/secfixes.d/wolfi; do
        install -m644 vendor/${i} "${{targets.destdir}}"/${i}
      done

      install -m600 vendor/etc/shadow "${{targets.destdir}}"/etc/shadow

      ln -s /etc/crontabs "${{targets.destdir}}"/var/spool/cron/crontabs
      ln -s /proc/mounts "${{targets.destdir}}"/etc/mtab
      ln -s /var/mail "${{targets.destdir}}"/var/spool/mail
---
package:
  name: wolfi-keys
  version: 1
  epoch: 2
  description: "Wolfi signing keyring"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: MIT
  dependencies:
    runtime:
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/bootstrap/stage3
    keyring:
      - https://packages.wolfi.dev/bootstrap/stage3/wolfi-signing.rsa.pub
    packages:
      - busybox
pipeline:
  - name: Install
    runs: |
      mkdir -p "${{targets.destdir}}"/etc/apk/keys
      install -m644 wolfi-signing.rsa.pub "${{targets.destdir}}"/etc/apk/keys

      for i in x86_64 aarch64; do
        mkdir -p "${{targets.destdir}}"/usr/share/apk/keys
        install -m644 wolfi-signing.rsa.pub "${{targets.destdir}}"/usr/share/apk/keys/${i}
      done
---
package:
  name: xcb-proto
  version: 1.15.2
  epoch: 0
  description: XML-XCB protocol descriptions
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: MIT
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/os
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - automake
      - autoconf
      - python3
pipeline:
  - uses: fetch
    with:
      expected-sha256: 7072beb1f680a2fe3f9e535b797c146d22528990c72f63ddb49d2f350a3653ed
      uri: https://xorg.freedesktop.org/archive/individual/proto/xcb-proto-${{package.version}}.tar.xz
  - uses: autoconf/configure
  - uses: autoconf/make
  - uses: autoconf/make-install
---
package:
  name: xmlto
  version: 0.0.28
  epoch: 0
  description: Convert xml to many other formats
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: GPL-2.0-or-later
  dependencies:
    runtime:
      - libxslt
      - perl-yaml-syck
      - perl-test-pod
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/os
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - automake
      - autoconf
      - bash
      - libxslt
      - perl-yaml-syck
      - perl-test-pod
      # - docbook-xsl # TODO used for manpages - skipping for now
pipeline:
  - uses: fetch
    with:
      expected-sha256: 1130df3a7957eb9f6f0d29e4aa1c75732a7dfb6d639be013859b5c7ec5421276
      uri: https://releases.pagure.org/xmlto/xmlto-${{package.version}}.tar.bz2
  - uses: autoconf/configure
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: xmlto-doc
    pipeline:
      - uses: split/manpages
    description: xmlto manpages
---
package:
  name: xorgproto
  version: 2022.2
  epoch: 0
  description: Combined X.Org X11 protocol headers
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: BSD-2-Clause AND MIT AND X11
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/os
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - automake
      - autoconf
      - meson
      - util-macros
pipeline:
  - uses: fetch
    with:
      expected-sha256: da351a403d07a7006d7bdc8dcfc14ddc1b588b38fb81adab9989a8eef605757b
      uri: https://xorg.freedesktop.org/archive/individual/proto/xorgproto-${{package.version}}.tar.gz
  - uses: meson/configure
  - uses: meson/compile
  - uses: meson/install
---
package:
  name: xtrans
  version: 1.4.0
  epoch: 0
  description: X transport library
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: MIT
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/os
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - automake
      - autoconf
      - util-macros
      - xmlto
pipeline:
  - uses: fetch
    with:
      expected-sha256: 377c4491593c417946efcd2c7600d1e62639f7a8bbca391887e2c4679807d773
      uri: https://www.x.org/releases/individual/lib/xtrans-${{package.version}}.tar.bz2
  - uses: autoconf/configure
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
---
package:
  name: xz
  version: 5.2.6
  epoch: 2
  description: "Library and CLI tools for XZ and LZMA compressed files"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: GPL-3.0-or-later
  dependencies:
    runtime:
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/bootstrap/stage3
    keyring:
      - https://packages.wolfi.dev/bootstrap/stage3/wolfi-signing.rsa.pub
    packages:
      - wolfi-baselayout
      - busybox
      - ca-certificates-bundle
      - build-base
pipeline:
  - uses: fetch
    with:
      uri: https://tukaani.org/xz/xz-${{package.version}}.tar.gz
      expected-sha256: a2105abee17bcd2ebd15ced31b4f5eda6e17efd6b10f921a01cda4a44c91b3a0
  - name: Configure
    runs: |
      ./configure \
         --host=$(uname -m)-pc-linux-gnu \
         --target=$(uname -m)-pc-linux-gnu \
         --prefix=/usr \
         --datadir=/usr/share
  - uses: autoconf/make
  - uses: autoconf/make-install
  - uses: strip
subpackages:
  - name: "xz-dev"
    description: "xz headers"
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - xz
  - name: "xz-doc"
    description: "xz documentation"
    pipeline:
      - uses: split/manpages
---
package:
  name: zip
  version: 3.0
  epoch: 0
  description: Creates PKZIP-compatible .zip files
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: Info-ZIP
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/os
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
pipeline:
  - uses: fetch
    with:
      expected-sha256: f0e8bb1f9b7eb0b01285495a2699df3a4b766784c1765a8f1aeedf63c0806369
      uri: https://sourceforge.net/projects/infozip/files/Zip%203.x%20%28latest%29/${{package.version}}/zip30.tar.gz
  - runs: make -f unix/Makefile LOCAL_ZIP="${CFLAGS} ${CPPFLAGS}" prefix=/usr generic
  - runs: make -f unix/Makefile prefix=${{targets.destdir}}/usr MANDIR=${{targets.destdir}}/usr/share/man install
  - uses: strip
subpackages:
  - name: zip-doc
    pipeline:
      - uses: split/manpages
    description: zip manpages
---
package:
  name: zlib
  version: 1.2.13
  epoch: 1
  description: "a library implementing the zlib compression algorithms"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: MPL-2.0 AND MIT
  dependencies:
    runtime:
secfixes:
  1.2.12-r3:
    - CVE-2022-37434
  1.2.12-r0:
    - CVE-2018-25032
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/bootstrap/stage3
    keyring:
      - https://packages.wolfi.dev/bootstrap/stage3/wolfi-signing.rsa.pub
    packages:
      - wolfi-baselayout
      - busybox
      - ca-certificates-bundle
      - build-base
pipeline:
  - uses: fetch
    with:
      uri: https://zlib.net/zlib-${{package.version}}.tar.gz
      expected-sha256: b3a24de97a8fdbc835b9833169501030b8977031bcb54b3b3ac13740f846ab30
  - runs: |
      CHOST="$(uname -m)-pc-linux-gnu" ./configure \
        --prefix=/usr \
        --libdir=/lib \
        --shared
  - uses: autoconf/make
  - runs: |
      make install pkgconfigdir="/usr/lib/pkgconfig" DESTDIR="${{targets.destdir}}"
  - uses: strip
subpackages:
  - name: "zlib-static"
    description: "zlib static library"
    pipeline:
      - uses: split/static
  - name: "zlib-dev"
    description: "zlib development headers"
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - zlib
---
package:
  name: zstd
  version: 1.5.2
  epoch: 0
  description: "the Zstandard compression algorithm"
  target-architecture:
    - all
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: BSD-2-Clause AND GPL-2.0-only
environment:
  contents:
    packages:
      - wolfi-base
      - busybox
      - ca-certificates-bundle
      - build-base
      - grep
pipeline:
  - uses: fetch
    with:
      uri: https://github.com/facebook/zstd/archive/refs/tags/v${{package.version}}.tar.gz
      expected-sha256: f7de13462f7a82c29ab865820149e778cbfe01087b3a55b5332707abf9db4a6e
  - runs: |
      make -j$(nproc) CC=$(uname -m)-pc-linux-gnu-gcc
  - runs: |
      make install PREFIX="/usr" DESTDIR="${{targets.destdir}}"
  - uses: strip
subpackages:
  - name: "zstd-doc"
    description: "zstd documentation"
    pipeline:
      - uses: split/manpages
      - uses: split/infodir
  - name: "zstd-dev"
    description: "zstd development headers"
    pipeline:
      - uses: split/dev
  - name: "libzstd1"
    description: "libzstd runtime libraries"
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/lib
          mv "${{targets.destdir}}"/usr/lib/libzstd.so.* "${{targets.subpkgdir}}"/usr/lib/

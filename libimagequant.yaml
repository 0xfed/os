package:
  name: libimagequant
  version: 4.3.1
  epoch: 0
  description: Palette quantization library that powers pngquant and other PNG optimizers
  copyright:
    - license: GPL-3.0-or-later

environment:
  contents:
    packages:
      - autoconf
      - automake
      - build-base
      - busybox
      - ca-certificates-bundle
      - cargo-auditable
      - cargo-c
      - rust

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/ImageOptim/libimagequant
      expected-commit: fea449e31038a1aeddf85b768d90426bb3a0411c
      tag: ${{package.version}}

  - runs: |
      cd imagequant-sys
      # prepare
      rm -rf Cargo.lock
      cargo fetch --target="${{host.triplet.rust}}"

      cargo auditable cbuild --release \
        --frozen \
        --prefix /usr \
        --library-type cdylib

      cargo auditable cinstall --release \
        --frozen \
        --prefix /usr \
        --destdir "${{targets.destdir}}" \
        --library-type cdylib

  - uses: strip

subpackages:
  - name: "libimagequant-dev"
    description: "libimagequant development headers"
    pipeline:
      - uses: split/dev

update:
  enabled: true
  github:
    identifier: ImageOptim/libimagequant
    use-tag: true

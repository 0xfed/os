package:
  name: erlang-26
  version: 26.0.2
  epoch: 0
  description: General-purpose programming language and runtime environment
  copyright:
    - license: Apache-2.0
  dependencies:
    runtime:
      # mnesia depends on the ca-certificates bundle
      - ca-certificates-bundle
    provides:
      - erlang=26.999.0

environment:
  contents:
    packages:
      - busybox
      - ca-certificates-bundle
      - build-base
      - automake
      - autoconf
      - perl-dev
      - openssl-dev
      - ncurses-dev
      - zlib-dev

pipeline:
  - uses: fetch
    with:
      expected-sha256: 47853ea9230643a0a31004433f07a71c1b92d6e0094534f629e3b75dbc62f193
      uri: https://github.com/erlang/otp/releases/download/OTP-${{package.version}}/otp_src_${{package.version}}.tar.gz

  - runs: |
      export CPPFLAGS="-D_BSD_SOURCE $CPPFLAGS"

      ./otp_build autoconf
      ./configure \
        --prefix=/usr \
        --sysconfdir=/etc \
        --mandir=/usr/share/man \
        --infodir=/usr/share/info \
        --host="$CHOST" \
        --build="$CBUILD" \
        --enable-threads \
        --enable-shared-zlib \
        --enable-ssl=dynamic-ssl-lib \
        --enable-jit

  - uses: autoconf/make

  - uses: autoconf/make-install

  - uses: strip

subpackages:
  - name: "erlang-26-dev"
    description: "headers for erlang"
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - erlang
      provides:
        - erlang-dev=26.999.0
    
  - name: "xmerl-1.3.32"
    description: "Provides support for XML 1.0"
    pipeline:
      - runs: |
          mkdir -p ${{targets.subpkgdir}}/usr/lib
          mv ${{targets.destdir}}/usr/lib/erlang/lib/xmerl-1.3.32 ${{targets.subpkgdir}}/usr/lib/

  - name: "tools-3.6"
    description: "A set of programming tools including a coverage analyzer etc"
    pipeline:
      - runs: |
          mkdir -p ${{targets.subpkgdir}}/usr/lib
          mv ${{targets.destdir}}/usr/lib/erlang/lib/tools-3.6 ${{targets.subpkgdir}}/usr/lib/

  - name: "tftp-1.1"
    description: "TFTP application"
    pipeline:
      - runs: |
          mkdir -p ${{targets.subpkgdir}}/usr/lib
          mv ${{targets.destdir}}/usr/lib/erlang/lib/tftp-1.1 ${{targets.subpkgdir}}/usr/lib/
  
  - name: "syntax_tools-3.1"
    description: "A utility used to handle abstract Erlang syntax trees, reading source files differently, pretty-printing syntax trees."
    pipeline:
      - runs: |
          mkdir -p ${{targets.subpkgdir}}/usr/lib
          mv ${{targets.destdir}}/usr/lib/erlang/lib/syntax_tools-3.1 ${{targets.subpkgdir}}/usr/lib/

  - name: "ssl-11.0.1"
    description: "ssl- Secure Socket Layer."
    pipeline:
      - runs: |
          mkdir -p ${{targets.subpkgdir}}/usr/lib
          mv ${{targets.destdir}}/usr/lib/erlang/lib/ssl-11.0.1 ${{targets.subpkgdir}}/usr/lib/

  - name: "snmp-5.14"
    description: "Simple Network Management Protocol (SNMP) support including a MIB compiler and tools for creating SNMP agents"
    pipeline:
      - runs: |
          mkdir -p ${{targets.subpkgdir}}/usr/lib
          mv ${{targets.destdir}}/usr/lib/erlang/lib/snmp-5.14 ${{targets.subpkgdir}}/usr/lib/

  - name: "runtime_tools-2.0"
    description: "Runtime tools, tools to include in a production system"
    pipeline:
      - runs: |
          mkdir -p ${{targets.subpkgdir}}/usr/lib
          mv ${{targets.destdir}}/usr/lib/erlang/lib/runtime_tools-2.0 ${{targets.subpkgdir}}/usr/lib/
  
  - name: "public_key-1.14"
    description: "API to public key infrastructure."
    pipeline:
      - runs: |
          mkdir -p ${{targets.subpkgdir}}/usr/lib
          mv ${{targets.destdir}}/usr/lib/erlang/lib/public_key-1.14 ${{targets.subpkgdir}}/usr/lib/
  
  - name: "parsetools-2.5"
    description: "A set of parsing and lexical analysis tools"
    pipeline:
      - runs: |
          mkdir -p ${{targets.subpkgdir}}/usr/lib
          mv ${{targets.destdir}}/usr/lib/erlang/lib/parsetools-2.5 ${{targets.subpkgdir}}/usr/lib/

  - name: "os_mon-2.9"
    description: "A monitor which allows inspection of the underlying operating system"
    pipeline:
      - runs: |
          mkdir -p ${{targets.subpkgdir}}/usr/lib
          mv ${{targets.destdir}}/usr/lib/erlang/lib/os_mon-2.9 ${{targets.subpkgdir}}/usr/lib/
  
  - name: "mnesia-4.22"
    description: "A heavy-duty real-time distributed database"
    pipeline:
      - runs: |
          mkdir -p ${{targets.subpkgdir}}/usr/lib
          mv ${{targets.destdir}}/usr/lib/erlang/lib/mnesia-4.22 ${{targets.subpkgdir}}/usr/lib/

  - name: "inets-9.0.1"
    description: "A set of services such as a Web server etc."
    pipeline:
      - runs: |
          mkdir -p ${{targets.subpkgdir}}/usr/lib
          mv ${{targets.destdir}}/usr/lib/erlang/lib/inets-9.0.1 ${{targets.subpkgdir}}/usr/lib/


update:
  enabled: true
  github:
    identifier: erlang/otp
    strip-prefix: OTP-
    use-tag: true
    tag-filter: OTP-
